(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{1814:function(e,t,r){Promise.resolve().then(r.bind(r,1130))},1130:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(7437),a=r(2265),l=r(8079),s=r(9376),i=r(1268),o=r(5217),c=r(3510),u=r(6870);function d(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),r=(0,u.Y)(),[d,f]=(0,a.useState)([]),m=async()=>{f((await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind))};(0,a.useEffect)(()=>{m(),navigator.mediaDevices.ondevicechange=m},[]),(0,a.useEffect)(()=>{let e=setInterval(()=>{m()},1e3);return()=>clearInterval(e)},[]);let{selectedMic:h,acquireMic:p,isVoiceDetected:x}=(0,c.Z)({recordingChunkSize:100}),[b,v]=(0,a.useState)(!1),[g,y]=(0,a.useState)("Beginner"),[j,w]=(0,a.useState)(!1),N=(e,n,a)=>{w(!0),(0,l.oY)({path:{service:"ws"},query:{tutoring_id:e,lesson_id:n,mode:a}}).then(e=>{e.data&&(r.resume(),t.push("/call?session_id=".concat(e.data.session_id)))}).catch(e=>{console.error(e)})};return(0,n.jsxs)("main",{className:"flex flex-col bg-gradient-to-b from-[#F6F8FF] to-[#F7F8FD] h-screen pt-5 justify-between tracking-[-0.02em]",children:[(0,n.jsx)("div",{className:"flex flex-col items-center w-full pb-6 px-7",children:(0,n.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,n.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{t.push("/")},children:(0,n.jsx)(i.G,{icon:o.g82,className:"text-xl"})}),(0,n.jsx)("div",{className:"font-medium pt-1",children:" Select conversation level"}),(0,n.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{},children:(0,n.jsx)(i.G,{icon:o.cRF,className:"text-xl"})})]})}),(0,n.jsx)("div",{className:"overflow-y-auto",children:e.get("tutoring_id")&&e.get("lesson_id")?(0,n.jsxs)("div",{className:"flex flex-col gap-5 px-7",children:[(0,n.jsx)("div",{className:"flex flex-col items-center justify-center h-full w-full gap-4 pb-12",children:[{name:"Beginner",value:"Beginner",description:"We give you all the cheats!",emoji:"\uD83D\uDC66\uD83C\uDFFB",activated:!0},{name:"Intermediate",value:"Intermediate",description:"Can you deal without translations?",emoji:"\uD83C\uDFEB",activated:!0},{name:"Advanced",value:"Advanced",description:"No more training wheels!",emoji:"\uD83D\uDC69\uD83C\uDFFB‍\uD83C\uDF93",activated:!0},{name:"Native (Experimental)",value:"Realtime",description:"Real time conversation like a native!",emoji:"\uD83E\uDDD0",activated:!0}].map(e=>(0,n.jsxs)("button",{className:"text-base border-[1px] py-4 px-7 rounded-lg w-full flex gap-3 items-center ".concat(g===e.value?"bg-[#0039FF]/5 border-[#0039FF] text-[#0039FF]":"bg-white border-black/10"," ").concat(!e.activated&&"opacity-50"),onClick:()=>{e.activated&&y(e.value)},children:[(0,n.jsx)("p",{className:"text-2xl mr-3",children:e.emoji}),(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("p",{className:"font-medium",children:e.name}),(0,n.jsx)("p",{className:"text-black/50 font-light text-sm",children:e.description})]})]},e.value))}),(0,n.jsxs)("button",{className:"text-black/30 underline text-center font-light",onClick:()=>{v(!b)},children:[b?"Hide":"Show"," audio device options"]}),b&&(0,n.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,n.jsx)("div",{className:"flex flex-col gap-2",children:d.map(e=>(0,n.jsx)("button",{className:"flex items-center justify-between py-3 px-3 w-full rounded-lg font-normal border ".concat(h==e.deviceId?"border-[#0039FF] text-[#0039FF] bg-[#0039FF]/5":"bg-white"),onClick:()=>{p(e.deviceId)},children:(0,n.jsx)("p",{className:"text-sm",children:e.label||"Unknown Microphone"})},e.deviceId))}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-black/30 mb-12",children:[(0,n.jsx)("p",{children:"Try speaking to test your microphone:"}),(0,n.jsx)("div",{className:"flex items-center justify-center rounded-full h-1 w-8 ".concat(x?"bg-green-500":"bg-black/10")})]})]})]}):(0,n.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,n.jsx)("h1",{className:"font-bold text-2xl text-black",children:"No Lesson Found"}),(0,n.jsx)("p",{className:"text-gray-500",children:"No lesson found to start."})]})}),(0,n.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,n.jsx)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto  pb-10 pt-6 border-black/10 border-t-2 bg-white\n              ",children:(0,n.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{N(e.get("tutoring_id"),e.get("lesson_id"),g)},children:j?(0,n.jsx)(i.G,{className:"animate-spin",icon:o.LM3}):(0,n.jsx)("p",{className:"font-medium text-lg",children:"Start"})})})})]})}},6870:function(e,t,r){"use strict";r.d(t,{GlobalAudioContextProvider:function(){return s},Y:function(){return i}});var n=r(7437),a=r(2265);let l=(0,a.createContext)(null),s=e=>{let{children:t}=e,r=(0,a.useRef)(null);return r.current||(console.log("creating audio context"),r.current=new(window.AudioContext||window.webkitAudioContext)),(0,n.jsx)(l.Provider,{value:r.current,children:t})},i=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},3510:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(2265),a=r(9800),l=r(3974),s=r(6870);function i(e){let{onSpeechStart:t,onSpeechEnd:r,onAudioData:i,onRecordingStart:o,onRecordingStop:c,micVolume:u=1,recordingChunkSize:d}=e,f=(0,s.Y)(),m=(0,n.useRef)(null),h=(0,n.useRef)(null),p=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,n.useRef)(!1),[v,g]=(0,n.useState)(!1),y=(0,n.useRef)(!1),[j,w]=(0,l.useLocalStorage)("selectedMic",null),[N,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{v?D():p.current&&R()},[v]);let C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=e&&e!==j;if(e?w(e):e=j,!n){if(b.current){console.log("Mic already being acquired");return}if(m.current&&h.current&&p.current){console.log("Mic already acquired");return}}k(),b.current=!0;try{m.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}}),console.log("Mic acquired",e);let n=f.createMediaStreamSource(m.current);h.current=f.createGain(),n.connect(h.current),h.current.gain.value=u;let l=f.createMediaStreamDestination();h.current.connect(l),p.current=new MediaRecorder(l.stream),x.current=await a.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:m.current,onSpeechStart:()=>{S(!0),null==t||t()},onVADMisfire:()=>{S(!1),null==r||r(!0)},onSpeechEnd:()=>{S(!1),null==r||r(!1)},positiveSpeechThreshold:.5,negativeSpeechThreshold:.35}),x.current.start()}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){console.log("User denied microphone access"),alert("Please allow microphone access to use this feature.");return}console.error("Error accessing microphone:",e),alert("Error accessing microphone: "+e);return}finally{b.current=!1}},D=async()=>{p.current||await C(),p.current&&(p.current.ondataavailable=e=>{null==i||i(e.data)},p.current.onstart=()=>{null==o||o()},p.current.onstop=()=>{null==c||c(y.current)},y.current=!1,await p.current.start(d))},R=()=>{p.current&&p.current.stop()},k=()=>{R(),m.current&&(m.current.getTracks().forEach(e=>{var t;e.stop(),null===(t=m.current)||void 0===t||t.removeTrack(e)}),m.current=null,console.log("Mic released")),h.current&&(h.current.disconnect(),h.current=null),p.current&&(p.current.stop(),p.current=null),x.current&&(N&&(S(!1),null==r||r(!1)),x.current.destroy(),x.current=null)};return(0,n.useEffect)(()=>{h.current&&(h.current.gain.value=u)},[u]),(0,n.useEffect)(()=>(console.log("Acquiring mic on mount"),C(),()=>{console.log("Releasing mic on unmount"),k()}),[]),{isRecording:v,setRecording:g,cancelRecording:()=>{y.current=!0,g(!1)},acquireMic:C,releaseMic:k,selectedMic:j,isVoiceDetected:N}}},5478:function(e,t,r){"use strict";r.d(t,{RL:function(){return h},_g:function(){return b},eI:function(){return v}});let n=/\{[^{}]+\}/g,a=({allowReserved:e,name:t,value:r})=>{if(null==r)return"";if("object"==typeof r)throw Error("Deeply-nested arrays/objects aren’t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${e?r:encodeURIComponent(r)}`},l=({allowReserved:e,explode:t,name:r,style:n,value:l})=>{if(!t){let t=(e?l:l.map(e=>encodeURIComponent(e))).join((e=>{switch(e){case"form":default:return",";case"pipeDelimited":return"|";case"spaceDelimited":return"%20"}})(n));switch(n){case"label":return`.${t}`;case"matrix":return`;${r}=${t}`;case"simple":return t;default:return`${r}=${t}`}}let s=(e=>{switch(e){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(n),i=l.map(t=>"label"===n||"simple"===n?e?t:encodeURIComponent(t):a({allowReserved:e,name:r,value:t})).join(s);return"label"===n||"matrix"===n?s+i:i},s=({allowReserved:e,explode:t,name:r,style:n,value:l})=>{if(l instanceof Date)return`${r}=${l.toISOString()}`;if("deepObject"!==n&&!t){let t=[];Object.entries(l).forEach(([r,n])=>{t=[...t,r,e?n:encodeURIComponent(n)]});let a=t.join(",");switch(n){case"form":return`${r}=${a}`;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return a}}let s=(e=>{switch(e){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(n),i=Object.entries(l).map(([t,l])=>a({allowReserved:e,name:"deepObject"===n?`${r}[${t}]`:t,value:l})).join(s);return"label"===n||"matrix"===n?s+i:i},i=({allowReserved:e,array:t,object:r}={})=>n=>{let i=[];if(n&&"object"==typeof n)for(let o in n){let c=n[o];null!=c&&(i=Array.isArray(c)?[...i,l({allowReserved:e,explode:!0,name:o,style:"form",value:c,...t})]:"object"!=typeof c?[...i,a({allowReserved:e,name:o,value:c})]:[...i,s({allowReserved:e,explode:!0,name:o,style:"deepObject",value:c,...r})])}return i.join("&")},o=({baseUrl:e,path:t,query:r,querySerializer:i,url:o})=>{let c=e+(o.startsWith("/")?o:`/${o}`);t&&(c=(({path:e,url:t})=>{let r=t,i=t.match(n);if(i)for(let t of i){let n=!1,i=t.substring(1,t.length-1),o="simple";i.endsWith("*")&&(n=!0,i=i.substring(0,i.length-1)),i.startsWith(".")?(i=i.substring(1),o="label"):i.startsWith(";")&&(i=i.substring(1),o="matrix");let c=e[i];null!=c&&(r=Array.isArray(c)?r.replace(t,l({explode:n,name:i,style:o,value:c})):"object"!=typeof c?"matrix"!==o?r.replace(t,"label"===o?`.${c}`:c):r.replace(t,`;${a({name:i,value:c})}`):r.replace(t,s({explode:n,name:i,style:o,value:c})))}return r})({path:t,url:c}));let u=r?i(r):"";return u.startsWith("?")&&(u=u.substring(1)),u&&(c+=`?${u}`),c},c=(e,t)=>{let r={...e,...t};return r.baseUrl?.endsWith("/")&&(r.baseUrl=r.baseUrl.substring(0,r.baseUrl.length-1)),r.headers=u(e.headers,t.headers),r},u=(...e)=>{let t=new Headers;for(let r of e)if(r&&"object"==typeof r)for(let[e,n]of r instanceof Headers?r.entries():Object.entries(r))if(null===n)t.delete(e);else if(Array.isArray(n))for(let r of n)t.append(e,r);else void 0!==n&&t.set(e,"object"==typeof n?JSON.stringify(n):n);return t};class d{_fns;constructor(){this._fns=[]}eject(e){let t=this._fns.indexOf(e);-1!==t&&(this._fns=[...this._fns.slice(0,t),...this._fns.slice(t+1)])}use(e){this._fns=[...this._fns,e]}}let f={bodySerializer:e=>JSON.stringify(e)},m=(e,t,r)=>{"string"==typeof r?e.append(t,r):e.append(t,JSON.stringify(r))},h={bodySerializer:e=>{let t=new URLSearchParams;return Object.entries(e).forEach(([e,r])=>{null!=r&&(Array.isArray(r)?r.forEach(r=>m(t,e,r)):m(t,e,r))}),t}},p=i({allowReserved:!1,array:{explode:!0,style:"form"},object:{explode:!0,style:"deepObject"}}),x={"Content-Type":"application/json"},b=(e={})=>({...f,baseUrl:"",fetch:globalThis.fetch,headers:x,parseAs:"auto",querySerializer:p,...e}),v=(e={})=>{let t=c(b(),e),r=()=>({...t}),n={request:new d,response:new d},a=async e=>{let r={...t,...e,headers:u(t.headers,e.headers)};r.body&&r.bodySerializer&&(r.body=r.bodySerializer(r.body)),r.body||r.headers.delete("Content-Type");let a=new Request(o({baseUrl:r.baseUrl??"",path:r.path,query:r.query,querySerializer:"function"==typeof r.querySerializer?r.querySerializer:i(r.querySerializer),url:r.url}),{redirect:"follow",...r});for(let e of n.request._fns)a=await e(a,r);let l=r.fetch,s=await l(a);for(let e of n.response._fns)s=await e(s,a,r);let c={request:a,response:s};if(s.ok){if(204===s.status||"0"===s.headers.get("Content-Length"))return{data:{},...c};if("stream"===r.parseAs)return{data:s.body,...c};let e=("auto"===r.parseAs?(e=>{if(e)return e.startsWith("application/json")||e.endsWith("+json")?"json":"multipart/form-data"===e?"formData":["application/","audio/","image/","video/"].some(t=>e.startsWith(t))?"blob":e.startsWith("text/")?"text":void 0})(s.headers.get("Content-Type")):r.parseAs)??"json",t=await s[e]();return"json"===e&&r.responseTransformer&&(t=await r.responseTransformer(t)),{data:t,...c}}let d=await s.text();if(r.throwOnError)throw Error(d);try{d=JSON.parse(d)}catch{}return{error:d||{},...c}};return{connect:e=>a({...e,method:"CONNECT"}),delete:e=>a({...e,method:"DELETE"}),get:e=>a({...e,method:"GET"}),getConfig:r,head:e=>a({...e,method:"HEAD"}),interceptors:n,options:e=>a({...e,method:"OPTIONS"}),patch:e=>a({...e,method:"PATCH"}),post:e=>a({...e,method:"POST"}),put:e=>a({...e,method:"PUT"}),request:a,setConfig:e=>(t=c(t,e),r()),trace:e=>a({...e,method:"TRACE"})}}}},function(e){e.O(0,[676,753,254,268,563,79,971,117,744],function(){return e(e.s=1814)}),_N_E=e.O()}]);