(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3175],{1814:function(e,t,r){Promise.resolve().then(r.bind(r,1130))},1130:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(7437),l=r(2265),a=r(8079),o=r(9376),i=r(1273),s=r(3510),u=r(6870);function c(){let e=(0,o.useSearchParams)(),t=(0,o.useRouter)(),r=(0,u.Y)(),[c,d]=(0,l.useState)([]),f=async()=>{d((await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind))};(0,l.useEffect)(()=>{if(void 0===navigator.mediaDevices){console.log("navigator.mediaDevices is undefined");return}f(),navigator.mediaDevices.ondevicechange=f;let e=c.find(e=>e.label.includes("AirPods"));e&&m(e.deviceId)},[]),(0,l.useEffect)(()=>{let e=setInterval(()=>{f()},1e3);return()=>clearInterval(e)},[]);let{selectedMic:p,acquireMic:m,isVoiceDetected:h}=(0,s.Z)({recordingChunkSize:100}),[v,b]=(0,l.useState)(!1),[g,y]=(0,l.useState)("Beginner"),[w,x]=(0,l.useState)(!1),j=(e,n,l)=>{x(!0),(0,a.oY)({path:{service:"ws"},query:{tutoring_id:e,lesson_id:n,mode:l}}).then(e=>{e.data&&(r.resume(),t.push("/call?session_id=".concat(e.data.session_id)))}).catch(e=>{console.error(e)})};return(0,l.useEffect)(()=>{j(e.get("tutoring_id"),e.get("lesson_id"),g)}),(0,n.jsxs)("main",{className:"flex flex-col bg-[#FAFBFF] h-screen-safe pt-5 justify-between tracking-[-0.02em]",children:[(0,n.jsx)("div",{className:"flex flex-col items-center w-full pb-6 px-7",children:(0,n.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,n.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{t.push("/")},children:(0,n.jsx)(i._0w,{className:"text-xl"})}),(0,n.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{},children:(0,n.jsx)(i.kvo,{className:"text-xl"})})]})}),(0,n.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,n.jsx)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto  pb-10 pt-6 border-black/10 border-t-2 bg-white\n              ",children:(0,n.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{j(e.get("tutoring_id"),e.get("lesson_id"),g)},children:w?(0,n.jsx)(i.fCD,{className:"animate-spin"}):(0,n.jsx)("p",{className:"font-medium text-lg",children:"Start"})})})})]})}},9856:function(e,t,r){"use strict";r.d(t,{H4:function(){return o},It:function(){return i},Lp:function(){return l},Vz:function(){return c},_5:function(){return s},eU:function(){return a},oY:function(){return d},zW:function(){return u}});var n=r(5478);let l=(0,n.eI)((0,n._g)()),a=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,...n.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},o=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).patch({...e,url:"/change_login"})},i=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/user/my_data"})},s=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).patch({...e,url:"/user/change_profile"})},u=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/tutoring/all"})},c=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/tutoring/leaderboard"})},d=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,url:"/call/start/{service}"})}},6870:function(e,t,r){"use strict";r.d(t,{GlobalAudioContextProvider:function(){return o},Y:function(){return i}});var n=r(7437),l=r(2265);let a=(0,l.createContext)(null),o=e=>{let{children:t}=e,r=(0,l.useRef)(null);return r.current||(console.log("creating audio context"),r.current=new(window.AudioContext||window.webkitAudioContext)),(0,n.jsx)(a.Provider,{value:r.current,children:t})},i=()=>{let e=(0,l.useContext)(a);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},3510:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(2265),l=r(9800),a=r(3974),o=r(6870);function i(e){let{onSpeechStart:t,onSpeechEnd:r,onAudioData:i,onRecordingStart:s,onRecordingStop:u,micVolume:c=1,recordingChunkSize:d}=e,f=(0,o.Y)(),p=(0,n.useRef)(null),m=(0,n.useRef)(null),h=(0,n.useRef)(null),v=(0,n.useRef)(null),b=(0,n.useRef)(!1),[g,y]=(0,n.useState)(!1),w=(0,n.useRef)(!1),[x,j]=(0,a.useLocalStorage)("selectedMic",null),[O,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{g?C():h.current&&R()},[g]);let E=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=e&&e!==x;if(e?j(e):e=x,!n){if(b.current){console.log("Mic already being acquired");return}if(p.current&&m.current&&h.current){console.log("Mic already acquired");return}}_(),b.current=!0;try{p.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}}),console.log("Mic acquired",e);let n=p.current.getAudioTracks()[0].getSettings().deviceId;j(null!=n?n:null);let a=f.createMediaStreamSource(p.current);m.current=f.createGain(),a.connect(m.current),m.current.gain.value=c;let o=f.createMediaStreamDestination();m.current.connect(o),h.current=new MediaRecorder(o.stream),v.current=await l.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:p.current,onSpeechStart:()=>{S(!0),null==t||t()},onVADMisfire:()=>{S(!1),null==r||r(!0)},onSpeechEnd:()=>{S(!1),null==r||r(!1)},positiveSpeechThreshold:.5,negativeSpeechThreshold:.35}),v.current.start()}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){console.log("User denied microphone access"),alert("Please allow microphone access to use this feature.");return}console.error("Error accessing microphone:",e),alert("Error accessing microphone: "+e);return}finally{b.current=!1}},C=async()=>{h.current||await E(),h.current&&(h.current.ondataavailable=e=>{null==i||i(e.data)},h.current.onstart=()=>{null==s||s()},h.current.onstop=()=>{null==u||u(w.current)},w.current=!1,await h.current.start(d))},R=()=>{h.current&&h.current.stop()},_=()=>{R(),p.current&&(p.current.getTracks().forEach(e=>{var t;e.stop(),null===(t=p.current)||void 0===t||t.removeTrack(e)}),p.current=null,console.log("Mic released")),m.current&&(m.current.disconnect(),m.current=null),h.current&&(h.current.stop(),h.current=null),v.current&&(O&&(S(!1),null==r||r(!1)),v.current.destroy(),v.current=null)};return(0,n.useEffect)(()=>{m.current&&(m.current.gain.value=c)},[c]),(0,n.useEffect)(()=>(console.log("Acquiring mic on mount"),E(),()=>{console.log("Releasing mic on unmount"),_()}),[]),{isRecording:g,setRecording:y,cancelRecording:()=>{w.current=!0,y(!1)},acquireMic:E,releaseMic:_,selectedMic:x,isVoiceDetected:O}}},5478:function(e,t,r){"use strict";r.d(t,{RL:function(){return m},_g:function(){return b},eI:function(){return g}});let n=/\{[^{}]+\}/g,l=({allowReserved:e,name:t,value:r})=>{if(null==r)return"";if("object"==typeof r)throw Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${e?r:encodeURIComponent(r)}`},a=({allowReserved:e,explode:t,name:r,style:n,value:a})=>{if(!t){let t=(e?a:a.map(e=>encodeURIComponent(e))).join((e=>{switch(e){case"form":default:return",";case"pipeDelimited":return"|";case"spaceDelimited":return"%20"}})(n));switch(n){case"label":return`.${t}`;case"matrix":return`;${r}=${t}`;case"simple":return t;default:return`${r}=${t}`}}let o=(e=>{switch(e){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(n),i=a.map(t=>"label"===n||"simple"===n?e?t:encodeURIComponent(t):l({allowReserved:e,name:r,value:t})).join(o);return"label"===n||"matrix"===n?o+i:i},o=({allowReserved:e,explode:t,name:r,style:n,value:a})=>{if(a instanceof Date)return`${r}=${a.toISOString()}`;if("deepObject"!==n&&!t){let t=[];Object.entries(a).forEach(([r,n])=>{t=[...t,r,e?n:encodeURIComponent(n)]});let l=t.join(",");switch(n){case"form":return`${r}=${l}`;case"label":return`.${l}`;case"matrix":return`;${r}=${l}`;default:return l}}let o=(e=>{switch(e){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(n),i=Object.entries(a).map(([t,a])=>l({allowReserved:e,name:"deepObject"===n?`${r}[${t}]`:t,value:a})).join(o);return"label"===n||"matrix"===n?o+i:i},i=({allowReserved:e,array:t,object:r}={})=>n=>{let i=[];if(n&&"object"==typeof n)for(let s in n){let u=n[s];null!=u&&(i=Array.isArray(u)?[...i,a({allowReserved:e,explode:!0,name:s,style:"form",value:u,...t})]:"object"!=typeof u?[...i,l({allowReserved:e,name:s,value:u})]:[...i,o({allowReserved:e,explode:!0,name:s,style:"deepObject",value:u,...r})])}return i.join("&")},s=({baseUrl:e,path:t,query:r,querySerializer:i,url:s})=>{let u=e+(s.startsWith("/")?s:`/${s}`);t&&(u=(({path:e,url:t})=>{let r=t,i=t.match(n);if(i)for(let t of i){let n=!1,i=t.substring(1,t.length-1),s="simple";i.endsWith("*")&&(n=!0,i=i.substring(0,i.length-1)),i.startsWith(".")?(i=i.substring(1),s="label"):i.startsWith(";")&&(i=i.substring(1),s="matrix");let u=e[i];null!=u&&(r=Array.isArray(u)?r.replace(t,a({explode:n,name:i,style:s,value:u})):"object"!=typeof u?"matrix"!==s?r.replace(t,"label"===s?`.${u}`:u):r.replace(t,`;${l({name:i,value:u})}`):r.replace(t,o({explode:n,name:i,style:s,value:u})))}return r})({path:t,url:u}));let c=r?i(r):"";return c.startsWith("?")&&(c=c.substring(1)),c&&(u+=`?${c}`),u},u=(e,t)=>{let r={...e,...t};return r.baseUrl?.endsWith("/")&&(r.baseUrl=r.baseUrl.substring(0,r.baseUrl.length-1)),r.headers=c(e.headers,t.headers),r},c=(...e)=>{let t=new Headers;for(let r of e)if(r&&"object"==typeof r)for(let[e,n]of r instanceof Headers?r.entries():Object.entries(r))if(null===n)t.delete(e);else if(Array.isArray(n))for(let r of n)t.append(e,r);else void 0!==n&&t.set(e,"object"==typeof n?JSON.stringify(n):n);return t};class d{_fns;constructor(){this._fns=[]}eject(e){let t=this._fns.indexOf(e);-1!==t&&(this._fns=[...this._fns.slice(0,t),...this._fns.slice(t+1)])}use(e){this._fns=[...this._fns,e]}}let f={bodySerializer:e=>JSON.stringify(e)},p=(e,t,r)=>{"string"==typeof r?e.append(t,r):e.append(t,JSON.stringify(r))},m={bodySerializer:e=>{let t=new URLSearchParams;return Object.entries(e).forEach(([e,r])=>{null!=r&&(Array.isArray(r)?r.forEach(r=>p(t,e,r)):p(t,e,r))}),t}},h=i({allowReserved:!1,array:{explode:!0,style:"form"},object:{explode:!0,style:"deepObject"}}),v={"Content-Type":"application/json"},b=(e={})=>({...f,baseUrl:"",fetch:globalThis.fetch,headers:v,parseAs:"auto",querySerializer:h,...e}),g=(e={})=>{let t=u(b(),e),r=()=>({...t}),n={request:new d,response:new d},l=async e=>{let r={...t,...e,headers:c(t.headers,e.headers)};r.body&&r.bodySerializer&&(r.body=r.bodySerializer(r.body)),r.body||r.headers.delete("Content-Type");let l=new Request(s({baseUrl:r.baseUrl??"",path:r.path,query:r.query,querySerializer:"function"==typeof r.querySerializer?r.querySerializer:i(r.querySerializer),url:r.url}),{redirect:"follow",...r});for(let e of n.request._fns)l=await e(l,r);let a=r.fetch,o=await a(l);for(let e of n.response._fns)o=await e(o,l,r);let u={request:l,response:o};if(o.ok){if(204===o.status||"0"===o.headers.get("Content-Length"))return{data:{},...u};if("stream"===r.parseAs)return{data:o.body,...u};let e=("auto"===r.parseAs?(e=>{if(e)return e.startsWith("application/json")||e.endsWith("+json")?"json":"multipart/form-data"===e?"formData":["application/","audio/","image/","video/"].some(t=>e.startsWith(t))?"blob":e.startsWith("text/")?"text":void 0})(o.headers.get("Content-Type")):r.parseAs)??"json",t=await o[e]();return"json"===e&&r.responseTransformer&&(t=await r.responseTransformer(t)),{data:t,...u}}let d=await o.text();if(r.throwOnError)throw Error(d);try{d=JSON.parse(d)}catch{}return{error:d||{},...u}};return{connect:e=>l({...e,method:"CONNECT"}),delete:e=>l({...e,method:"DELETE"}),get:e=>l({...e,method:"GET"}),getConfig:r,head:e=>l({...e,method:"HEAD"}),interceptors:n,options:e=>l({...e,method:"OPTIONS"}),patch:e=>l({...e,method:"PATCH"}),post:e=>l({...e,method:"POST"}),put:e=>l({...e,method:"PUT"}),request:l,setConfig:e=>(t=u(t,e),r()),trace:e=>l({...e,method:"TRACE"})}}},6231:function(e,t,r){"use strict";r.d(t,{w_:function(){return c}});var n=r(2265),l={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=n.createContext&&n.createContext(l),o=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){var n,l;n=t,l=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e){return t=>n.createElement(d,i({attr:u({},e.attr)},t),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,u({key:r},t.attr),e(t.child)))}(e.child))}function d(e){var t=t=>{var r,{attr:l,size:a,title:s}=e,c=function(e,t){if(null==e)return{};var r,n,l=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(l[r]=e[r])}return l}(e,o),d=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,l,c,{className:r,style:u(u({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),s&&n.createElement("title",null,s),e.children)};return void 0!==a?n.createElement(a.Consumer,null,e=>t(e)):t(l)}}},function(e){e.O(0,[7240,4753,254,5563,8079,2971,2117,1744],function(){return e(e.s=1814)}),_N_E=e.O()}]);