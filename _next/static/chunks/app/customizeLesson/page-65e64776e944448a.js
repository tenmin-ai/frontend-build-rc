(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{1814:function(e,t,r){Promise.resolve().then(r.bind(r,1562))},1562:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(7437),l=r(2265),a=r(6662),s=r(2374),c=r(6463),o=r(6920),i=r(5079),u=r(2792);function d(){let e=(0,c.useSearchParams)(),t=(0,c.useRouter)(),[r,d]=(0,l.useState)([]);(0,l.useEffect)(()=>{navigator.mediaDevices.enumerateDevices().then(e=>{d(e.filter(e=>"audioinput"===e.kind))})},[]);let[f,h]=(0,l.useState)(!1),{selectedMic:m,acquireMic:p}=(0,u.Z)({onSpeechStart:()=>h(!0),onSpeechEnd:()=>h(!1),recordingChunkSize:100}),{startSpeaker:x}=(0,s.Z)({}),[v,b]=(0,l.useState)("Beginner"),[g,y]=(0,l.useState)(!1),w=(e,r,n)=>{y(!0),(0,a.oY)({path:{service:"ws"},query:{tutoring_id:e,lesson_id:r,mode:n}}).then(e=>{e.data&&(x(),t.push("/call?session_id=".concat(e.data.session_id)))}).catch(e=>{console.error(e)})};return(0,n.jsxs)("main",{className:"flex flex-col bg-gradient-to-b from-[#F6F8FF] to-[#F7F8FD] h-screen pt-5 justify-between tracking-[-0.02em]",children:[(0,n.jsx)("div",{className:"flex flex-col items-center w-full pb-6 px-7",children:(0,n.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,n.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{t.push("/")},children:(0,n.jsx)(o.G,{icon:i.g82,className:"text-xl"})}),(0,n.jsx)("div",{className:"font-medium pt-1",children:" Select conversation level"}),(0,n.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{},children:(0,n.jsx)(o.G,{icon:i.cRF,className:"text-xl"})})]})}),(0,n.jsx)("div",{className:"overflow-y-auto",children:e.get("tutoring_id")&&e.get("lesson_id")?(0,n.jsxs)("div",{className:"flex flex-col gap-5 px-7",children:[(0,n.jsx)("div",{className:"flex flex-col items-center justify-center h-full w-full gap-4 pb-28",children:[{name:"Beginner",value:"Beginner",description:"We give you all the cheats!",emoji:"\uD83D\uDC66\uD83C\uDFFB",activated:!0},{name:"Intermediate",value:"Intermediate",description:"Can you deal without translations?",emoji:"\uD83C\uDFEB",activated:!0},{name:"Advanced",value:"Advanced",description:"No more training wheels!",emoji:"\uD83D\uDC69\uD83C\uDFFB‍\uD83C\uDF93",activated:!0},{name:"Native (Experimental)",value:"Realtime",description:"Real time conversation like a native!",emoji:"\uD83E\uDDD0",activated:!0}].map(e=>(0,n.jsxs)("button",{className:"text-base border-[1px] py-4 px-7 rounded-lg w-full flex gap-3 items-center ".concat(v===e.value?"bg-[#0039FF]/5 border-[#0039FF] text-[#0039FF]":"bg-white border-black/10"," ").concat(!e.activated&&"opacity-50"),onClick:()=>{e.activated&&b(e.value)},children:[(0,n.jsx)("p",{className:"text-2xl mr-3",children:e.emoji}),(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("p",{className:"font-medium",children:e.name}),(0,n.jsx)("p",{className:"text-black/50 font-light text-sm",children:e.description})]})]},e.value))}),(0,n.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,n.jsx)("h1",{className:"font-bold text-2xl text-black",children:"Select a microphone"}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:r.map(e=>(0,n.jsx)("button",{className:"flex items-center justify-between py-3 px-3 w-full rounded-lg font-semibold bg-white border ".concat(m==e.deviceId?"border-[#0039FF]":""),onClick:()=>{p(e.deviceId)},children:(0,n.jsx)("p",{className:"text-sm",children:e.label})},e.deviceId))})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-5 items-center",children:[(0,n.jsx)("p",{children:"Try speaking to test your microphone"}),(0,n.jsx)("div",{className:"flex items-center justify-center rounded-full h-16 w-16 ".concat(f?"bg-[#0039FF]":"bg-black/10"),children:(0,n.jsx)(o.G,{icon:i.UOM,className:"text-white text-2xl"})})]})]}):(0,n.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,n.jsx)("h1",{className:"font-bold text-2xl text-black",children:"No Lesson Found"}),(0,n.jsx)("p",{className:"text-gray-500",children:"No lesson found to start."})]})}),(0,n.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,n.jsx)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto  pb-10 pt-6 border-black/10 border-t-2 bg-white\n              ",children:(0,n.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{w(e.get("tutoring_id"),e.get("lesson_id"),v)},children:g?(0,n.jsx)(o.G,{className:"animate-spin",icon:i.LM3}):(0,n.jsx)("p",{className:"font-medium text-lg",children:"Start"})})})})]})}},2792:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(2265),l=r(68),a=r(3061);function s(e){let{onSpeechStart:t,onSpeechEnd:r,onAudioData:s,onRecordingStart:c,onRecordingStop:o,micVolume:i=1,recordingChunkSize:u}=e,d=(0,n.useRef)(null),f=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)(null),[p,x]=(0,n.useState)(!1),v=(0,n.useRef)(!1),[b,g]=(0,a.useLocalStorage)("selectedMic",null);(0,n.useEffect)(()=>{p?w():h.current&&j()},[p]);let y=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;void 0!==e?g(e):e=b,d.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}});let n=new AudioContext,a=n.createMediaStreamSource(d.current);f.current=n.createGain(),a.connect(f.current),f.current.gain.value=i;let s=n.createMediaStreamDestination();f.current.connect(s),h.current=new MediaRecorder(s.stream),m.current=await l.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:d.current,onSpeechStart:()=>{null==t||t()},onVADMisfire:()=>{null==r||r(!0)},onSpeechEnd:()=>{null==r||r(!1)},positiveSpeechThreshold:.7,negativeSpeechThreshold:.35}),m.current.start()},w=async()=>{if(!h.current)try{await y()}catch(e){console.error("Error accessing microphone:",e)}h.current&&(h.current.ondataavailable=e=>{null==s||s(e.data)},h.current.onstart=()=>{null==c||c()},h.current.onstop=()=>{null==o||o(v.current)},v.current=!1,await h.current.start(u))},j=()=>{h.current&&h.current.stop()},N=()=>{j(),h.current&&(h.current=null),f.current&&(f.current.disconnect(),f.current=null),d.current&&(d.current.getTracks().forEach(e=>e.stop()),d.current=null),m.current&&(m.current.destroy(),m.current=null)};return(0,n.useEffect)(()=>{f.current&&(f.current.gain.value=i)},[i]),(0,n.useEffect)(()=>(y(),N),[]),{isRecording:p,setRecording:x,cancelRecording:()=>{v.current=!0,x(!1)},acquireMic:y,releaseMic:N,selectedMic:b}}},2374:function(e,t,r){"use strict";r.d(t,{GlobalAudioContextProvider:function(){return c},Z:function(){return o}});var n=r(7437),l=r(2265),a=r(4031);let s=(0,l.createContext)(void 0),c=e=>{let{children:t}=e,r=new(window.AudioContext||window.webkitAudioContext);return(0,n.jsx)(s.Provider,{value:{audioContext:r},children:t})};function o(e){let{onPlaybackChange:t,volume:r=1,speed:n=1}=e,c=(0,l.useContext)(a.Dm),o=(0,l.useContext)(s),i=(0,l.useRef)(null),u=(0,l.useRef)([]),d=(0,l.useRef)(0),f=(0,l.useRef)(null),h=(0,l.useRef)([]),m=(0,l.useRef)(null),p=(0,l.useRef)(null),[x,v]=(0,l.useState)(!1),[b,g]=(0,l.useState)(!1),[y,w]=(0,l.useState)(null),[j,N]=(0,l.useState)(null),S=(0,l.useRef)(null),C=()=>{if(h.current.forEach(e=>{clearTimeout(e)}),h.current=[],f.current&&(clearTimeout(f.current),f.current=null),0===u.current.length)return;let e=1,t=u.current.slice(0,1);for(let r of t)if(r&&r.buffer){let t=r.buffer.getChannelData(0);for(let r=0;r<t.length;r++)t[r]=t[r]*e,e-=1/(1*t.length)}u.current.slice(1).forEach(e=>{e.stop()}),u.current=t},R=()=>{v(!1),g(!1),h.current=[],S.current=null},E=async e=>{let{i:t,data:r,id:l,t:a}=e;if(null===i.current){console.error("AudioContext not initialized!");return}let s=new Int16Array(r),c=i.current.createBuffer(1,s.length,24e3),o=c.getChannelData(0);for(let e=0;e<s.length;e++)o[e]=s[e]/32768;let p=i.current.createBufferSource();p.connect(m.current),p.playbackRate.value=n,p.buffer=c;let x=0==t;x&&(u.current.length>0&&C(),d.current=i.current.currentTime);let b=d.current+.1*t/n+.1,y=i.current.currentTime-b;if(y>0&&(console.log("Audio chunk is late, delaying playback by ".concat(y," seconds.")),b+=y,d.current+=y),p.start(b),u.current.push(p),x&&(f.current=setTimeout(()=>{v(!0),N(0),void 0==l&&console.error("First chunk must have an id"),w(l),f.current=null},-(1e3*y))),p.onended=()=>{u.current.length>0&&(u.current.shift(),g(!1)),S.current&&t==S.current-1?R():0===u.current.length&&g(!0)},void 0!=a){let e=h.current.length,t=i.current.currentTime,r=a.map((r,l)=>setTimeout(()=>N(e+l),1e3*(d.current+r-t)/n));h.current.push(...r)}};return(0,l.useEffect)(()=>{if(!c){console.error("No session found!");return}return c.registerEvent("TTS_CHUNK",E),c.registerEvent("TTS_INTERRUPT",()=>{C()}),c.registerEvent("TTS_END",e=>{let{id:t,len:r}=e;y!==t||x?S.current=r:R()}),()=>{null==c||c.deregisterEvent("TTS_CHUNK"),null==c||c.deregisterEvent("TTS_INTERRUPT"),null==c||c.deregisterEvent("TTS_END")}},[c,n]),(0,l.useEffect)(()=>{null==t||t(x,y)},[x]),(0,l.useEffect)(()=>{m.current&&(m.current.gain.value=r)},[r]),(0,l.useEffect)(()=>{p.current&&(p.current.parameters.get("pitchFactor").value=1/n)},[n]),{isPlaying:x,isLagging:b,latestAudioId:y,latestCharIndex:j,startSpeaker:()=>{null===i.current&&((null==o?void 0:o.audioContext)?i.current=o.audioContext:i.current=new(window.AudioContext||window.webkitAudioContext),i.current.resume(),m.current=i.current.createGain(),console.log("Gain node created"),i.current.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{p.current=new AudioWorkletNode(i.current,"phase-vocoder-processor"),m.current.connect(p.current),p.current.connect(i.current.destination),m.current.gain.value=r,p.current.parameters.get("pitchFactor").value=1/n,console.log("Phase vocoder worklet added")}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)}))}}}},8035:function(e,t,r){"use strict";r.d(t,{RL:function(){return m},_g:function(){return v},eI:function(){return b}});let n=/\{[^{}]+\}/g,l=({allowReserved:e,name:t,value:r})=>{if(null==r)return"";if("object"==typeof r)throw Error("Deeply-nested arrays/objects aren’t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${e?r:encodeURIComponent(r)}`},a=({allowReserved:e,explode:t,name:r,style:n,value:a})=>{if(!t){let t=(e?a:a.map(e=>encodeURIComponent(e))).join((e=>{switch(e){case"form":default:return",";case"pipeDelimited":return"|";case"spaceDelimited":return"%20"}})(n));switch(n){case"label":return`.${t}`;case"matrix":return`;${r}=${t}`;case"simple":return t;default:return`${r}=${t}`}}let s=(e=>{switch(e){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(n),c=a.map(t=>"label"===n||"simple"===n?e?t:encodeURIComponent(t):l({allowReserved:e,name:r,value:t})).join(s);return"label"===n||"matrix"===n?s+c:c},s=({allowReserved:e,explode:t,name:r,style:n,value:a})=>{if(a instanceof Date)return`${r}=${a.toISOString()}`;if("deepObject"!==n&&!t){let t=[];Object.entries(a).forEach(([r,n])=>{t=[...t,r,e?n:encodeURIComponent(n)]});let l=t.join(",");switch(n){case"form":return`${r}=${l}`;case"label":return`.${l}`;case"matrix":return`;${r}=${l}`;default:return l}}let s=(e=>{switch(e){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}})(n),c=Object.entries(a).map(([t,a])=>l({allowReserved:e,name:"deepObject"===n?`${r}[${t}]`:t,value:a})).join(s);return"label"===n||"matrix"===n?s+c:c},c=({allowReserved:e,array:t,object:r}={})=>n=>{let c=[];if(n&&"object"==typeof n)for(let o in n){let i=n[o];null!=i&&(c=Array.isArray(i)?[...c,a({allowReserved:e,explode:!0,name:o,style:"form",value:i,...t})]:"object"!=typeof i?[...c,l({allowReserved:e,name:o,value:i})]:[...c,s({allowReserved:e,explode:!0,name:o,style:"deepObject",value:i,...r})])}return c.join("&")},o=({baseUrl:e,path:t,query:r,querySerializer:c,url:o})=>{let i=e+(o.startsWith("/")?o:`/${o}`);t&&(i=(({path:e,url:t})=>{let r=t,c=t.match(n);if(c)for(let t of c){let n=!1,c=t.substring(1,t.length-1),o="simple";c.endsWith("*")&&(n=!0,c=c.substring(0,c.length-1)),c.startsWith(".")?(c=c.substring(1),o="label"):c.startsWith(";")&&(c=c.substring(1),o="matrix");let i=e[c];null!=i&&(r=Array.isArray(i)?r.replace(t,a({explode:n,name:c,style:o,value:i})):"object"!=typeof i?"matrix"!==o?r.replace(t,"label"===o?`.${i}`:i):r.replace(t,`;${l({name:c,value:i})}`):r.replace(t,s({explode:n,name:c,style:o,value:i})))}return r})({path:t,url:i}));let u=r?c(r):"";return u.startsWith("?")&&(u=u.substring(1)),u&&(i+=`?${u}`),i},i=(e,t)=>{let r={...e,...t};return r.baseUrl?.endsWith("/")&&(r.baseUrl=r.baseUrl.substring(0,r.baseUrl.length-1)),r.headers=u(e.headers,t.headers),r},u=(...e)=>{let t=new Headers;for(let r of e)if(r&&"object"==typeof r)for(let[e,n]of r instanceof Headers?r.entries():Object.entries(r))if(null===n)t.delete(e);else if(Array.isArray(n))for(let r of n)t.append(e,r);else void 0!==n&&t.set(e,"object"==typeof n?JSON.stringify(n):n);return t};class d{_fns;constructor(){this._fns=[]}eject(e){let t=this._fns.indexOf(e);-1!==t&&(this._fns=[...this._fns.slice(0,t),...this._fns.slice(t+1)])}use(e){this._fns=[...this._fns,e]}}let f={bodySerializer:e=>JSON.stringify(e)},h=(e,t,r)=>{"string"==typeof r?e.append(t,r):e.append(t,JSON.stringify(r))},m={bodySerializer:e=>{let t=new URLSearchParams;return Object.entries(e).forEach(([e,r])=>{null!=r&&(Array.isArray(r)?r.forEach(r=>h(t,e,r)):h(t,e,r))}),t}},p=c({allowReserved:!1,array:{explode:!0,style:"form"},object:{explode:!0,style:"deepObject"}}),x={"Content-Type":"application/json"},v=(e={})=>({...f,baseUrl:"",fetch:globalThis.fetch,headers:x,parseAs:"auto",querySerializer:p,...e}),b=(e={})=>{let t=i(v(),e),r=()=>({...t}),n={request:new d,response:new d},l=async e=>{let r={...t,...e,headers:u(t.headers,e.headers)};r.body&&r.bodySerializer&&(r.body=r.bodySerializer(r.body)),r.body||r.headers.delete("Content-Type");let l=new Request(o({baseUrl:r.baseUrl??"",path:r.path,query:r.query,querySerializer:"function"==typeof r.querySerializer?r.querySerializer:c(r.querySerializer),url:r.url}),{redirect:"follow",...r});for(let e of n.request._fns)l=await e(l,r);let a=r.fetch,s=await a(l);for(let e of n.response._fns)s=await e(s,l,r);let i={request:l,response:s};if(s.ok){if(204===s.status||"0"===s.headers.get("Content-Length"))return{data:{},...i};if("stream"===r.parseAs)return{data:s.body,...i};let e=("auto"===r.parseAs?(e=>{if(e)return e.startsWith("application/json")||e.endsWith("+json")?"json":"multipart/form-data"===e?"formData":["application/","audio/","image/","video/"].some(t=>e.startsWith(t))?"blob":e.startsWith("text/")?"text":void 0})(s.headers.get("Content-Type")):r.parseAs)??"json",t=await s[e]();return"json"===e&&r.responseTransformer&&(t=await r.responseTransformer(t)),{data:t,...i}}let d=await s.text();if(r.throwOnError)throw Error(d);try{d=JSON.parse(d)}catch{}return{error:d||{},...i}};return{connect:e=>l({...e,method:"CONNECT"}),delete:e=>l({...e,method:"DELETE"}),get:e=>l({...e,method:"GET"}),getConfig:r,head:e=>l({...e,method:"HEAD"}),interceptors:n,options:e=>l({...e,method:"OPTIONS"}),patch:e=>l({...e,method:"PATCH"}),post:e=>l({...e,method:"POST"}),put:e=>l({...e,method:"PUT"}),request:l,setConfig:e=>(t=i(t,e),r()),trace:e=>l({...e,method:"TRACE"})}}}},function(e){e.O(0,[676,753,119,920,31,396,662,971,23,744],function(){return e(e.s=1814)}),_N_E=e.O()}]);