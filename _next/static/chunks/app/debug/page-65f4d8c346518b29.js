(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{8446:function(e,t,n){Promise.resolve().then(n.bind(n,3131))},3131:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n(7437),s=n(2265),l=n(4031),c=n(3061),a=n(7776),o=n(6463),i=n(40);function u(e){let{children:t}=e,n=(0,c.useIsClient)(),{token:s,saveToken:u}=(0,i.f)(),d=(0,o.useSearchParams)().get("session_id");return d?n?(0,r.jsx)(l.eA,{url:"wss://backend-us-rc.tenmin.ai/ws"+"/".concat(d)+"?token=".concat(s),label:"Debug Call",toast:a.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):(0,r.jsx)("div",{children:"Loading.."}):(0,r.jsx)("div",{children:"Invalid lesson"})}var d=n(6920),x=n(5079),f=n(2792),m=n(9728),p=n(7743),h=e=>{let{onStartPress:t,onEndPress:n,children:l}=e,[c,a]=(0,s.useState)(!1),o=e=>{"Space"!==e.code||e.repeat||(a(!0),t())},i=e=>{"Space"===e.code&&(a(!1),n())};return(0,s.useEffect)(()=>(window.addEventListener("keydown",o),window.addEventListener("keyup",i),()=>{window.removeEventListener("keydown",o),window.removeEventListener("keyup",i)}),[]),(0,r.jsx)("button",{onMouseDown:e=>{e.preventDefault(),a(!0),t()},onMouseUp:e=>{e.preventDefault(),a(!1),n()},children:l?l(c):"Press and Hold"})},b=n(357);function g(){let e=(0,l.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",speedPreference:"NORMAL"}),t=(0,l.MV)("STT",{totalTranscript:"",currTranscript:"",tempTranscript:""}),n=(0,l.MV)("CHAT",{messages:[]}),c=(0,l.MV)("TRANSLATION",{wordForWord:{},translations:{}}),o=(0,l.MV)("TTS",{captions:"",playbackTimestamp:null}),i=(0,l.MV)("AUTOCOMPLETE",{suggestions:[],transliterations:[],translations:[],wordForWord:[]}),u=(0,s.useContext)(l.Dm);(0,l.$o)(u,a.A);let[g,v]=(0,s.useState)(1),[T,N]=(0,s.useState)(!1),[j,S]=(0,s.useState)(!1);(0,s.useEffect)(()=>((async()=>{await p.P.keepAwake()})(),()=>{(async()=>{await p.P.allowSleep()})()}),[]);let[w,E]=(0,s.useState)(!1),{startSpeaker:y,isPlaying:k}=(0,m.Z)({onPlaybackChange:(e,t)=>{o.sendAction({type:e?"PLAYBACK_STARTED":"PLAYBACK_FINISHED",id:t})},volume:1,speed:g}),[A,C]=(0,s.useState)(!1),[R,D]=(0,s.useState)(600),[_,L]=(0,s.useState)(0),{isRecording:P,setRecording:F}=(0,f.Z)({onAudioData:e=>{(null==u?void 0:u.isConnected)?t.sendBinary({type:"STREAM_MIC"},e):console.log("Not sending audio data because not connected")},onSpeechStart:()=>{E(!0),t.sendAction({type:"VAD_CHANGED",detected:!0})},onSpeechEnd:()=>{E(!1),t.sendAction({type:"VAD_CHANGED",detected:!1})},micVolume:_});return(0,s.useEffect)(()=>{if(P&&R>0){let e=setInterval(()=>{D(e=>e-1)},1e3);return()=>clearInterval(e)}},[P,R]),(0,s.useEffect)(()=>{let e=document.getElementById("DEBUG_BOTTOM");e&&e.scrollIntoView({behavior:"smooth"})},[n.messages]),(0,r.jsxs)("div",{className:"flex flex-col justify-between h-full items-center tracking-[-0.02em] px-7",children:[(b.env.NEXT_PUBLIC_DEBUG,(0,r.jsxs)("div",{className:"absolute z-50 w-2/3 h-2/3 bg-white/80 border-red-500 border flex flex-col text-black",children:[(0,r.jsx)("p",{className:"text-red-500 text-center",children:"DEBUG-A-TRON-5000"}),(0,r.jsxs)("div",{className:"flex flex-col gap-5 w-full h-full overflow-scroll text-left",children:[n&&n.messages&&n.messages.map((e,t)=>{var n;return(0,r.jsxs)("div",{className:"text-center border border-black bg-blue-500/30 m-3 p-3",children:[(0,r.jsx)("div",{children:null==e?void 0:null===(n=e.role)||void 0===n?void 0:n.toUpperCase()}),(0,r.jsx)("div",{className:"border border-black mb-3"}),(0,r.jsx)("pre",{className:"text-left text-wrap",children:null==e?void 0:e.content}),c.translations[t]&&(0,r.jsx)("div",{className:"border border-black mt-3 p-3 bg-green-500/30",children:c.translations[t]})]},t)}),(0,r.jsx)("div",{id:"DEBUG_BOTTOM"})]}),(0,r.jsxs)("div",{className:"mt-20 flex flex-row items-center gap-[2px]",children:["TRANSCRIPT:",(0,r.jsx)("span",{className:"text-gray-500 text-center inline",children:t.totalTranscript}),(0,r.jsx)("span",{className:"text-black text-center inline",children:t.currTranscript}),(0,r.jsx)("span",{className:"text-green-500 text-center inline",children:t.tempTranscript}),(0,r.jsx)("div",{className:"flex flex-col gap-1 ml-2",children:i.suggestions.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-row gap-2 items-center bg-blue-200 rounded-xl p-2",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-blue-700",children:["...",e]}),i.transliterations[t]&&(0,r.jsx)("span",{className:"text-sm italic text-gray-500",children:i.transliterations[t]})]}),i.translations[t]&&(0,r.jsxs)("span",{className:"text-sm text-black",children:["(",i.translations[t],")"]}),i.wordForWord[t]&&(0,r.jsx)("div",{className:"flex flex-row gap-1",children:i.wordForWord[t].map(e=>{let{original:t,translation:n}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1 place-items-center",children:[(0,r.jsx)("span",{className:"text-blue-700",children:t}),(0,r.jsx)("span",{className:"text-black text-sm",children:n})]})})})]},t))})]}),(0,r.jsxs)("div",{className:"flex flex-row gap-3",children:[(0,r.jsx)("button",{className:"border border-black bg-blue-500 p-2",onClick:()=>{F(!0),t.sendAction({type:"DEBUG:START"})},children:"START STT"}),(0,r.jsx)("button",{className:"border border-black bg-blue-500 p-2",onClick:()=>{F(!1),t.sendAction({type:"DEBUG:STOP"})},children:"STOP STT"})]}),(0,r.jsxs)("div",{children:["Mic Volume: ",_]}),(0,r.jsxs)("div",{className:"flex flex-row gap-3",children:[(0,r.jsx)("button",{className:"border border-black bg-blue-500 p-2",onClick:()=>{y(),o.sendAction({type:"TEST"})},children:"TEST TTS"}),(0,r.jsx)("button",{className:"border border-black bg-green-500 p-2",onClick:()=>{y(),o.sendAction({type:"SAY",text_stream:"Hi Jay"})},children:"Say Hi"}),(0,r.jsx)("input",{type:"range",min:"0.5",max:"1.5",step:"0.05",value:g,onChange:e=>v(parseFloat(e.target.value))}),(0,r.jsxs)("p",{children:["Playback Speed: ",g]}),(0,r.jsxs)("p",{children:["Current TTS Config: ",e.speedPreference]}),(0,r.jsx)("button",{onClick:()=>{e.sendAction({type:"DEBUG"})},children:"PRESS ME"})]})]})),(0,r.jsx)("div",{className:"flex flex-col items-center w-full ",children:(0,r.jsxs)("div",{className:"flex w-full justify-between items-center",children:[(0,r.jsx)("button",{className:"text-black/60 font-medium text-sm self-start flex items-center bg-black bg-opacity-[10%] w-12 h-12 justify-center rounded-full",onClick:()=>{C(!1),e.sendAction({type:"STOP_CALL"}),F(!1)},children:(0,r.jsx)(d.G,{icon:x.EOp})}),(0,r.jsxs)("button",{className:"flex flex-col items-center text-sm font-medium",onClick:()=>{e.sendAction({type:"SET_SPEED_PREFERENCE",speed:"SLOW"==e.speedPreference?"NORMAL":"SLOW"})},children:[(0,r.jsx)("div",{className:"text-black/30 ",children:"SLOW"}),(0,r.jsx)("div",{className:"".concat("SLOW"==e.speedPreference?"bg-[#0039FF]":"bg-black/30"," rounded-sm px-[2px] text-white"),children:"SLOW"==e.speedPreference?"ON":"OFF"})]})]})}),(0,r.jsxs)("div",{className:"flex flex-col items-center w-full h-full justify-end absolute bottom-0 gap-5 pb-14 tracking-[-0.02em] px-8 pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 px-8 pb-6 w-screen flex flex-col items-center transform transition-all duration-500",children:(0,r.jsxs)("div",{className:"w-full py-10    bg-white flex flex-col justify-center mt-10 rounded-xl items-center border-black/10 border-[1px] transition-all duration-500 pointer-events-auto",children:[(0,r.jsx)("img",{alt:"",className:"".concat(T?"w-10":"w-20"," ").concat(T?"self-start":""," transition-all duration-500 mx-[10%]")}),T?(0,r.jsxs)("div",{className:"px-[10%] mt-5",children:[(0,r.jsx)("p",{className:"font-medium",children:e.captions}),(0,r.jsx)("div",{className:"border-t-black/20 border-t-[1px] my-2"}),(0,r.jsx)("p",{className:"opacity-35",children:"Translations are coming soon! Stay tuned!"})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("p",{className:"pt-4 font-medium text-gray-800 text-xl ",children:"tutor"}),(0,r.jsx)("p",{className:" text-black/50 mt-1 text-center px-5 ",children:"lesson"})]})]})}),"CONNECTED"!==e.status?(0,r.jsx)("div",{className:"flex w-full gap-4 mt-6 pointer-events-auto",children:(0,r.jsx)("button",{className:" bg-[#0039FF] text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{A||(C(!0),e.sendAction({type:"START_CALL"}),y(),F(!0),N(!0))},children:A?(0,r.jsx)(d.G,{className:"animate-spin",icon:x.LM3}):(0,r.jsx)("p",{className:"font-medium text-lg",children:"Start"})})}):(0,r.jsxs)("div",{className:"pointer-events-auto flex gap-5 text-xl items-center bg-white px-5 py-3 rounded-full border-black/10 border-[1px]",children:[(0,r.jsx)(h,{onStartPress:()=>{P||F(!0),L(1),e.sendAction({type:"PTT_PRESSED"})},onEndPress:()=>{L(0),e.sendAction({type:"PTT_RELEASED"})},children:e=>(0,r.jsx)("div",{className:"bg-blue-300 rounded-xl p-3 ".concat(e?"bg-blue-800":""),children:"PUSH TO TALK (Hold Mouse or Spacebar)"})}),(0,r.jsx)("button",{className:"".concat(T?"text-[#0039FF] text-opacity-100 bg-[#0039FF] bg-opacity-10 ":"text-black text-opacity-50 bg-black bg-opacity-10 ","  text-2xl w-14 h-14 rounded-full"),onClick:()=>{N(!T)},children:(0,r.jsx)(d.G,{icon:x.uKJ})}),"CONNECTED"!==e.status?(0,r.jsx)("button",{className:" bg-[#0039FF] text-white font-bold px-4 h-[3.6rem] rounded-full flex items-center justify-center",onClick:()=>{A||(C(!0),e.sendAction({type:"START_CALL"}),y(),F(!0),N(!0))},children:A?(0,r.jsx)(d.G,{className:"animate-spin",icon:x.LM3}):(0,r.jsx)("p",{className:"font-medium text-lg",children:"Start"})}):(0,r.jsx)("button",{className:"bg-[#EA0038] text-white text-opacity-95 font-bold w-[3.6rem] h-[3.6rem] rounded-full flex items-center justify-center",onClick:()=>{C(!1),e.sendAction({type:"STOP_CALL"}),F(!1),N(!1)},children:(0,r.jsx)(d.G,{icon:x.j1w,className:"rotate-[135deg]"})})]})]})]})}function v(){return(0,r.jsx)(u,{children:(0,r.jsxs)("main",{className:"bg-gradient-to-b from-[#F6F8FF] to-[#F7F8FD] h-screen pb-14 pt-7",children:[(0,r.jsx)(g,{}),(0,r.jsx)(a.x,{position:"top-center",richColors:!0})]})})}},2792:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(2265),s=n(68);function l(e){let{onSpeechStart:t,onSpeechEnd:n,onAudioData:l,onRecordingStart:c,onRecordingStop:a,micVolume:o=1,recordingChunkSize:i}=e,u=(0,r.useRef)(null),d=(0,r.useRef)(null),x=(0,r.useRef)(null),f=(0,r.useRef)(null),[m,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{m?b():x.current&&g()},[m]);let h=async()=>{u.current=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0}});let e=new AudioContext,r=e.createMediaStreamSource(u.current);d.current=e.createGain(),r.connect(d.current),d.current.gain.value=o;let l=e.createMediaStreamDestination();d.current.connect(l),x.current=new MediaRecorder(l.stream),f.current=await s.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:u.current,onSpeechStart:()=>{console.log("User started talking"),null==t||t()},onVADMisfire:()=>{console.log("Nvm, user didn't start talking"),null==n||n(!0)},onSpeechEnd:e=>{console.log("User stopped talking"),null==n||n(!1)},positiveSpeechThreshold:.7,negativeSpeechThreshold:.35}),f.current.start()},b=async()=>{if(!x.current)try{await h()}catch(e){console.error("Error accessing microphone:",e)}x.current&&(x.current.ondataavailable=e=>{null==l||l(e.data)},x.current.onstart=()=>{null==c||c()},x.current.onstop=()=>{null==a||a()},await x.current.start(i))},g=()=>{x.current&&x.current.stop()};return(0,r.useEffect)(()=>{d.current&&(d.current.gain.value=o)},[o]),{isRecording:m,setRecording:p,acquireMic:h,releaseMic:()=>{g(),x.current&&(x.current=null),d.current&&(d.current.disconnect(),d.current=null),u.current&&(u.current.getTracks().forEach(e=>e.stop()),u.current=null),f.current&&(f.current.destroy(),f.current=null)}}}},40:function(e,t,n){"use strict";n.d(t,{f:function(){return s}});var r=n(3061);let s=()=>{let[e,t]=(0,r.useLocalStorage)("token");return{token:e,saveToken:t}}},9728:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(2265),s=n(4031);function l(e){let{onPlaybackChange:t,volume:n=1,speed:l=1}=e,c=(0,r.useContext)(s.Dm),a=(0,r.useRef)(null),o=(0,r.useRef)([]),i=(0,r.useRef)(0),u=(0,r.useRef)(null),d=(0,r.useRef)([]),x=(0,r.useRef)(null),f=(0,r.useRef)(null),[m,p]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!1),[g,v]=(0,r.useState)(null),[T,N]=(0,r.useState)(null),j=(0,r.useRef)(null),S=()=>{if(d.current.forEach(e=>{clearTimeout(e)}),d.current=[],u.current&&(clearTimeout(u.current),u.current=null),0===o.current.length)return;let e=1,t=o.current.slice(0,1);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(1*t.length)}o.current.slice(1).forEach(e=>{e.stop()}),o.current=t},w=()=>{p(!1),b(!1),d.current=[],j.current=null},E=async e=>{let{i:t,data:n,id:r,t:s}=e;if(null===a.current){console.error("AudioContext not initialized!");return}let c=new Int16Array(n),f=a.current.createBuffer(1,c.length,24e3),m=f.getChannelData(0);for(let e=0;e<c.length;e++)m[e]=c[e]/32768;let h=a.current.createBufferSource();h.connect(x.current),h.playbackRate.value=l,h.buffer=f;let g=0==t;g&&(o.current.length>0&&S(),i.current=a.current.currentTime);let T=i.current+.1*t/l+.1,E=a.current.currentTime-T;if(E>0&&(console.log("Audio chunk is late, delaying playback by ".concat(E," seconds.")),T+=E,i.current+=E),h.start(T),o.current.push(h),g&&(u.current=setTimeout(()=>{p(!0),N(0),void 0==r&&console.error("First chunk must have an id"),v(r),u.current=null},-(1e3*E))),h.onended=()=>{o.current.length>0&&(o.current.shift(),b(!1)),j.current&&t==j.current-1?w():0===o.current.length&&b(!0)},void 0!=s){let e=d.current.length,t=a.current.currentTime,n=s.map((n,r)=>setTimeout(()=>N(e+r),1e3*(i.current+n-t)/l));d.current.push(...n)}};return(0,r.useEffect)(()=>{if(!c){console.error("No session found!");return}return c.registerEvent("TTS_CHUNK",E),c.registerEvent("TTS_INTERRUPT",()=>{console.log("TTS_INTERRUPT"),S()}),c.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;g!==t||m?j.current=n:w()}),()=>{null==c||c.deregisterEvent("TTS_CHUNK"),null==c||c.deregisterEvent("TTS_INTERRUPT"),null==c||c.deregisterEvent("TTS_END")}},[c,l]),(0,r.useEffect)(()=>{null==t||t(m,g)},[m]),(0,r.useEffect)(()=>{x.current&&(x.current.gain.value=n)},[n]),(0,r.useEffect)(()=>{f.current&&(f.current.parameters.get("pitchFactor").value=1/l)},[l]),{isPlaying:m,isLagging:h,latestAudioId:g,latestCharIndex:T,startSpeaker:()=>{null===a.current&&(a.current=new(window.AudioContext||window.webkitAudioContext),x.current=a.current.createGain(),a.current.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{f.current=new AudioWorkletNode(a.current,"phase-vocoder-processor"),x.current.connect(f.current),f.current.connect(a.current.destination),x.current.gain.value=n,f.current.parameters.get("pitchFactor").value=1/l}))}}}}},function(e){e.O(0,[676,753,119,920,87,971,23,744],function(){return e(e.s=8446)}),_N_E=e.O()}]);