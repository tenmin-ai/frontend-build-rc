(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{3658:function(e,t,n){Promise.resolve().then(n.bind(n,9862))},9862:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(7437),l=n(2265),s=n(4272),a=n(3974),c=n(3772),i=n(9376);let o=()=>{let[e,t]=(0,a.useLocalStorage)("token");return{token:e,saveToken:t}};function u(e){let{children:t}=e,n=(0,a.useIsClient)(),{token:l,saveToken:u}=o(),d=(0,i.useSearchParams)().get("session_id");return d?n?(0,r.jsx)(s.eA,{url:"wss://backend-us-rc.tenmin.ai/ws"+"/".concat(d)+"?token=".concat(l),label:"Debug Call",toast:c.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):(0,r.jsx)("div",{children:"Loading.."}):(0,r.jsx)("div",{children:"Invalid lesson"})}var d=n(1268),m=n(5095),x=n(755),f=n(9764);n(7354),n(6889);var h=n(3377),g=n(5217),p=n(3510),v=n(6870),j=n(5123),w=e=>{let{onStartPress:t,onEndPress:n,onCancel:s,cancelButtonRef:a,children:c}=e,[i,o]=(0,l.useState)(!1),u=(0,l.useRef)({x:0,y:0}),d=e=>{if(a.current){let t=a.current.getBoundingClientRect();return e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom}return!1};return(0,l.useEffect)(()=>{let e=e=>{var t,n;if(!i)return;let r=e.touches[0];d({x:r.clientX,y:r.clientY})?null===(t=a.current)||void 0===t||t.classList.add("scale-110","bg-red-300"):null===(n=a.current)||void 0===n||n.classList.remove("scale-110","bg-red-300")};return window.addEventListener("touchmove",e),()=>{window.removeEventListener("touchmove",e)}},[i,a]),(0,r.jsx)("button",{onTouchStart:e=>{e.preventDefault(),o(!0),t();let n=e.touches[0];u.current={x:n.clientX,y:n.clientY}},onTouchEnd:e=>{e.preventDefault(),o(!1);let t=e.changedTouches[0];d({x:t.clientX,y:t.clientY})?s():n()},onContextMenu:e=>e.preventDefault(),className:"microphoneButton",children:c?c(i):"Press and Hold"})};let y=e=>e||"â€‹";var N=n(3069);let b=e=>{var t,n;let{isOpen:l,onClose:s,detailedTranslation:a,isTTSPlaying:c,onTTSPlay:i,isPracticeRecording:o,setPracticeRecording:u,isPracticePlaying:m,setPracticePlaying:x}=e,f=null!==(t=null==a?void 0:a.wordForWord)&&void 0!==t?t:[],h=null!==(n=null==a?void 0:a.translation)&&void 0!==n?n:"";return(0,r.jsxs)(N.y,{isOpen:l,onClose:s,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,r.jsx)(N.y.Container,{children:(0,r.jsx)(N.y.Content,{style:{backgroundImage:"white"},children:(0,r.jsxs)("div",{className:"p-8 pb-16 text-black w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("p",{className:"font-semibold text-lg ",children:"Explanation"}),(0,r.jsx)("div",{className:"flex gap-3",children:(0,r.jsx)(d.G,{icon:g.EOp,onClick:s})})]}),(0,r.jsx)("div",{className:"flex gap-1 mt-4 flex-wrap gap-y-5",children:f.length>0&&f.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-col items-center bg-black/5 rounded",onClick:()=>{let t=e.original.trim();RegExp("^\\p{P}+$","u").test(t)||i(t)},children:[(0,r.jsx)("div",{className:"font-normal text-xl px-1 text-nowrap",children:e.original}),(0,r.jsx)("div",{className:"text-black/50  px-1 text-nowrap",children:e.translation})]},t))}),(0,r.jsxs)("div",{className:"mt-6 flex items-center gap-2 text-black/30",children:[(0,r.jsx)("div",{className:"material-symbols-rounded !text-xl",children:"translate"}),(0,r.jsx)("div",{children:h})]}),(0,r.jsxs)("div",{className:"flex mt-10 justify-center gap-6 mx-10",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>i(),className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(d.G,{className:"text-[#0039FF] text-lg",icon:c?g.Bg$:g.zc})}),(0,r.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>u(!o),className:"shadow-custom-blue-shadow bg-[#0039FF] rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(d.G,{className:"text-white text-xl",icon:o?g.pL1:g.UOM})}),(0,r.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>x(!m),className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(d.G,{className:"text-[#0039FF] text-xl",icon:g.GJz})}),(0,r.jsx)("div",{className:"text-sm text-nowrap",children:"Your sound"})]})]})]})})}),(0,r.jsx)(N.y.Backdrop,{onTap:s})]})},T=e=>{let{profilePicture:t,message:n,translation:s,isPlaying:a,onTap:c,onTTSPlay:i,onTTSStop:o,onTranslate:u,defaultShowTranslation:d=!0}=e,[m,x]=(0,l.useState)(d);return(0,r.jsxs)("div",{className:"bg-white rounded-tl-none rounded-lg py-4 px-4 mb-8 ring-1 ring-black/10 mr-14",onClick:c,children:[(0,r.jsx)("img",{src:t,className:"w-7 h-7 mb-3 rounded-full"}),(0,r.jsx)("div",{className:"font-medium",children:void 0===n?(0,r.jsxs)("div",{className:"flex flex-col gap-2 mb-2",children:[(0,r.jsx)("div",{className:"h-2 bg-gray-200 rounded-full w-full"}),(0,r.jsx)("div",{className:"h-2 bg-gray-200 rounded-full w-2/3"})]}):y(n)}),m&&(0,r.jsx)("div",{className:"text-black/30 text-sm",children:s}),(0,r.jsxs)("div",{className:"mt-2 flex gap-2",children:[a?(0,r.jsx)("div",{className:"material-symbols-rounded text-black/30 !text-xl",onClick:e=>{e.stopPropagation(),o()},children:"stop_circle"}):(0,r.jsx)("div",{className:"material-symbols-rounded text-black/30 !text-xl",onClick:e=>{e.stopPropagation(),i()},children:"volume_up"}),u&&(0,r.jsx)("div",{className:"material-symbols-rounded text-black/30 !text-xl",onClick:e=>{e.stopPropagation(),u(!m),x(!m)},children:"translate"})]})]})},E=e=>{let t,n,s,{message:a,translation:c,correction:i,onTap:o,onTranslate:u,defaultShowTranslation:m=!0}=e,[x,f]=(0,l.useState)(m),h="flex-initial bg-[#0039FF]/5 ring-1 rounded-lg py-4 px-4 ring-[#0039FF]/20 rounded-tr-none";i?"Grammar"===i.mistake||"Phrasing"===i.mistake?(t=(0,r.jsx)("div",{className:"font-normal text-red-600 line-through",children:a}),n=(0,r.jsx)("div",{className:"text-green-600",children:i.correct_version})):"No Mistake"===i.mistake?(h="relative flex-initial bg-green-500/5 ring-1 rounded-lg py-4 px-4 ring-green-600/20 rounded-tr-none",t=(0,r.jsx)("div",{className:"font-normal text-green-600",children:a}),s=(0,r.jsx)(d.G,{icon:g.fV7,className:"absolute -right-2 -bottom-2 text-green-600 text-xl"})):t=(0,r.jsx)("div",{className:"font-normal",children:a}):t=(0,r.jsx)("div",{className:"font-normal",children:a});let p=c&&x&&(0,r.jsx)("div",{className:"text-black/30 text-sm",children:c});return(0,r.jsxs)("div",{className:"flex flex-wrap-reverse justify-end items-center mb-8 ml-14 gap-y-3",children:[i&&i.explanation&&(0,r.jsxs)("div",{className:"basis-32 grow text-xs -ml-10 mr-3",children:[(0,r.jsxs)("p",{className:"font-bold",children:[i.mistake,(0,r.jsx)(d.G,{icon:g.DBf,className:"mx-1"})]}),(0,r.jsx)("p",{className:"italic",children:i.explanation})]}),(0,r.jsxs)("div",{className:h,onClick:o,children:[t,n,p,(0,r.jsx)("div",{className:"mt-2 flex gap-2",children:u&&(0,r.jsx)("div",{className:"material-symbols-rounded text-black/30 !text-xl",onClick:e=>{e.stopPropagation(),u(!x),f(!x)},children:"translate"})}),s]})]})};function k(){var e,t,n,a,c,o,u,N;let{startRecording:k,stopRecording:S,playRecording:R,stopPlayback:A,isPracticeRecording:C,isPlayingAudio:F}=function(){let[e,t]=(0,l.useState)(!1),[n,r]=(0,l.useState)(!1),s=(0,l.useRef)(null),a=(0,l.useRef)(null),c=(0,l.useRef)(null),[i,o]=(0,l.useState)(null),u=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});s.current=e,a.current=new MediaRecorder(e);let n=[];a.current.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},a.current.onstop=()=>{let e=new Blob(n,{type:"audio/mpeg"});o(e),t(!1)},a.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{a.current&&"recording"===a.current.state&&a.current.stop(),s.current&&s.current.getTracks().forEach(e=>e.stop())},m=()=>{c.current&&(c.current.pause(),c.current.currentTime=0,r(!1))};return(0,l.useEffect)(()=>()=>{d(),m()},[]),{startRecording:u,stopRecording:d,playRecording:()=>{i?(c.current||(c.current=new Audio),c.current.src=URL.createObjectURL(i),c.current.play(),r(!0),c.current.onended=()=>{r(!1)}):console.warn("No recording available to play")},stopPlayback:m,isPracticeRecording:e,isPlayingAudio:n}}(),[P,D]=(0,l.useState)(0),[_,M]=(0,l.useState)(!1),[O,L]=(0,l.useState)(null),[I,G]=(0,l.useState)(""),B=(0,s.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",mode:"Beginner",speedPreference:"NORMAL",lessonInfo:{}}),U=(0,s.MV)("STT",{totalTranscript:"",currTranscript:"",tempTranscript:""}),W=(0,s.MV)("CHAT",{messages:[],userPreview:null,assistantPreview:null}),V=(0,s.MV)("TTS",{volumeMultiplier:1}),Y=(0,s.MV)("TRANSLATION",{wordForWord:{},translations:{}}),[H]=(0,s.tp)("CORRECTION",(e,t)=>{"PERFECT"===t.type&&("Advanced"!==B.mode&&M(!0),setTimeout(()=>{let e=new Audio("encouragement.mp3");e.volume=.5,e.play()},500),setTimeout(()=>{M(!1)},1200))},{corrections:{}}),z=(0,s.MV)("AUTOCOMPLETE",{suggestions:[],translations:[],wordForWord:[]}),[K]=(0,l.useState)(1);(0,l.useEffect)(()=>((async()=>{await j.P.keepAwake()})(),()=>{(async()=>{await j.P.allowSleep()})()}),[]);let{startSpeaker:q,isPlaying:Q,latestAudioId:X,latestCharIndex:Z}=function(e){let{onPlaybackChange:t,volume:n=1,speed:r=1}=e,a=(0,l.useContext)(s.Dm),c=(0,v.Y)(),i=(0,l.useRef)([]),o=(0,l.useRef)(0),u=(0,l.useRef)(null),d=(0,l.useRef)([]),m=(0,l.useRef)(null),x=(0,l.useRef)(null),f=(0,l.useRef)(!1),[h,g]=(0,l.useState)(!1),[p,j]=(0,l.useState)(!1),[w,y]=(0,l.useState)(null),[N,b]=(0,l.useState)(null),T=(0,l.useRef)(null),E=()=>{k(),null!==x.current&&(x.current.disconnect(),x.current=null,console.log("Phase vocoder node disconnected and released")),null!==m.current&&(m.current.disconnect(),m.current=null,console.log("Gain node disconnected and released"))},k=()=>{if(d.current.forEach(e=>{clearTimeout(e)}),d.current=[],u.current&&(clearTimeout(u.current),u.current=null),0===i.current.length)return;let e=1,t=i.current.slice(0,1);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(1*t.length)}i.current.slice(1).forEach(e=>{e.stop()}),i.current=t},S=()=>{g(!1),j(!1),d.current=[],T.current=null},R=async e=>{let{i:t,data:n,id:l,t:s}=e,a=new Int16Array(n),x=c.createBuffer(1,a.length,24e3),f=x.getChannelData(0);for(let e=0;e<a.length;e++)f[e]=a[e]/32768;if(null===m.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let h=c.createBufferSource();h.connect(m.current),h.playbackRate.value=r,h.buffer=x;let p=0==t;p&&(i.current.length>0&&k(),o.current=c.currentTime);let v=o.current+.1*t/r+.1,w=c.currentTime-v;if(w>0&&(console.log("Audio chunk is late, delaying playback by ".concat(w," seconds.")),v+=w,o.current+=w),h.start(v),i.current.push(h),p&&(u.current=setTimeout(()=>{g(!0),b(0),void 0==l&&console.error("First chunk must have an id"),y(l),u.current=null},-(1e3*w))),h.onended=()=>{i.current.length>0&&(i.current.shift(),j(!1)),T.current&&t==T.current-1?S():0===i.current.length&&j(!0)},void 0!=s){let e=d.current.length,t=c.currentTime,n=s.map((n,l)=>setTimeout(()=>b(e+l),1e3*(o.current+n-t)/r));d.current.push(...n)}};return(0,l.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",R),a.registerEvent("TTS_INTERRUPT",()=>{k()}),a.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;w!==t||h?T.current=n:S()}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,r]),(0,l.useEffect)(()=>{null==t||t(h,w)},[h]),(0,l.useEffect)(()=>{m.current&&(m.current.gain.value=n)},[n]),(0,l.useEffect)(()=>{x.current&&(x.current.parameters.get("pitchFactor").value=1/r)},[r]),(0,l.useEffect)(()=>()=>{E()},[]),{isPlaying:h,isLagging:p,latestAudioId:w,latestCharIndex:N,startSpeaker:(e,t)=>{if(null===m.current){if(f.current){console.log("Speaker is already initializing");return}f.current=!0;try{c.resume(),m.current=c.createGain(),console.log("Gain node created"),c.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{x.current=new AudioWorkletNode(c,"phase-vocoder-processor"),m.current.connect(x.current),x.current.connect(c.destination),m.current.gain.value=n,x.current.parameters.get("pitchFactor").value=1/r,console.log("Phase vocoder worklet added")}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{f.current=!1}null===m.current?null==t||t():null==e||e()}},stopSpeaker:E}}({onPlaybackChange:(e,t)=>{V.sendAction({type:e?"PLAYBACK_STARTED":"PLAYBACK_FINISHED",id:t})},volume:V.volumeMultiplier,speed:K}),$=(e,t)=>void 0==e||null==Z?"":t?t.length>0?e.slice(0,Z*e.length/t.length):e:e.slice(0,Z),[J,ee]=(0,l.useState)(!1),et=(0,i.useRouter)(),[en,er]=(0,l.useState)(!0),{isRecording:el,setRecording:es,cancelRecording:ea,isVoiceDetected:ec,acquireMic:ei,releaseMic:eo}=(0,p.Z)({onAudioData:async e=>{0!=e.size&&U.sendBinary({type:"STREAM_MIC"},await e.arrayBuffer())},onRecordingStart:()=>{"Realtime"!=B.mode&&U.sendAction({type:"PTT_PRESSED"})},onRecordingStop:e=>{"Realtime"!=B.mode&&(e?U.sendAction({type:"PTT_CANCELLED"}):U.sendAction({type:"PTT_RELEASED"}))},onSpeechStart:()=>{U.sendAction({type:"VAD_CHANGED",detected:!0})},onSpeechEnd:()=>{U.sendAction({type:"VAD_CHANGED",detected:!1})},micVolume:"Realtime"==B.mode&&en?0:1,recordingChunkSize:100}),eu=parseInt(null!==(N=null==X?void 0:X.slice(1))&&void 0!==N?N:"")>=W.messages.length,ed=(0,l.useMemo)(()=>W.messages.concat(W.userPreview?[{role:"user",content:W.userPreview}]:[]).concat(W.assistantPreview&&eu?[{role:"assistant",content:W.assistantPreview}]:[]),[W.messages,W.userPreview,W.assistantPreview,eu]);(0,l.useEffect)(()=>{let e=document.getElementById("CHAT_BOTTOM");e&&e.scrollIntoView({behavior:"smooth"})},[ed.length]),(0,l.useEffect)(()=>{D(ed.length/12)},[ed]),(0,l.useEffect)(()=>{"CONNECTED"!=B.status&&"BACKEND_DISCONNECTED"!=B.status&&(J||(console.log("Auto starting lesson"),ee(!0),q(()=>{B.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),ei(),"Realtime"==B.mode&&es(!0),er(!1)))},[B.status]);let em=(0,l.useRef)(null);return(0,r.jsxs)("div",{className:"flex flex-col h-full items-center tracking-[-0.02em] ",children:[(0,r.jsx)(b,{isOpen:null!==O,onClose:()=>L(null),detailedTranslation:"number"==typeof O?{wordForWord:Y.wordForWord[O],translation:Y.translations[O]}:O,isTTSPlaying:Q&&"e"==X,onTTSPlay:e=>{q(),I&&V.sendAction({type:"SAY",text_stream:null!=e?e:I,id:"e"})},isPracticeRecording:C,setPracticeRecording:e=>{e?k():S()},isPracticePlaying:F,setPracticePlaying:e=>{e?R():A()}}),(0,r.jsx)("div",{className:"flex flex-col items-center w-full pb-6 px-7",children:(0,r.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,r.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{ee(!1),B.sendAction({type:"STOP_CALL"}),et.push("/")},children:(0,r.jsx)(d.G,{icon:g.g82,className:"text-xl"})}),(0,r.jsx)("div",{className:" mx-5 h-1.5 flex-grow bg-[#D9D9D9] rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[#0039FF] rounded-full transition-all duration-300 ease-out",style:{width:"".concat(100*P,"%")}})}),(0,r.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{},children:(0,r.jsx)(d.G,{icon:g.cRF,className:"text-xl"})})]})}),(0,r.jsxs)("div",{className:"flex-grow w-full overflow-auto px-7 pt-1",children:[ed.length>0&&"Realtime"!==B.mode&&ed.map((e,t)=>{var n,l;let s=Q&&"r".concat(t.toString())==X,a=eu&&"l".concat(t.toString())==X,c=s||a;if((null==e?void 0:e.role)==="assistant")return(0,r.jsx)(T,{profilePicture:null===(l=B.lessonInfo)||void 0===l?void 0:null===(n=l.tutor)||void 0===n?void 0:n.profile_picture_url,isPlaying:c,message:"Advanced"==B.mode?void 0:c?$(e.content):e.content,translation:"Advanced"==B.mode?void 0:c?$(Y.translations[t],e.content):Y.translations[t],onTap:()=>{a||(Y.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),G(e.content),L(t))},onTTSPlay:()=>{q(),V.sendAction({type:"SAY",text_stream:null==e?void 0:e.content,id:"r".concat(t)})},onTTSStop:()=>{q(),V.sendAction({type:"STOP",id:"r".concat(t)})},onTranslate:e=>{e&&(Y.translations[t]||Y.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==B.mode},t);if((null==e?void 0:e.role)==="user"){let n=H.corrections[t];return(0,r.jsx)(E,{message:e.content,translation:Y.translations[t],correction:n,onTap:()=>{a||(Y.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),G(e.content),L(t))},onTranslate:e=>{e&&(Y.translations[t]||Y.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==B.mode},t)}}),"Realtime"==B.mode&&(0,r.jsxs)("div",{className:"h-full flex flex-col justify-center items-center",children:[(0,r.jsxs)("div",{className:"bg-white flex flex-col items-center rounded-xl border-black/10 border-[1px] py-6 gap-2 mb-16 w-full",children:[(0,r.jsx)("img",{src:null===(t=B.lessonInfo)||void 0===t?void 0:null===(e=t.tutor)||void 0===e?void 0:e.profile_picture_url,alt:"",className:"w-20 h-20"}),(0,r.jsx)("div",{className:"font-medium text-lg",children:null===(a=B.lessonInfo)||void 0===a?void 0:null===(n=a.lesson)||void 0===n?void 0:n.title}),(0,r.jsx)("div",{className:"text-3xl",children:null===(o=B.lessonInfo)||void 0===o?void 0:null===(c=o.lesson)||void 0===c?void 0:c.emoji}),(0,r.jsx)("div",{className:"bg-[#0039FF]/10 text-[#0039FF] p-2 rounded-md",children:"Real time call"})]}),(0,r.jsx)("div",{className:"text-black/30 text-center text-sm mx-8",children:"Caution: This mode is experimental and may not work as expected."})]}),(0,r.jsx)("div",{id:"CHAT_BOTTOM"})]}),(0,r.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,r.jsxs)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto  pb-10 pt-6   ".concat("Realtime"==B.mode?"":"border-black/10 border-t-2 bg-white"),children:[(0,r.jsx)(m.M,{mode:"wait",children:_&&!el?(0,r.jsxs)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex flex-col items-center gap-5 h-[10.75rem] justify-center",children:[(0,r.jsx)(x.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,r.jsx)(x.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,r.jsx)(d.G,{icon:g.Tab,className:"text-[#0039FF]"})},e))}),(0,r.jsx)(x.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},children:"Amazing \uD83E\uDD73"})]},"encouragement"):ed.length>0&&"Realtime"!==B.mode&&"Advanced"!==B.mode?(0,r.jsxs)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,r.jsx)("div",{className:"flex justify-center text-black/30 font-light mb-3 h-8",children:"Tap on the card for details \uD83D\uDC47"}),(0,r.jsx)("div",{className:"h-32",children:(0,r.jsx)(f.tq,{pagination:!0,modules:[h.tl],className:" bg-white w-screen",children:(null===(u=z.suggestions)||void 0===u?void 0:u.length)>=3?z.suggestions.map((e,t)=>(0,r.jsx)(f.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,r.jsxs)("button",{onClick:()=>{G(e),L({wordForWord:z.wordForWord[t],translation:z.translations[t]})},className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg flex flex-col items-center",children:["Intermediate"==B.mode||"Advanced"==B.mode?(0,r.jsx)("div",{className:"flex gap-1 flex-wrap gap-y-5",children:z.wordForWord[t]&&z.wordForWord[t].length>0&&z.wordForWord[t].map((e,t)=>(0,r.jsx)("div",{className:"flex flex-col items-center",children:(0,r.jsx)("div",{className:"font-normal px-1 bg-black/5 rounded-sm mb-1 text-nowrap text-black/0",children:e.original})},t))}):(0,r.jsx)("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:y(e)}),(0,r.jsx)("div",{className:"text-black/30 overflow-hidden overflow-ellipsis whitespace-nowrap",children:y(z.translations[t])})]})},t)):(0,r.jsx)(r.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,r.jsx)(f.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,r.jsx)("div",{className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg",children:(0,r.jsxs)("div",{className:"space-y-2 w-full flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"}),(0,r.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"})]})})},t))})})})]},"messages"):null}),"CONNECTED"!==B.status?(0,r.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{J||(ee(!0),q(()=>{B.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),ei(),"Realtime"==B.mode&&es(!0),er(!1))},children:(0,r.jsx)(d.G,{className:"animate-spin",icon:g.LM3})}):(0,r.jsx)("div",{className:"flex w-full justify-center items-center gap-6",children:"Realtime"==B.mode?(0,r.jsxs)("div",{className:"flex items-center justify-between w-full mx-8",children:[(0,r.jsxs)("button",{className:"relative bg-black/5 h-14 w-14 rounded-full flex items-center justify-center ".concat(ec?"ring-4":""," ").concat(en?"ring-red-500/70":"ring-green-500/70"),onClick:()=>{q(),el||es(!0),er(!en)},children:[(0,r.jsx)(d.G,{icon:en?g.EkX:g.UOM,className:"text-black text-xl "}),ec&&en&&(0,r.jsx)("p",{className:"absolute -right-[120px] -top-8 bg-black/5 rounded-full rounded-bl-none p-2 text-sm",children:"Press to unmute"})]}),(0,r.jsx)("button",{className:"bg-black/5 h-14 w-14 rounded-full flex items-center justify-center",onClick:()=>{ee(!1),B.sendAction({type:"STOP_CALL"}),et.push("/")},children:(0,r.jsx)(d.G,{icon:g.g82,className:"text-black text-xl "})})]}):(0,r.jsxs)(r.Fragment,{children:[el&&(0,r.jsx)("button",{ref:em,className:"h-12 w-12 flex justify-center items-center text-xl rounded-full bg-red-200 text-red-600 ring-2 ring-red-600/50 transition-transform duration-200 ease-in-out hover:scale-110",children:(0,r.jsx)(d.G,{icon:g.g82})}),(0,r.jsx)(w,{onStartPress:()=>{es(!0),er(!1)},onEndPress:()=>{es(!1),q()},onCancel:()=>{ea()},cancelButtonRef:em,children:e=>(0,r.jsx)("div",{className:"".concat(e?"bg-[#0039FF]/20 text-[#0039FF] ring-2 ring-[#0039FF]/40":"bg-[#0039FF] text-white","  px-14 py-6 text-3xl rounded-full"),children:(0,r.jsx)(d.G,{icon:e?g.FPD:g.UOM})})}),el&&(0,r.jsx)("div",{className:"w-12"})]})})]})})]})}function S(){return(0,r.jsx)(u,{children:(0,r.jsx)("main",{className:"bg-gradient-to-b from-[#F6F8FF] to-[#F7F8FD] h-screen pt-5",children:(0,r.jsx)(k,{})})})}},6870:function(e,t,n){"use strict";n.d(t,{GlobalAudioContextProvider:function(){return a},Y:function(){return c}});var r=n(7437),l=n(2265);let s=(0,l.createContext)(null),a=e=>{let{children:t}=e,n=(0,l.useRef)(null);return n.current||(console.log("creating audio context"),n.current=new(window.AudioContext||window.webkitAudioContext)),(0,r.jsx)(s.Provider,{value:n.current,children:t})},c=()=>{let e=(0,l.useContext)(s);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},3510:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(2265),l=n(9800),s=n(3974),a=n(6870);function c(e){let{onSpeechStart:t,onSpeechEnd:n,onAudioData:c,onRecordingStart:i,onRecordingStop:o,micVolume:u=1,recordingChunkSize:d}=e,m=(0,a.Y)(),x=(0,r.useRef)(null),f=(0,r.useRef)(null),h=(0,r.useRef)(null),g=(0,r.useRef)(null),p=(0,r.useRef)(!1),[v,j]=(0,r.useState)(!1),w=(0,r.useRef)(!1),[y,N]=(0,s.useLocalStorage)("selectedMic",null),[b,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{v?k():h.current&&S()},[v]);let E=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=e&&e!==y;if(e?N(e):e=y,!r){if(p.current){console.log("Mic already being acquired");return}if(x.current&&f.current&&h.current){console.log("Mic already acquired");return}}R(),p.current=!0;try{x.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}}),console.log("Mic acquired",e);let r=m.createMediaStreamSource(x.current);f.current=m.createGain(),r.connect(f.current),f.current.gain.value=u;let s=m.createMediaStreamDestination();f.current.connect(s),h.current=new MediaRecorder(s.stream),g.current=await l.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:x.current,onSpeechStart:()=>{T(!0),null==t||t()},onVADMisfire:()=>{T(!1),null==n||n(!0)},onSpeechEnd:()=>{T(!1),null==n||n(!1)},positiveSpeechThreshold:.5,negativeSpeechThreshold:.35}),g.current.start()}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){console.log("User denied microphone access"),alert("Please allow microphone access to use this feature.");return}console.error("Error accessing microphone:",e),alert("Error accessing microphone: "+e);return}finally{p.current=!1}},k=async()=>{h.current||await E(),h.current&&(h.current.ondataavailable=e=>{null==c||c(e.data)},h.current.onstart=()=>{null==i||i()},h.current.onstop=()=>{null==o||o(w.current)},w.current=!1,await h.current.start(d))},S=()=>{h.current&&h.current.stop()},R=()=>{S(),x.current&&(x.current.getTracks().forEach(e=>{var t;e.stop(),null===(t=x.current)||void 0===t||t.removeTrack(e)}),x.current=null,console.log("Mic released")),f.current&&(f.current.disconnect(),f.current=null),h.current&&(h.current.stop(),h.current=null),g.current&&(b&&(T(!1),null==n||n(!1)),g.current.destroy(),g.current=null)};return(0,r.useEffect)(()=>{f.current&&(f.current.gain.value=u)},[u]),(0,r.useEffect)(()=>(console.log("Acquiring mic on mount"),E(),()=>{console.log("Releasing mic on unmount"),R()}),[]),{isRecording:v,setRecording:j,cancelRecording:()=>{w.current=!0,j(!1)},acquireMic:E,releaseMic:R,selectedMic:y,isVoiceDetected:b}}}},function(e){e.O(0,[284,676,753,254,268,383,563,69,758,971,117,744],function(){return e(e.s=3658)}),_N_E=e.O()}]);