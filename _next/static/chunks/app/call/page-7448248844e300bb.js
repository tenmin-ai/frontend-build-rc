(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{3658:function(e,t,n){Promise.resolve().then(n.bind(n,545))},545:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var s=n(7437),l=n(2265),a=n(4272),r=n(3974),i=n(3772),o=n(9376);let c=()=>{let[e,t]=(0,r.useLocalStorage)("token");return{token:e,saveToken:t}};function d(e){let{children:t}=e,n=(0,r.useIsClient)(),{token:l,saveToken:d}=c(),u=(0,o.useSearchParams)().get("session_id");return u?n?(0,s.jsx)(a.eA,{url:"wss://backend-us-rc.tenmin.ai/ws"+"/".concat(u)+"?token=".concat(l),label:"Debug Call",toast:i.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):(0,s.jsx)("div",{children:"Loading.."}):(0,s.jsx)("div",{children:"Invalid lesson"})}var u=n(5095),m=n(755),x=n(9764);n(7354),n(6889);var h=n(3377),f=n(3510),g=n(3399),p=n(5123),v=e=>{let{onStartPress:t,onEndPress:n,onCancel:a,cancelButtonRef:r,children:i}=e,[o,c]=(0,l.useState)(!1),d=(0,l.useRef)({x:0,y:0}),u=e=>{if(r.current){let t=r.current.getBoundingClientRect();return e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom}return!1};return(0,l.useEffect)(()=>{let e=e=>{var t,n;if(!o)return;let s=e.touches[0];u({x:s.clientX,y:s.clientY})?null===(t=r.current)||void 0===t||t.classList.add("scale-110","bg-red-300"):null===(n=r.current)||void 0===n||n.classList.remove("scale-110","bg-red-300")};return window.addEventListener("touchmove",e),()=>{window.removeEventListener("touchmove",e)}},[o,r]),(0,s.jsx)("button",{onTouchStart:e=>{e.preventDefault(),c(!0),t();let n=e.touches[0];d.current={x:n.clientX,y:n.clientY}},onTouchEnd:e=>{e.preventDefault(),c(!1);let t=e.changedTouches[0];u({x:t.clientX,y:t.clientY})?a():n()},onContextMenu:e=>e.preventDefault(),className:"microphoneButton",children:i?i(o):"Press and Hold"})},j=n(1755);let w=e=>e||"â€‹";var b=n(386),y=n(1273),N=n(2744);let k=e=>{let{profilePicture:t,message:n,translation:a,isPlaying:r,onTap:i,onTTSPlay:o,onTTSStop:c,onTranslate:d,defaultShowTranslation:u=!0}=e,[m,x]=(0,l.useState)(u);return(0,s.jsxs)("div",{className:"bg-white rounded-tl-none rounded-lg py-4 px-4 mb-8 ring-1 ring-black/10 mr-14",onClick:i,children:[(0,s.jsx)("img",{src:t,className:"w-7 h-7 mb-3 rounded-full"}),(0,s.jsx)("div",{className:"font-medium",children:void 0===n?(0,s.jsxs)("div",{className:"flex flex-col gap-2 mb-4",children:[(0,s.jsx)("div",{className:"h-2 bg-gray-200 rounded-full w-full"}),(0,s.jsx)("div",{className:"h-2 bg-gray-200 rounded-full w-2/3"})]}):w(n)}),m&&(0,s.jsx)("div",{className:"text-black/30 text-sm",children:a}),(0,s.jsxs)("div",{className:"mt-2 flex gap-2",children:[r?(0,s.jsx)(N.H6t,{className:"text-black/30 text-xl",onClick:e=>{e.stopPropagation(),c()}}):(0,s.jsx)(N.hwG,{className:"text-black/30 text-xl",onClick:e=>{e.stopPropagation(),o()}}),d&&(0,s.jsx)(N.mp2,{className:"text-black/30 text-xl",onClick:e=>{e.stopPropagation(),d(!m),x(!m)}})]})]})},C=e=>{let t,n,a,{message:r,translation:i,correction:o,onTap:c,onTranslate:d,defaultShowTranslation:u=!0}=e,[m,x]=(0,l.useState)(u),h="flex-initial bg-[#0039FF]/5 ring-1 rounded-lg py-4 px-4 ring-[#0039FF]/20 rounded-tr-none";o?"Grammar"===o.mistake||"Phrasing"===o.mistake?(t=(0,s.jsx)("div",{className:"font-normal text-red-600 line-through",children:r}),n=(0,s.jsx)("div",{className:"text-green-600",children:o.correct_version})):"No Mistake"===o.mistake?(h="relative flex-initial bg-green-500/5 ring-1 rounded-lg py-4 px-4 ring-green-600/20 rounded-tr-none",t=(0,s.jsx)("div",{className:"font-normal text-green-600",children:r}),a=(0,s.jsx)(y.ETl,{className:"absolute -right-2 -bottom-2 text-green-600 text-xl"})):t=(0,s.jsx)("div",{className:"font-normal",children:r}):t=(0,s.jsx)("div",{className:"font-normal",children:r});let f=i&&m&&(0,s.jsx)("div",{className:"text-black/30 text-sm",children:i});return(0,s.jsxs)("div",{className:"flex flex-wrap-reverse justify-end items-center mb-8 ml-14 gap-y-3",children:[o&&o.explanation&&(0,s.jsxs)("div",{className:"basis-32 grow text-xs -ml-10 mr-3",children:[(0,s.jsxs)("p",{className:"font-bold",children:[o.mistake,(0,s.jsx)(y.EQK,{className:"mx-1 inline-block"})]}),(0,s.jsx)("p",{className:"italic",children:o.explanation})]}),(0,s.jsxs)("div",{className:h,onClick:c,children:[t,n,f,(0,s.jsx)("div",{className:"mt-2 flex gap-2",children:d&&(0,s.jsx)(N.mp2,{className:"text-black/30 !text-xl",onClick:e=>{e.stopPropagation(),d(!m),x(!m)}})}),a]})]})};var S=n(1268),T=n(5217),A=n(2859),E=e=>{let{color:t="black"}=e;return(0,s.jsx)("svg",{width:"10",height:"16",viewBox:"0 0 10 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M0.0946622 2.84349C0.543847 1.57554 1.74925 0.722656 3.09681 0.722656H6.41168C8.39605 0.722656 9.99947 2.33176 9.99947 4.31045C9.99947 5.59546 9.31148 6.78381 8.19705 7.42631L6.36051 8.4782C6.34913 9.21737 5.74074 9.82007 4.99589 9.82007C4.23967 9.82007 3.63128 9.21168 3.63128 8.45546V7.68786C3.63128 7.19888 3.89283 6.74969 4.31927 6.5052L6.83812 5.06099C7.10536 4.90747 7.27025 4.62317 7.27025 4.31613C7.27025 3.83852 6.88361 3.45757 6.41168 3.45757H3.09681C2.90349 3.45757 2.73291 3.57697 2.67037 3.75892L2.64762 3.82715C2.39745 4.53788 1.61279 4.90747 0.907744 4.65729C0.202694 4.40711 -0.172574 3.62246 0.0776046 2.91741L0.100348 2.84918L0.0946622 2.84349ZM3.17641 13.459C3.17641 12.9765 3.36811 12.5137 3.70933 12.1725C4.05054 11.8312 4.51334 11.6396 4.99589 11.6396C5.47845 11.6396 5.94124 11.8312 6.28246 12.1725C6.62368 12.5137 6.81538 12.9765 6.81538 13.459C6.81538 13.9416 6.62368 14.4044 6.28246 14.7456C5.94124 15.0868 5.47845 15.2785 4.99589 15.2785C4.51334 15.2785 4.05054 15.0868 3.70933 14.7456C3.36811 14.4044 3.17641 13.9416 3.17641 13.459Z",fill:t})})},P=n(3069);let R=e=>{let{isOpen:t,onClose:n}=e,[a,r]=(0,l.useState)([]),i=async()=>{let e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind);r(e),console.log(e),console.log(o)};(0,l.useEffect)(()=>{i(),console.log("mediadevices: "+navigator.mediaDevices),navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=i);let e=a.find(e=>e.label.includes("AirPods"));e&&c(e.deviceId)},[]),(0,l.useEffect)(()=>{let e=setInterval(()=>{i()},1e3);return()=>clearInterval(e)},[]);let{selectedMic:o,acquireMic:c,isVoiceDetected:d}=(0,f.Z)({recordingChunkSize:100});return(0,s.jsxs)(P.y,{isOpen:t,onClose:n,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,s.jsx)(P.y.Container,{style:{backgroundColor:"#FAFBFF"},children:(0,s.jsx)(P.y.Content,{children:(0,s.jsxs)("div",{className:"p-8 pb-16 text-black w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("p",{className:"font-semibold text-lg ",children:"Settings"}),(0,s.jsx)("div",{className:"flex gap-3",children:(0,s.jsx)(y._0w,{onClick:n})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-5 mt-6",children:[(0,s.jsx)("div",{className:"flex items-center gap-2 text-black",children:(0,s.jsx)("p",{children:"Your Microphone"})}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:a.map(e=>(0,s.jsx)("button",{className:"flex items-center justify-between py-3 px-3 w-full rounded-lg font-normal border ".concat(o==e.deviceId?"border-[#0039FF] text-[#0039FF] bg-[#0039FF]/5":"bg-white"),onClick:()=>{c(e.deviceId)},children:(0,s.jsx)("p",{className:"text-sm",children:e.label||"Unknown Microphone"})},e.deviceId))}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-black/30 mb-12",children:[(0,s.jsx)("p",{children:"Try speaking to test your microphone:"}),(0,s.jsx)("div",{className:"flex items-center justify-center rounded-full h-1 w-8 ".concat(d?"bg-green-500":"bg-black/10")})]})]})]})})}),(0,s.jsx)(P.y.Backdrop,{onTap:n})]})};function F(){var e,t,n,r,i,c,d,N;let{startRecording:P,stopRecording:F,playRecording:D,stopPlayback:_,isPracticeRecording:O,isPlayingAudio:M}=(0,j.I)(),[I,L]=(0,l.useState)(0),[B,V]=(0,l.useState)(!1),[W,U]=(0,l.useState)(null),[H,Y]=(0,l.useState)(""),G=(0,a.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",mode:"Beginner",showStreakPlus:!1,speedPreference:"NORMAL",lessonInfo:{}}),Q=(0,a.MV)("STT",{totalTranscript:"",currTranscript:"",tempTranscript:""}),Z=(0,a.MV)("CHAT",{messages:[],userPreview:null,assistantPreview:null}),q=(0,a.MV)("TTS",{volumeMultiplier:1}),z=(0,a.MV)("TRANSLATION",{wordForWord:{},translations:{}}),[K]=(0,a.tp)("CORRECTION",(e,t)=>{"PERFECT"===t.type&&("Advanced"!==G.mode&&V(!0),setTimeout(()=>{let e=new Audio("encouragement.mp3");e.volume=.5,e.play()},500),setTimeout(()=>{V(!1)},1200))},{corrections:{}}),X=(0,a.MV)("AUTOCOMPLETE",{suggestions:[],translations:[],wordForWord:[]}),[J]=(0,l.useState)(1);(0,l.useEffect)(()=>((async()=>{await p.P.keepAwake()})(),()=>{(async()=>{await p.P.allowSleep()})()}),[]);let{startSpeaker:$,isPlaying:ee,latestAudioId:et,latestCharIndex:en}=(0,g.Z)({onPlaybackChange:(e,t)=>{q.sendAction({type:e?"PLAYBACK_STARTED":"PLAYBACK_FINISHED",id:t})},volume:q.volumeMultiplier,speed:J}),es=(e,t)=>void 0==e||null==en?"":t?t.length>0?e.slice(0,en*e.length/t.length):e:e.slice(0,en),[el,ea]=(0,l.useState)(!1),er=(0,o.useRouter)(),[ei,eo]=(0,l.useState)(!0),[ec,ed]=(0,l.useState)(!0),[eu,em]=(0,l.useState)(!0),{isRecording:ex,setRecording:eh,cancelRecording:ef,isVoiceDetected:eg,acquireMic:ep,releaseMic:ev}=(0,f.Z)({onAudioData:async e=>{0!=e.size&&Q.sendBinary({type:"STREAM_MIC"},await e.arrayBuffer())},onRecordingStart:()=>{"Realtime"!=G.mode&&Q.sendAction({type:"PTT_PRESSED"})},onRecordingStop:e=>{"Realtime"!=G.mode&&(e?Q.sendAction({type:"PTT_CANCELLED"}):Q.sendAction({type:"PTT_RELEASED"}))},onSpeechStart:()=>{Q.sendAction({type:"VAD_CHANGED",detected:!0})},onSpeechEnd:()=>{Q.sendAction({type:"VAD_CHANGED",detected:!1})},micVolume:"Realtime"==G.mode&&eu?0:1,recordingChunkSize:100}),ej=parseInt(null!==(N=null==et?void 0:et.slice(1))&&void 0!==N?N:"")>=Z.messages.length,ew=(0,l.useMemo)(()=>Z.messages.concat(Z.userPreview?[{role:"user",content:Z.userPreview}]:[]).concat(Z.assistantPreview&&ej?[{role:"assistant",content:Z.assistantPreview}]:[]),[Z.messages,Z.userPreview,Z.assistantPreview,ej]);(0,l.useEffect)(()=>{let e=document.getElementById("CHAT_BOTTOM");e&&e.scrollIntoView({behavior:"smooth"})},[ew,z]),(0,l.useEffect)(()=>{L(ew.length/12)},[ew]),(0,l.useEffect)(()=>{"CONNECTED"!=G.status&&"BACKEND_DISCONNECTED"!=G.status&&(el||(console.log("Auto starting lesson"),ea(!0),$(()=>{G.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),ep(),"Realtime"==G.mode&&eh(!0),em(!1)))},[G.status]);let eb=(0,l.useRef)(null),[ey,eN]=(0,l.useState)(!1);return(0,s.jsxs)("div",{className:"flex flex-col h-full items-center tracking-[-0.02em] ",children:[(0,s.jsx)(b.e,{isOpen:null!==W,onClose:()=>U(null),detailedTranslation:"number"==typeof W?{wordForWord:z.wordForWord[W],translation:z.translations[W]}:W,isTTSPlaying:ee&&"e"==et,onTTSPlay:e=>{$(),H&&q.sendAction({type:"SAY",text_stream:null!=e?e:H,id:"e"})},isPracticeRecording:O,setPracticeRecording:e=>{e?P():F()},isPracticePlaying:M,setPracticePlaying:e=>{e?D():_()}}),(0,s.jsx)(R,{isOpen:ey,onClose:()=>{eN(!1)}}),(0,s.jsx)("div",{className:"flex flex-col items-center w-full pb-2 px-7",children:(0,s.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,s.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{ea(!1),console.log("audioCall.showStreakPlus",G.showStreakPlus),G.sendAction({type:"STOP_CALL"}),G.showStreakPlus?er.push("/streakPlus"):er.push("/")},children:(0,s.jsx)(y._0w,{className:"text-xl"})}),(0,s.jsx)("div",{className:" mx-5 h-1.5 flex-grow bg-[#D9D9D9] rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-[#0039FF] rounded-full transition-all duration-300 ease-out",style:{width:"".concat(100*I,"%")}})}),(0,s.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{eN(!0)},children:(0,s.jsx)(y.kvo,{className:"text-xl"})})]})}),(0,s.jsxs)("div",{className:"flex-grow w-full overflow-auto overscroll-contain px-7 pt-1",children:[ew.length>0&&"Realtime"!==G.mode&&ew.map((e,t)=>{var n,l;let a=ee&&"r".concat(t.toString())==et,r=ej&&"l".concat(t.toString())==et,i=a||r;if((null==e?void 0:e.role)==="assistant")return(0,s.jsx)(k,{profilePicture:null===(l=G.lessonInfo)||void 0===l?void 0:null===(n=l.tutor)||void 0===n?void 0:n.profile_picture_url,isPlaying:i,message:"Advanced"!=G.mode&&ec?i?es(e.content):e.content:void 0,translation:"Advanced"!=G.mode&&ec?i?es(z.translations[t],e.content):z.translations[t]:void 0,onTap:()=>{r||(z.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),Y(e.content),U(t))},onTTSPlay:()=>{$(),q.sendAction({type:"SAY",text_stream:null==e?void 0:e.content,id:"r".concat(t)})},onTTSStop:()=>{$(),q.sendAction({type:"STOP",id:"r".concat(t)})},onTranslate:e=>{e&&(z.translations[t]||z.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==G.mode},t);if((null==e?void 0:e.role)==="user"){let n=K.corrections[t];return(0,s.jsx)(C,{message:e.content,translation:z.translations[t],correction:n,onTap:()=>{r||(z.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),Y(e.content),U(t))},onTranslate:e=>{e&&(z.translations[t]||z.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==G.mode},t)}}),"Realtime"==G.mode&&(0,s.jsxs)("div",{className:"h-full flex flex-col justify-center items-center",children:[(0,s.jsxs)("div",{className:"bg-white flex flex-col items-center rounded-xl border-black/10 border-[1px] py-6 gap-2 mb-16 w-full",children:[(0,s.jsx)("img",{src:null===(t=G.lessonInfo)||void 0===t?void 0:null===(e=t.tutor)||void 0===e?void 0:e.profile_picture_url,alt:"",className:"w-20 h-20"}),(0,s.jsx)("div",{className:"font-medium text-lg",children:null===(r=G.lessonInfo)||void 0===r?void 0:null===(n=r.lesson)||void 0===n?void 0:n.title}),(0,s.jsx)("div",{className:"text-3xl",children:null===(c=G.lessonInfo)||void 0===c?void 0:null===(i=c.lesson)||void 0===i?void 0:i.emoji}),(0,s.jsx)("div",{className:"bg-[#0039FF]/10 text-[#0039FF] p-2 rounded-md",children:"Real time call"})]}),(0,s.jsx)("div",{className:"text-black/30 text-center text-sm mx-8",children:"Caution: This mode is experimental and may not work as expected."})]}),(0,s.jsx)("div",{id:"CHAT_BOTTOM"})]}),(0,s.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,s.jsxs)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto pb-10 pt-4   ".concat("Realtime"==G.mode?"":"border-black/10 border-t-[1px] bg-white"),children:[(0,s.jsx)(u.M,{mode:"wait",children:B&&!ex?(0,s.jsxs)(m.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex flex-col items-center gap-5 h-[10.75rem] justify-center",children:[(0,s.jsx)(m.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,s.jsx)(m.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,s.jsx)(y.QJe,{className:"text-[#0039FF]"})},e))}),(0,s.jsx)(m.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},children:"Amazing \uD83E\uDD73"})]},"encouragement"):ew.length>0&&"Realtime"!==G.mode&&"Advanced"!==G.mode?(0,s.jsxs)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,s.jsx)("div",{className:"flex justify-center text-black/30 font-light text-base mb-1",onClick:()=>{eo(!ei)},children:(0,s.jsx)(m.E.div,{animate:{rotateX:ei?0:180},transition:{duration:.6,ease:"easeInOut"},children:(0,s.jsx)(y.RiI,{className:"transform scale-y-75"})})}),(0,s.jsx)(u.M,{children:ei&&(0,s.jsx)(m.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut",opacity:{duration:.05,ease:"easeInOut"},height:{duration:.3,ease:"easeInOut"}},className:"overflow-hidden",children:(0,s.jsx)("div",{className:"h-32",children:(0,s.jsx)(x.tq,{pagination:!0,modules:[h.tl],className:"bg-white w-screen",children:(null===(d=X.suggestions)||void 0===d?void 0:d.length)>=3?X.suggestions.map((e,t)=>(0,s.jsx)(x.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,s.jsxs)("button",{onClick:()=>{Y(e),U({wordForWord:X.wordForWord[t],translation:X.translations[t]})},className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg flex flex-col items-center",children:["Intermediate"===G.mode||"Advanced"===G.mode?(0,s.jsx)("div",{className:"flex gap-1 flex-wrap gap-y-5",children:X.wordForWord[t]&&X.wordForWord[t].length>0&&X.wordForWord[t].map((e,t)=>(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsx)("div",{className:"font-normal px-1 bg-black/5 rounded-sm mb-1 text-nowrap text-black/0",children:e.original})},t))}):(0,s.jsx)("div",{className:"w-full *:overflow-hidden overflow-ellipsis whitespace-nowrap",children:w(e)}),(0,s.jsx)("div",{className:"w-full text-black/30 overflow-hidden overflow-ellipsis whitespace-nowrap",children:w(X.translations[t])})]})},t)):(0,s.jsx)(s.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,s.jsx)(x.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,s.jsx)("div",{className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"space-y-2 w-full flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"}),(0,s.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"})]})})},t))})})})})})]},"messages"):null}),"CONNECTED"!==G.status?(0,s.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{el||(ea(!0),$(()=>{G.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),ep(),"Realtime"==G.mode&&eh(!0),em(!1))},children:(0,s.jsx)(y.fCD,{className:"animate-spin"})}):(0,s.jsx)("div",{className:"flex w-full justify-center items-center gap-6",children:"Realtime"==G.mode?(0,s.jsxs)("div",{className:"flex items-center justify-between w-full mx-8",children:[(0,s.jsxs)("button",{className:"relative bg-black/5 h-14 w-14 rounded-full flex items-center justify-center ".concat(eg?"ring-4":""," ").concat(eu?"ring-red-500/70":"ring-green-500/70"),onClick:()=>{$(),ex||eh(!0),em(!eu)},children:[(0,s.jsx)(A.J,{icon:eu?y.uYL:y.RgM,className:"text-black text-xl"}),eg&&eu&&(0,s.jsx)("p",{className:"absolute -right-[120px] -top-8 bg-black/5 rounded-full rounded-bl-none p-2 text-sm",children:"Press to unmute"})]}),(0,s.jsx)("button",{className:"bg-black/5 h-14 w-14 rounded-full flex items-center justify-center",onClick:()=>{ea(!1),G.sendAction({type:"STOP_CALL"}),console.log("audioCall.showStreakPlus",G.showStreakPlus),G.showStreakPlus?er.push("/streakPlus"):er.push("/")},children:(0,s.jsx)(y._0w,{className:"text-black text-xl"})})]}):(0,s.jsxs)(s.Fragment,{children:[ex&&(0,s.jsx)("button",{ref:eb,className:"h-12 w-12 flex justify-center items-center text-xl rounded-full bg-red-200 text-red-600 ring-2 ring-red-600/50 transition-transform duration-200 ease-in-out hover:scale-110",children:(0,s.jsx)(y._0w,{})}),!ex&&(0,s.jsx)("div",{className:" rounded-full h-14 w-14 flex justify-center items-center ".concat(ec?"bg-black/5":"text-[#0039FF] bg-[#0039FF]/10"),onClick:()=>{ed(!ec)},children:(0,s.jsx)(y.Vbz,{})}),(0,s.jsx)(v,{onStartPress:()=>{eh(!0),em(!1)},onEndPress:()=>{eh(!1),$()},onCancel:()=>{ef()},cancelButtonRef:eb,children:e=>(0,s.jsx)("div",{className:"".concat(e?"bg-[#0039FF]/20 text-[#0039FF] ring-2 ring-[#0039FF]/40":"bg-[#0039FF] text-white","  px-12 py-6 text-3xl rounded-full"),children:(0,s.jsx)(S.G,{icon:e?T.FPD:T.UOM})})}),!ex&&(0,s.jsx)("div",{className:"bg-black/5 rounded-full h-14 w-14 flex justify-center items-center",children:(0,s.jsx)(E,{})}),ex&&(0,s.jsx)("div",{className:"w-12"})]})})]})})]})}function D(){return(0,s.jsx)(d,{children:(0,s.jsx)("main",{className:"bg-[#FAFBFF] h-screen-safe pt-1",children:(0,s.jsx)(F,{})})})}},3510:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(2265),l=n(9800),a=n(3974),r=n(6870);function i(e){let{onSpeechStart:t,onSpeechEnd:n,onAudioData:i,onRecordingStart:o,onRecordingStop:c,micVolume:d=1,recordingChunkSize:u}=e,m=(0,r.Y)(),x=(0,s.useRef)(null),h=(0,s.useRef)(null),f=(0,s.useRef)(null),g=(0,s.useRef)(null),p=(0,s.useRef)(!1),[v,j]=(0,s.useState)(!1),w=(0,s.useRef)(!1),[b,y]=(0,a.useLocalStorage)("selectedMic",null),[N,k]=(0,s.useState)(!1);(0,s.useEffect)(()=>{v?S():f.current&&T()},[v]);let C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=e&&e!==b;if(e?y(e):e=b,!s){if(p.current){console.log("Mic already being acquired");return}if(x.current&&h.current&&f.current){console.log("Mic already acquired");return}}A(),p.current=!0;try{x.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}}),console.log("Mic acquired",e);let s=x.current.getAudioTracks()[0].getSettings().deviceId;y(null!=s?s:null);let a=m.createMediaStreamSource(x.current);h.current=m.createGain(),a.connect(h.current),h.current.gain.value=d;let r=m.createMediaStreamDestination();h.current.connect(r),f.current=new MediaRecorder(r.stream),g.current=await l.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:x.current,onSpeechStart:()=>{k(!0),null==t||t()},onVADMisfire:()=>{k(!1),null==n||n(!0)},onSpeechEnd:()=>{k(!1),null==n||n(!1)},positiveSpeechThreshold:.5,negativeSpeechThreshold:.35}),g.current.start()}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){console.log("User denied microphone access"),alert("Please allow microphone access to use this feature.");return}console.error("Error accessing microphone:",e),alert("Error accessing microphone: "+e);return}finally{p.current=!1}},S=async()=>{f.current||await C(),f.current&&(f.current.ondataavailable=e=>{null==i||i(e.data)},f.current.onstart=()=>{null==o||o()},f.current.onstop=()=>{null==c||c(w.current)},w.current=!1,await f.current.start(u))},T=()=>{f.current&&f.current.stop()},A=()=>{T(),x.current&&(x.current.getTracks().forEach(e=>{var t;e.stop(),null===(t=x.current)||void 0===t||t.removeTrack(e)}),x.current=null,console.log("Mic released")),h.current&&(h.current.disconnect(),h.current=null),f.current&&(f.current.stop(),f.current=null),g.current&&(N&&(k(!1),null==n||n(!1)),g.current.destroy(),g.current=null)};return(0,s.useEffect)(()=>{h.current&&(h.current.gain.value=d)},[d]),(0,s.useEffect)(()=>(console.log("Acquiring mic on mount"),C(),()=>{console.log("Releasing mic on unmount"),A()}),[]),{isRecording:v,setRecording:j,cancelRecording:()=>{w.current=!0,j(!1)},acquireMic:C,releaseMic:A,selectedMic:b,isVoiceDetected:N}}}},function(e){e.O(0,[284,240,753,51,676,254,990,563,999,861,386,971,117,744],function(){return e(e.s=3658)}),_N_E=e.O()}]);