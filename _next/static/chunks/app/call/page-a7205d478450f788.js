(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{3658:function(e,t,n){Promise.resolve().then(n.bind(n,6272))},6272:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n(7437),s=n(2265),l=n(4031),c=n(3061),a=n(7776),i=n(6463),o=n(40);function u(e){let{children:t}=e,n=(0,c.useIsClient)(),{token:s,saveToken:u}=(0,o.f)(),d=(0,i.useSearchParams)().get("session_id");return d?n?(0,r.jsx)(l.eA,{url:"wss://backend-us-rc.tenmin.ai/ws"+"/".concat(d)+"?token=".concat(s),label:"Debug Call",toast:a.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):(0,r.jsx)("div",{children:"Loading.."}):(0,r.jsx)("div",{children:"Invalid lesson"})}var d=n(6920),x=n(3267);n(3034),n(7322);var m=n(7805),f=n(2793),h=n(5079),g=n(2792),p=n(9728),v=n(7743);let w=e=>e||"â€‹";function j(){var e,t;let{startRecording:n,stopRecording:c,playRecording:a,stopPlayback:o,isPracticeRecording:u,isPlayingAudio:j}=function(){let[e,t]=(0,s.useState)(!1),[n,r]=(0,s.useState)(!1),l=(0,s.useRef)(null),c=(0,s.useRef)(null),a=(0,s.useRef)(null),[i,o]=(0,s.useState)(null);return{startRecording:async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});l.current=e,c.current=new MediaRecorder(e);let n=[];c.current.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},c.current.onstop=()=>{let e=new Blob(n,{type:"audio/mpeg"});o(e),t(!1)},c.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},stopRecording:()=>{c.current&&"recording"===c.current.state&&c.current.stop(),l.current&&l.current.getTracks().forEach(e=>e.stop())},playRecording:()=>{i?(a.current||(a.current=new Audio),a.current.src=URL.createObjectURL(i),a.current.play(),r(!0),a.current.onended=()=>{r(!1)}):console.warn("No recording available to play")},stopPlayback:()=>{a.current&&(a.current.pause(),a.current.currentTime=0,r(!1))},isPracticeRecording:e,isPlayingAudio:n}}(),[b,N]=(0,s.useState)(!1),[y,T]=(0,s.useState)(""),[k,S]=(0,s.useState)([]),[E,C]=(0,s.useState)(""),A=(0,l.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",speedPreference:"NORMAL"}),R=(0,l.MV)("STT",{totalTranscript:"",currTranscript:"",tempTranscript:""}),F=(0,l.MV)("CHAT",{messages:[],userPreview:null,assistantPreview:null}),P=(0,l.MV)("TTS",{}),_=(0,l.MV)("TRANSLATION",{wordForWord:{},translations:{}}),D=(0,l.MV)("AUTOCOMPLETE",{suggestions:[],translations:[],wordForWord:[]}),[M,O]=(0,s.useState)(1);(0,s.useEffect)(()=>((async()=>{await v.P.keepAwake()})(),()=>{(async()=>{await v.P.allowSleep()})()}),[]);let{startSpeaker:L,isPlaying:I,isLagging:U,latestAudioId:B,latestCharIndex:G}=(0,p.Z)({onPlaybackChange:(e,t)=>{P.sendAction({type:e?"PLAYBACK_STARTED":"PLAYBACK_FINISHED",id:t})},volume:1,speed:M}),V=(e,t)=>void 0==e||null==G?"":t?t.length>0?e.slice(0,G*e.length/t.length):e:e.slice(0,G),[z,H]=(0,s.useState)(!1),K=(0,i.useRouter)(),{isRecording:Y,setRecording:W,acquireMic:Z,releaseMic:q}=(0,g.Z)({onAudioData:e=>{0!=e.size&&R.sendBinary({type:"STREAM_MIC"},e)},onRecordingStart:()=>{R.sendAction({type:"PTT_PRESSED"})},onRecordingStop:()=>{R.sendAction({type:"PTT_RELEASED"})},micVolume:1,recordingChunkSize:100}),J=parseInt(null!==(t=null==B?void 0:B.slice(1))&&void 0!==t?t:"")>=F.messages.length,$=(0,s.useMemo)(()=>F.messages.concat(F.userPreview?[{role:"user",content:F.userPreview}]:[]).concat(F.assistantPreview&&J?[{role:"assistant",content:F.assistantPreview}]:[]),[F.messages,F.userPreview,F.assistantPreview,J]),[Q,X]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=document.getElementById("CHAT_BOTTOM");e&&e.scrollIntoView({behavior:"smooth"})},[$.length]),(0,r.jsxs)("div",{className:"flex flex-col h-full items-center tracking-[-0.02em] ",children:[(0,r.jsxs)(f.y,{isOpen:b,onClose:()=>N(!1),detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,r.jsx)(f.y.Container,{children:(0,r.jsx)(f.y.Content,{style:{backgroundImage:"white"},children:(0,r.jsxs)("div",{className:"p-8 pb-16 text-black w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("p",{className:"font-semibold text-lg ",children:"Explanation"}),(0,r.jsx)("div",{className:"flex gap-3",children:(0,r.jsx)(d.G,{icon:h.EOp,onClick:()=>N(!1)})})]}),(0,r.jsx)("div",{className:"flex gap-1 mt-4 flex-wrap gap-y-5",children:k&&k.length>0&&k.map(e=>(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"font-normal text-xl px-1 bg-black/5 rounded-sm mb-1 text-nowrap",children:e.original}),(0,r.jsx)("div",{className:"text-black px-1 bg-black/5 rounded-sm text-nowrap",children:e.translation})]}))}),(0,r.jsxs)("div",{className:"mt-6 flex items-center gap-2 text-black/30",children:[(0,r.jsx)("div",{className:"material-symbols-rounded !text-xl",children:"translate"}),(0,r.jsx)("div",{children:E})]}),(0,r.jsxs)("div",{className:"flex mt-10 justify-center gap-6 mx-10",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>{L(),y&&P.sendAction({type:"SAY",text_stream:y,id:"e"})},className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(d.G,{className:"text-[#0039FF] text-lg",icon:I&&"e"==B?h.Bg$:h.zc})}),(0,r.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:u?c:n,className:"shadow-custom-blue-shadow bg-[#0039FF] rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(d.G,{className:"text-white text-xl",icon:u?h.pL1:h.UOM})}),(0,r.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:j?o:a,className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(d.G,{className:"text-[#0039FF] text-xl",icon:h.GJz})}),(0,r.jsx)("div",{className:"text-sm text-nowrap",children:"Your sound"})]})]})]})})}),(0,r.jsx)(f.y.Backdrop,{onTap:()=>{N(!1)}})]}),(0,r.jsx)("div",{className:"flex flex-col items-center w-full pb-6 px-7",children:(0,r.jsx)("div",{className:"flex w-full justify-between items-center",children:(0,r.jsx)("button",{className:"text-black/60 font-medium text-sm self-start flex items-center bg-black bg-opacity-[10%] w-12 h-12 justify-center rounded-full",onClick:()=>{H(!1),A.sendAction({type:"STOP_CALL"}),q(),K.push("/")},children:(0,r.jsx)(d.G,{icon:h.EOp})})})}),(0,r.jsxs)("div",{className:"flex-grow w-full overflow-auto px-7 pt-1",children:["CONNECTED"!==A.status&&0==$.length?(0,r.jsx)("div",{className:"flex flex-col items-center justify-center h-full w-full",children:(0,r.jsxs)("div",{className:"bg-white flex flex-col justify-center rounded-xl items-center border-black/10 border-[1px] transition-all duration-500 pointer-events-auto py-10 px-8 w-full",children:[(0,r.jsx)(d.G,{icon:h.YKZ,className:"text-green-500/80 text-4xl"}),(0,r.jsx)("p",{className:"mt-7 font-light text-black/30 text-base text-center",children:"Please ensure you are in a quiet environment suitable for speaking."})]})}):(0,r.jsx)("div",{}),$.length>0&&$.map((e,t)=>{let n=I&&"r".concat(t.toString())==B,s=J&&"l".concat(t.toString())==B,l=n||s;return(null==e?void 0:e.role)==="assistant"?(0,r.jsxs)("div",{className:"bg-white rounded-tl-none rounded-lg py-4 px-4 mb-8 ring-1 ring-black/10 mr-14",children:[(0,r.jsx)("img",{src:"mina.png",className:"w-7 h-7 mb-3 rounded-full"}),(0,r.jsx)("div",{className:"font-medium",children:w(l?V(e.content):e.content)}),(0,r.jsx)("div",{className:"text-black/30",children:w(l?V(_.translations[t],e.content):_.translations[t])}),(0,r.jsx)("div",{className:"mt-2 flex gap-2",children:l?(0,r.jsx)("div",{className:"material-symbols-rounded text-black/30 !text-xl",children:"stop_circle"}):(0,r.jsx)("div",{className:"material-symbols-rounded text-black/30 !text-xl",onClick:()=>{L(),P.sendAction({type:"SAY",text_stream:null==e?void 0:e.content,id:"r".concat(t)})},children:"volume_up"})})]},t):(null==e?void 0:e.role)==="user"?(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("div",{className:"bg-[#0039FF]/5 ring-1 rounded-lg py-4 px-4 mb-8 ring-[#0039FF]/20 ml-14 rounded-tr-none",children:(0,r.jsx)("div",{className:"font-normal",children:null==e?void 0:e.content})},t)}):void 0}),(0,r.jsx)("div",{id:"CHAT_BOTTOM"})]}),(0,r.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none bg-white",children:(0,r.jsxs)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto bg-white pb-10 pt-6 border-t-2 border-black/10",children:[$.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex justify-center text-black/30 font-light mb-3",children:"Tap on the card for details \uD83D\uDC47"}),(0,r.jsx)("div",{className:"h-32",children:(0,r.jsx)(x.tq,{pagination:!0,modules:[m.tl],className:" bg-white w-screen",children:(null===(e=D.suggestions)||void 0===e?void 0:e.length)>=3?D.suggestions.map((e,t)=>(0,r.jsx)(x.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,r.jsxs)("button",{onClick:()=>{T(e),S(D.wordForWord[t]),C(D.translations[t]),N(!0)},className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:[w(e)," "]}),(0,r.jsx)("div",{className:"text-black/30 overflow-hidden overflow-ellipsis whitespace-nowrap",children:w(D.translations[t])})]})})):(0,r.jsx)(r.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,r.jsx)(x.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,r.jsx)("div",{className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg",children:(0,r.jsxs)("div",{className:"space-y-2 w-full flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"}),(0,r.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"})]})})},t))})})})]}),"CONNECTED"!==A.status?(0,r.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{z||(H(!0),A.sendAction({type:"START_CALL"}),L(),Z())},children:z?(0,r.jsx)(d.G,{className:"animate-spin",icon:h.LM3}):(0,r.jsx)("p",{className:"font-medium text-lg",children:"Start"})}):(0,r.jsxs)("div",{className:"flex w-full justify-center items-center gap-6",children:[Y&&(0,r.jsx)("button",{onClick:()=>{},className:"h-12 w-12 flex justify-center items-center text-xl rounded-full bg-red-200 text-red-600 ring-2 ring-red-600/50",children:(0,r.jsx)(d.G,{icon:h.g82})}),(0,r.jsx)("button",{onClick:()=>{Y?(W(!1),L()):W(!0)},className:"".concat(Y?"bg-[#0039FF]/20 text-[#0039FF] ring-2 ring-[#0039FF]/40":"bg-[#0039FF] text-white","  px-14 py-6 text-3xl rounded-full"),children:(0,r.jsx)(d.G,{icon:Y?h.FPD:h.UOM})}),Y&&(0,r.jsx)("div",{className:"w-12"})]})]})})]})}function b(){return(0,r.jsx)(u,{children:(0,r.jsx)("main",{className:"bg-gradient-to-b from-[#F6F8FF] to-[#F7F8FD] h-screen pt-5",children:(0,r.jsx)(j,{})})})}},2792:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(2265),s=n(68);function l(e){let{onSpeechStart:t,onSpeechEnd:n,onAudioData:l,onRecordingStart:c,onRecordingStop:a,micVolume:i=1,recordingChunkSize:o}=e,u=(0,r.useRef)(null),d=(0,r.useRef)(null),x=(0,r.useRef)(null),m=(0,r.useRef)(null),[f,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{f?p():x.current&&v()},[f]);let g=async()=>{u.current=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0}});let e=new AudioContext,r=e.createMediaStreamSource(u.current);d.current=e.createGain(),r.connect(d.current),d.current.gain.value=i;let l=e.createMediaStreamDestination();d.current.connect(l),x.current=new MediaRecorder(l.stream),m.current=await s.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:u.current,onSpeechStart:()=>{console.log("User started talking"),null==t||t()},onVADMisfire:()=>{console.log("Nvm, user didn't start talking"),null==n||n(!0)},onSpeechEnd:e=>{console.log("User stopped talking"),null==n||n(!1)},positiveSpeechThreshold:.7,negativeSpeechThreshold:.35}),m.current.start()},p=async()=>{if(!x.current)try{await g()}catch(e){console.error("Error accessing microphone:",e)}x.current&&(x.current.ondataavailable=e=>{null==l||l(e.data)},x.current.onstart=()=>{null==c||c()},x.current.onstop=()=>{null==a||a()},await x.current.start(o))},v=()=>{x.current&&x.current.stop()};return(0,r.useEffect)(()=>{d.current&&(d.current.gain.value=i)},[i]),{isRecording:f,setRecording:h,acquireMic:g,releaseMic:()=>{v(),x.current&&(x.current=null),d.current&&(d.current.disconnect(),d.current=null),u.current&&(u.current.getTracks().forEach(e=>e.stop()),u.current=null),m.current&&(m.current.destroy(),m.current=null)}}}},40:function(e,t,n){"use strict";n.d(t,{f:function(){return s}});var r=n(3061);let s=()=>{let[e,t]=(0,r.useLocalStorage)("token");return{token:e,saveToken:t}}},9728:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(2265),s=n(4031);function l(e){let{onPlaybackChange:t,volume:n=1,speed:l=1}=e,c=(0,r.useContext)(s.Dm),a=(0,r.useRef)(null),i=(0,r.useRef)([]),o=(0,r.useRef)(0),u=(0,r.useRef)(null),d=(0,r.useRef)([]),x=(0,r.useRef)(null),m=(0,r.useRef)(null),[f,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)(!1),[v,w]=(0,r.useState)(null),[j,b]=(0,r.useState)(null),N=(0,r.useRef)(null),y=()=>{if(d.current.forEach(e=>{clearTimeout(e)}),d.current=[],u.current&&(clearTimeout(u.current),u.current=null),0===i.current.length)return;let e=1,t=i.current.slice(0,1);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(1*t.length)}i.current.slice(1).forEach(e=>{e.stop()}),i.current=t},T=()=>{h(!1),p(!1),d.current=[],N.current=null},k=async e=>{let{i:t,data:n,id:r,t:s}=e;if(null===a.current){console.error("AudioContext not initialized!");return}let c=new Int16Array(n),m=a.current.createBuffer(1,c.length,24e3),f=m.getChannelData(0);for(let e=0;e<c.length;e++)f[e]=c[e]/32768;let g=a.current.createBufferSource();g.connect(x.current),g.playbackRate.value=l,g.buffer=m;let v=0==t;v&&(i.current.length>0&&y(),o.current=a.current.currentTime);let j=o.current+.1*t/l+.1,k=a.current.currentTime-j;if(k>0&&(console.log("Audio chunk is late, delaying playback by ".concat(k," seconds.")),j+=k,o.current+=k),g.start(j),i.current.push(g),v&&(u.current=setTimeout(()=>{h(!0),b(0),void 0==r&&console.error("First chunk must have an id"),w(r),u.current=null},-(1e3*k))),g.onended=()=>{i.current.length>0&&(i.current.shift(),p(!1)),N.current&&t==N.current-1?T():0===i.current.length&&p(!0)},void 0!=s){let e=d.current.length,t=a.current.currentTime,n=s.map((n,r)=>setTimeout(()=>b(e+r),1e3*(o.current+n-t)/l));d.current.push(...n)}};return(0,r.useEffect)(()=>{if(!c){console.error("No session found!");return}return c.registerEvent("TTS_CHUNK",k),c.registerEvent("TTS_INTERRUPT",()=>{console.log("TTS_INTERRUPT"),y()}),c.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;v!==t||f?N.current=n:T()}),()=>{null==c||c.deregisterEvent("TTS_CHUNK"),null==c||c.deregisterEvent("TTS_INTERRUPT"),null==c||c.deregisterEvent("TTS_END")}},[c,l]),(0,r.useEffect)(()=>{null==t||t(f,v)},[f]),(0,r.useEffect)(()=>{x.current&&(x.current.gain.value=n)},[n]),(0,r.useEffect)(()=>{m.current&&(m.current.parameters.get("pitchFactor").value=1/l)},[l]),{isPlaying:f,isLagging:g,latestAudioId:v,latestCharIndex:j,startSpeaker:()=>{null===a.current&&(a.current=new(window.AudioContext||window.webkitAudioContext),x.current=a.current.createGain(),a.current.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{m.current=new AudioWorkletNode(a.current,"phase-vocoder-processor"),x.current.connect(m.current),m.current.connect(a.current.destination),x.current.gain.value=n,m.current.parameters.get("pitchFactor").value=1/l}))}}}}},function(e){e.O(0,[476,676,753,119,920,542,87,793,214,971,23,744],function(){return e(e.s=3658)}),_N_E=e.O()}]);