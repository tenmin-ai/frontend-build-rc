(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2293],{93658:function(e,t,s){Promise.resolve().then(s.bind(s,85184))},85184:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return I}});var n=s(57437),l=s(2265),i=s(74272),a=s(53974),o=s(93772),r=s(99376),c=s(89403);function d(e){let{children:t}=e,s=(0,a.useIsClient)(),{token:l}=(0,c.f)(),d=(0,r.useSearchParams)().get("session_id");return d?s?(0,n.jsx)(i.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/lesson/").concat(d,"?token=").concat(l),label:"Call",toast:o.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):null:(0,n.jsx)("div",{children:"Invalid lesson"})}var u=s(5095),x=s(60755),m=s(15731),f=s(19764);s(7354),s(76889);var h=s(73377),p=s(49677),g=s(63399),v=s(15123),j=s(1755),y=s(80434),b=s(25095),w=s(28529),N=s(61273),C=s(32859),k=e=>{let{color:t="black"}=e;return(0,n.jsx)("svg",{width:"10",height:"16",viewBox:"0 0 10 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M0.0946622 2.84349C0.543847 1.57554 1.74925 0.722656 3.09681 0.722656H6.41168C8.39605 0.722656 9.99947 2.33176 9.99947 4.31045C9.99947 5.59546 9.31148 6.78381 8.19705 7.42631L6.36051 8.4782C6.34913 9.21737 5.74074 9.82007 4.99589 9.82007C4.23967 9.82007 3.63128 9.21168 3.63128 8.45546V7.68786C3.63128 7.19888 3.89283 6.74969 4.31927 6.5052L6.83812 5.06099C7.10536 4.90747 7.27025 4.62317 7.27025 4.31613C7.27025 3.83852 6.88361 3.45757 6.41168 3.45757H3.09681C2.90349 3.45757 2.73291 3.57697 2.67037 3.75892L2.64762 3.82715C2.39745 4.53788 1.61279 4.90747 0.907744 4.65729C0.202694 4.40711 -0.172574 3.62246 0.0776046 2.91741L0.100348 2.84918L0.0946622 2.84349ZM3.17641 13.459C3.17641 12.9765 3.36811 12.5137 3.70933 12.1725C4.05054 11.8312 4.51334 11.6396 4.99589 11.6396C5.47845 11.6396 5.94124 11.8312 6.28246 12.1725C6.62368 12.5137 6.81538 12.9765 6.81538 13.459C6.81538 13.9416 6.62368 14.4044 6.28246 14.7456C5.94124 15.0868 5.47845 15.2785 4.99589 15.2785C4.51334 15.2785 4.05054 15.0868 3.70933 14.7456C3.36811 14.4044 3.17641 13.9416 3.17641 13.459Z",fill:t})})},A=s(3069);let S=e=>{let{isOpen:t,onClose:s,isVoiceDetected:i,selectedMic:a,acquireMic:o}=e,[r,c]=(0,l.useState)([]),d=async()=>{c((await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind))};return(0,l.useEffect)(()=>{d(),navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=d)},[]),(0,l.useEffect)(()=>{let e=setInterval(()=>{d()},1e3);return()=>clearInterval(e)},[]),(0,n.jsxs)(A.y,{isOpen:t,onClose:s,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsx)(A.y.Container,{style:{backgroundColor:"#FAFBFF"},children:(0,n.jsx)(A.y.Content,{children:(0,n.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Settings"}),(0,n.jsx)("div",{className:"flex gap-3",children:(0,n.jsx)("button",{onClick:s,children:(0,n.jsx)(N._0w,{})})})]}),(0,n.jsxs)("div",{className:"mt-6 flex flex-col gap-5",children:[(0,n.jsx)("div",{className:"flex items-center gap-2 text-black",children:(0,n.jsx)("p",{children:"Your Microphone"})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:r.map(e=>(0,n.jsx)("button",{className:"flex w-full items-center justify-between rounded-lg border px-3 py-3 font-normal ".concat(a==e.deviceId?"border-[#0039FF] bg-[#0039FF]/5 text-[#0039FF]":"bg-white"),onClick:()=>{o(e.deviceId)},children:(0,n.jsx)("p",{className:"text-sm",children:e.label||"Unknown Microphone"})},e.deviceId))}),(0,n.jsxs)("div",{className:"mb-12 flex items-center gap-2 text-sm text-black/30",children:[(0,n.jsx)("p",{children:"Try speaking to test your microphone:"}),(0,n.jsx)("div",{className:"flex h-1 w-8 items-center justify-center rounded-full ".concat(i?"bg-green-500":"bg-black/10")})]})]})]})})}),(0,n.jsx)(A.y.Backdrop,{onTap:s})]})};var T=s(68171);let F=e=>{let{isOpen:t,onClose:s}=e;return(0,n.jsxs)(A.y,{isOpen:t,onClose:s,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsx)(A.y.Container,{style:{backgroundColor:"#FAFBFF"},children:(0,n.jsx)(A.y.Content,{children:(0,n.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Tips and tricks"}),(0,n.jsx)("div",{className:"flex gap-3",children:(0,n.jsx)("button",{onClick:s,children:(0,n.jsx)(N._0w,{})})})]}),(0,n.jsx)("div",{className:"mt-6 flex flex-col gap-5",children:(0,n.jsxs)("div",{className:"text-black",children:[(0,n.jsx)("p",{children:"Did you know that you can use your native language to ask questions?"}),(0,n.jsx)("p",{className:"mt-2 italic text-[#0039FF]/50",children:'E.g. "How do I say that I am traveling to Portugal soon?"'})]})})]})})}),(0,n.jsx)(A.y.Backdrop,{onTap:s})]})},E=e=>{let{isOpen:t,onClose:s,inputBar:l}=e;return(0,n.jsxs)(A.y,{isOpen:t,onClose:s,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},disableDrag:!0,children:[(0,n.jsxs)(A.y.Container,{style:{backgroundColor:"#FAFBFF",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,n.jsx)(A.y.Header,{}),(0,n.jsx)(A.y.Content,{children:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center pb-16 pt-4",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Speak again..."}),(0,n.jsx)("p",{className:"mb-6 mt-2 text-black/30",children:"Tap and hold the button"}),l]})})]}),(0,n.jsx)(A.y.Backdrop,{onTap:s})]})},D=e=>{let{isOpen:t,onClose:s,onQuit:l}=e;return(0,n.jsxs)(A.y,{isOpen:t,onClose:s,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsxs)(A.y.Container,{style:{backgroundColor:"#FAFBFF",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,n.jsx)(A.y.Header,{}),(0,n.jsx)(A.y.Content,{children:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center px-7 pb-16 pt-4 text-center",children:[(0,n.jsx)("p",{className:"text-4xl font-semibold",children:"\uD83D\uDE2D"}),(0,n.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Quit and you'll lose all XP gained in this lesson!"}),(0,n.jsx)("button",{className:"mt-8 flex w-full items-center justify-center rounded-full bg-[#0039FF] py-4 text-white",onClick:()=>{s()},children:(0,n.jsx)("p",{className:"text-base font-bold",children:"Keep learning"})}),(0,n.jsx)("button",{className:"mt-2 flex w-full items-center justify-center py-4 font-semibold text-red-600",onClick:()=>{l()},children:"Quit"})]})})]}),(0,n.jsx)(A.y.Backdrop,{onTap:s})]})};var _=s(16593),P=s(33344);let R=e=>{var t;let{isOpen:s,onClose:l,onFinish:i,streakPlus:o,xp:c,words:d,minutes:u}=e,m=(0,r.useRouter)(),[f,h]=(0,a.useLocalStorage)("language"),{data:p,isLoading:g}=(0,_.a)({...(0,P.rs)({query:{language:f}})}),v=Object.entries(p||{});v.length>0&&(null===(t=v[0][1])||void 0===t||t.streak);let j={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.5}}};return(0,n.jsxs)(A.y,{isOpen:s,onClose:l,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsxs)(A.y.Container,{style:{backgroundColor:"#FAFBFF",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,n.jsx)(A.y.Header,{}),(0,n.jsx)(A.y.Content,{children:(0,n.jsx)("main",{className:"flex flex-col bg-[#FAFBFF] pb-10 tracking-[-0.02em]",children:(0,n.jsxs)("div",{className:"flex h-full flex-col justify-between px-8",children:[(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,n.jsxs)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex h-[10.75rem] flex-col items-center justify-center gap-5",children:[(0,n.jsx)(x.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,n.jsx)(x.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,n.jsx)(N.QJe,{className:"text-4xl text-[#FFC800] ".concat(1==e&&"-translate-y-3")})},e))}),(0,n.jsx)(x.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},className:"mt-2 text-center text-xl font-semibold",children:"Lesson complete!"})]},"encouragement"),(0,n.jsxs)("div",{className:"mt-0 grid w-full grid-cols-3 gap-2",children:[(0,n.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center rounded-xl border-[1px] border-[#DADADA] bg-white py-4",variants:j,initial:"hidden",animate:"visible",children:[(0,n.jsx)(N.LkT,{className:"text-xl text-[#FFC800]"}),(0,n.jsx)("div",{className:"mt-2 text-lg font-medium",children:c}),(0,n.jsx)("div",{className:"text-xs text-black/30",children:"XP"})]}),(0,n.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center rounded-xl border-[1px] border-[#DADADA] bg-white py-4",variants:j,initial:"hidden",animate:"visible",children:[(0,n.jsx)(N.ml,{className:"text-xl text-[#CD348E]"}),(0,n.jsx)("div",{className:"mt-2 text-lg font-medium",children:d}),(0,n.jsx)("div",{className:"text-xs text-black/30",children:"Words"})]}),(0,n.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center rounded-xl border-[1px] border-[#DADADA] bg-white py-4",variants:j,initial:"hidden",animate:"visible",children:[(0,n.jsx)(N.qyc,{className:"text-xl text-[#34CD71]"}),(0,n.jsx)("div",{className:"mt-2 text-lg font-medium",children:u}),(0,n.jsx)("div",{className:"text-xs text-black/30",children:"Minutes"})]})]})]}),(0,n.jsx)("button",{className:"mt-8 flex w-full items-center justify-center rounded-full bg-[#0039FF] py-4 text-white",onClick:()=>{i(),o?m.push("/streakPlus"):m.push("/")},children:(0,n.jsx)("p",{className:"text-base font-semibold",children:"Finish lesson"})}),(0,n.jsx)("button",{className:"mt-2 flex w-full items-center justify-center py-4 font-semibold text-[#0039FF]",onClick:()=>{l()},children:"Continue conversation"})]})})})]}),(0,n.jsx)(A.y.Backdrop,{onTap:l})]})};function O(){var e,t,s,a,o,c,d,A,_,P,O,I,L,M;let B=(0,r.useSearchParams)().get("session_id"),V=(0,l.useRef)(null),{startRecording:W,stopRecording:H,playRecording:G,stopPlayback:Q,isPracticeRecording:q,isPlayingAudio:U}=(0,j.I)(),[Y,J]=(0,l.useState)(0),[K,z]=(0,l.useState)(!1),[Z,X]=(0,l.useState)(0),[$,ee]=(0,l.useState)(null),[et,es]=(0,l.useState)(""),[en,el]=(0,l.useState)(null),ei=(0,i.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",mode:"Beginner",showStreakPlus:!1,xp:0,startTime:new Date().toISOString(),speedPreference:"NORMAL",lessonInfo:{},saved:[]}),ea=(0,i.MV)("STT",{requirePcm:void 0,totalTranscript:"",currTranscript:"",tempTranscript:""}),eo=(0,i.MV)("CHAT",{messages:[],userPreview:null,assistantPreview:null}),er=(0,i.MV)("TTS",{volumeMultiplier:1}),[ec]=(0,l.useState)(1);(0,l.useEffect)(()=>((async()=>{try{await v.P.keepAwake()}catch(e){console.error("Failed to enable keep-awake",e)}})(),()=>{(async()=>{await v.P.allowSleep()})()}),[]);let{startSpeaker:ed,isPlaying:eu,latestAudioId:ex,latestCharIndex:em,setLatestAudioId:ef}=(0,g.Z)({onPlaybackChange:(e,t)=>{er.sendAction({type:e?"PLAYBACK_STARTED":"PLAYBACK_FINISHED",id:t})},volume:er.volumeMultiplier,speed:ec}),eh=(e,t)=>void 0==e||null==em?"":t?t.length>0?e.slice(0,em*e.length/t.length):e:e.slice(0,em),[ep,eg]=(0,l.useState)(!1),ev=(0,r.useRouter)(),[ej,ey]=(0,l.useState)(!0),[eb,ew]=(0,l.useState)(!0),[eN,eC]=(0,l.useState)(!1),[ek,eA]=(0,l.useState)(null),[eS,eT]=(0,l.useState)(!1),[eF,eE]=(0,l.useState)(!1),[eD,e_]=(0,l.useState)(!1),{isVoiceDetected:eP,isRecording:eR,isMuted:eO,setMuted:eI,selectedMic:eL,startRecording:eM,stopRecording:eB,cancelRecording:eV,acquireMic:eW}=(0,p.Z)({onAudioData:e=>{if(!ea.requirePcm){if(0==e.byteLength){console.warn("Empty audio blob received");return}ea.sendBinary({type:"STREAM_MIC"},e)}},onPCMData(e){if(ea.requirePcm){if(0===e.byteLength){console.warn("Empty pcm data received");return}ea.sendBinary({type:"STREAM_PCM"},e)}},onRecordingStart:()=>{"Realtime"!=ei.mode&&ea.sendAction({type:"PTT_PRESSED"})},onRecordingStop:e=>{"Realtime"!=ei.mode&&(e?ea.sendAction({type:"PTT_CANCELLED"}):ea.sendAction({type:"PTT_RELEASED"}))},onSpeechStart:()=>{ea.sendAction({type:"VAD_CHANGED",detected:!0})},onSpeechEnd:()=>{ea.sendAction({type:"VAD_CHANGED",detected:!1})},startMuted:!1,recordingChunkSize:100}),eH=parseInt(null!==(M=null==ex?void 0:ex.slice(1))&&void 0!==M?M:"")>=eo.messages.length,eG=(0,l.useMemo)(()=>eo.messages.concat(eo.userPreview||[]).concat(eo.assistantPreview&&(eH||eo.assistantPreview.tool_calls)?eo.assistantPreview:[]),[eo.messages,eo.userPreview,eo.assistantPreview,eH]),eQ=(0,i.MV)("TRANSLATION",{wordForWord:{},translations:{}}),[eq]=(0,i.tp)("CORRECTION",(e,t)=>{if("PERFECT"===t.type){if("Advanced"!==ei.mode&&z(!0),!eu&&!eR&&!q){let e=new Audio("encouragement.mp3");e.volume=.5,e.play()}setTimeout(()=>{z(!1)},1200)}},{corrections:{}}),eU=(0,i.MV)("AUTOCOMPLETE",{suggestions:[],translations:[],wordForWord:[],saved:[]}),eY=(0,l.useRef)(null),eJ=(0,l.useRef)(null),[eK,ez]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>{if(eJ.current){let{scrollTop:e,scrollHeight:t,clientHeight:s}=eJ.current;e+s>=t&&ez(!1)}},t=eJ.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}},[]),(0,l.useEffect)(()=>{if(!eK)return eY.current&&cancelAnimationFrame(eY.current),V.current&&(eY.current=requestAnimationFrame(()=>{var e;null===(e=V.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})})),()=>{eY.current&&cancelAnimationFrame(eY.current)}},[eG,eQ]),(0,l.useEffect)(()=>{J(eG.length/12),1==Y&&e_(!0)},[eG]),(0,l.useEffect)(()=>{"CONNECTED"!=ei.status&&"BACKEND_DISCONNECTED"!=ei.status&&(ep||(console.log("Auto starting lesson"),eg(!0),ed(()=>{ei.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),"Realtime"==ei.mode&&eM(),eI(!1)))},[ei.status]);let[eZ,eX]=(0,l.useState)(!1);return(0,n.jsxs)("div",{className:"flex h-full flex-col items-center tracking-[-0.02em]",children:[(0,n.jsx)(b.e,{isOpen:null!==$,onClose:()=>{X(0),ee(null),el(null)},detailedTranslation:"message"===$?{wordForWord:eQ.wordForWord[Z],translation:eQ.translations[Z]}:{wordForWord:eU.wordForWord[Z],translation:eU.translations[Z]},isTTSPlaying:eu&&"e"==ex,onTTSPlay:e=>{ed(),et&&er.sendAction({type:"SAY",text_stream:null!=e?e:et,id:"e"})},isPracticeRecording:q,setPracticeRecording:e=>{e?W():H()},isPracticePlaying:U,setPracticePlaying:e=>{e?G():Q()},onSave:null!=en?en:void 0,isSaved:"message"===$?ei.saved[Z]:"suggestion"===$?eU.saved[Z]:void 0}),(0,n.jsx)(S,{isOpen:eZ,onClose:()=>{eX(!1)},isVoiceDetected:eP,selectedMic:eL,acquireMic:eW}),(0,n.jsx)(E,{isOpen:null!==ek,onClose:()=>{eA(null)},inputBar:(0,n.jsx)(T.y,{onStartPress:()=>{eM(),eI(!1)},onEndPress:()=>{if(null===ek){console.error("Redo message index is null");return}eo.sendAction({type:"RESET_TO_MESSAGE",index:ek}),ef("l".concat(ek-1)),eB(),ed(),ez(!1),setTimeout(()=>{eA(null)},100)},onCancel:()=>{eV()},leftToggle:(0,n.jsx)("div",{}),rightToggle:(0,n.jsx)("div",{})})}),(0,n.jsx)(F,{isOpen:eN,onClose:()=>eC(!1)}),(0,n.jsx)(R,{isOpen:eD,onClose:()=>e_(!1),onFinish:()=>{ei.sendAction({type:"STOP_CALL"})},streakPlus:ei.showStreakPlus,xp:ei.xp,words:eG.filter(e=>"user"===e.role).reduce((e,t)=>"string"!=typeof t.content?e:e+t.content.split(" ").length,0),minutes:Math.ceil((new Date().getTime()-new Date(ei.startTime).getTime())/1e3/60)}),(0,n.jsx)(D,{isOpen:eF,onClose:()=>eE(!1),onQuit:()=>{ei.sendAction({type:"STOP_CALL"}),ev.back()}}),(0,n.jsx)("div",{className:"flex w-full flex-col items-center px-7 pb-2",children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between px-1",children:[(0,n.jsx)("button",{className:"flex h-12 items-center justify-center self-start rounded-full text-black",onClick:()=>{console.log("audioCall.showStreakPlus",ei.showStreakPlus),eg(!1),Y>=1?e_(!0):eE(!0)},children:(0,n.jsx)(N._0w,{className:"text-xl"})}),(0,n.jsx)("div",{className:"mx-5 h-1.5 flex-grow overflow-hidden rounded-full bg-[#D9D9D9]",children:(0,n.jsx)("div",{className:"h-full rounded-full bg-[#0039FF] transition-all duration-300 ease-out",style:{width:"".concat(100*Y,"%")}})}),(0,n.jsx)("button",{className:"flex h-12 items-center justify-center self-start rounded-full text-black/30",onClick:()=>{eX(!0)},children:(0,n.jsx)(N.kvo,{className:"text-xl"})})]})}),eS&&(0,n.jsx)("div",{className:"w-full flex-grow overflow-auto overscroll-contain px-7 pb-6 pt-1",children:(0,n.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-between rounded-lg bg-white px-4 py-5 shadow-[0_2px_10px_rgba(0,0,0,0.1)]",children:[(0,n.jsx)("div",{className:"rounded-sm bg-[#0039FF]/10 px-2 py-1 font-medium text-[#0039FF]",children:"Whiteboard"}),(0,n.jsx)("div",{className:"px-4",children:eG.length>0&&(0,n.jsx)("div",{children:(()=>{var e,t,s,l;let i=eG.slice().reverse().find(e=>"assistant"===e.role&&null!=e.tool_calls);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(m.AnimatedMarkdown,{content:(null==i?void 0:null===(s=i.tool_calls)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:null===(e=t.function)||void 0===e?void 0:e.arguments)?null===(l=JSON.parse(i.tool_calls[0].function.arguments))||void 0===l?void 0:l.text:"",sep:"word",animation:"fadeIn",animationDuration:"0.5s",animationTimingFunction:"ease-in-out"})})})()})}),eG.length>0&&(0,n.jsxs)("div",{className:"flex w-full items-center justify-center gap-4 pb-1",children:["string"==typeof(null===(t=ei.lessonInfo)||void 0===t?void 0:null===(e=t.tutor)||void 0===e?void 0:e.profile_picture_url)?(0,n.jsx)("img",{src:null===(a=ei.lessonInfo)||void 0===a?void 0:null===(s=a.tutor)||void 0===s?void 0:s.profile_picture_url,className:"h-7 w-7 rounded-full"}):null===(c=ei.lessonInfo)||void 0===c?void 0:null===(o=c.tutor)||void 0===o?void 0:o.profile_picture_url,(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"max-h-[3em] min-w-0 flex-1 overflow-y-auto text-sm text-black/50",children:(()=>{let e=eG.findLastIndex(e=>"assistant"===e.role),t=eG[e];if("string"!=typeof(null==t?void 0:t.content))return"\uD83D\uDD0A";let s=null==t?void 0:t.content,n=eu&&"r".concat(e.toString())===ex,l=eH&&"l".concat(e.toString())===ex;return n||l?eh(s):s})()}),(0,n.jsx)("div",{className:"h-0 min-w-0 flex-1 text-sm text-black/50",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden",textOverflow:"ellipsis",textAlign:"left"},children:(()=>{let e=eG.findLastIndex(e=>"assistant"===e.role),t=eG[e];return"string"!=typeof(null==t?void 0:t.content)?"\uD83D\uDD0A":null==t?void 0:t.content})()})]})]})]})}),(0,n.jsxs)("div",{className:"w-full flex-grow overflow-auto overscroll-contain px-7 pt-1 ".concat(eS?"hidden":""),onTouchStart:()=>ez(!0),ref:eJ,children:[eG.length>0&&"Realtime"!==ei.mode&&eG.map((e,t)=>{var s,l,i,a;let o=eu&&"r".concat(t.toString())==ex,r=eH&&"l".concat(t.toString())==ex,c=o||r;if((null==e?void 0:e.role)==="assistant")return(0,n.jsxs)("div",{children:[e.content&&(0,n.jsx)(w.nQ,{profilePicture:null===(l=ei.lessonInfo)||void 0===l?void 0:null===(s=l.tutor)||void 0===s?void 0:s.profile_picture_url,isPlaying:c,message:"Advanced"!=ei.mode&&eb?"string"!=typeof e.content?"\uD83D\uDD0A":c?eh(e.content):e.content:void 0,translation:"Advanced"!=ei.mode&&eb&&"string"==typeof e.content?c?eh(eQ.translations[t],e.content):eQ.translations[t]:void 0,onTap:()=>{r||"string"!=typeof e.content||(eQ.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),es(e.content),X(t),ee("message"),el(()=>e=>{ei.sendAction({type:e?"DELETE_MESSAGE":"SAVE_MESSAGE",index:t})}))},onTTSPlay:()=>{ed(),er.sendAction({type:"SAY",text_stream:null==e?void 0:e.content,id:"r".concat(t)})},onTTSStop:()=>{ed(),er.sendAction({type:"STOP",id:"r".concat(t)})},onTranslate:e=>{e&&(eQ.translations[t]||eQ.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==ei.mode||"Smart"==ei.mode}),e.tool_calls&&(0,n.jsx)(w.TH,{title:e.tool_calls[0].function.name,message:null!==(a=null===(i=JSON.parse(e.tool_calls[0].function.arguments))||void 0===i?void 0:i.text)&&void 0!==a?a:"",onTap:()=>{}},t)]},t);if((null==e?void 0:e.role)==="user"){let s=eq.corrections[t];return(0,n.jsx)(w.MI,{message:"string"==typeof e.content?e.content:"\uD83D\uDD0A",translation:eQ.translations[t],correction:s,onTap:()=>{r||"string"!=typeof e.content||(eQ.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),es(e.content),X(t),ee("message"),el(()=>()=>{ei.sendAction({type:"SAVE_MESSAGE",index:t})}))},onTranslate:e=>{e&&(eQ.translations[t]||eQ.sendAction({type:"REQUEST_TRANSLATION",index:t}))},onRedo:()=>{eA(t)},defaultShowTranslation:"Beginner"==ei.mode||"Smart"==ei.mode},t)}}),"Realtime"==ei.mode&&(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,n.jsxs)("div",{className:"mb-16 flex w-full flex-col items-center gap-2 rounded-xl border-[1px] border-black/10 bg-white py-6",children:[(0,n.jsx)("img",{src:null===(A=ei.lessonInfo)||void 0===A?void 0:null===(d=A.tutor)||void 0===d?void 0:d.profile_picture_url,alt:"",className:"h-20 w-20"}),(0,n.jsx)("div",{className:"text-lg font-medium",children:null===(P=ei.lessonInfo)||void 0===P?void 0:null===(_=P.lesson)||void 0===_?void 0:_.title}),(0,n.jsx)("div",{className:"text-3xl",children:null===(I=ei.lessonInfo)||void 0===I?void 0:null===(O=I.lesson)||void 0===O?void 0:O.emoji}),(0,n.jsx)("div",{className:"rounded-md bg-[#0039FF]/10 p-2 text-[#0039FF]",children:"Real time call"})]}),(0,n.jsx)("div",{className:"mx-8 text-center text-sm text-black/30",children:"Caution: This mode is experimental and may not work as expected."})]}),(0,n.jsx)("div",{ref:V})]}),(0,n.jsx)("div",{className:"pointer-events-none w-full justify-end gap-5 tracking-[-0.02em]",children:(0,n.jsxs)("div",{className:"pointer-events-auto flex w-full flex-col gap-4 pb-10 pt-4 ".concat("Realtime"==ei.mode?"":"border-t-[1px] border-black/10 bg-white"),children:[(0,n.jsx)(u.M,{mode:"wait",children:!K||eR||eS?eG.length>0&&"Realtime"!==ei.mode&&"Advanced"!==ei.mode?(0,n.jsxs)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,n.jsx)("div",{className:"mb-1 flex justify-center text-base font-light text-black/30",onClick:()=>{ey(!ej)},children:(0,n.jsx)(x.E.div,{animate:{rotateX:ej?0:180},transition:{duration:.6,ease:"easeInOut"},children:(0,n.jsx)(N.RiI,{className:"scale-y-75 transform"})})}),(0,n.jsx)(u.M,{children:ej&&(0,n.jsx)(x.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut",opacity:{duration:.05,ease:"easeInOut"},height:{duration:.3,ease:"easeInOut"}},className:"overflow-hidden",children:(0,n.jsx)("div",{className:"h-32",children:(0,n.jsx)(f.tq,{pagination:!0,modules:[h.tl],className:"w-screen bg-white",children:(null===(L=eU.suggestions)||void 0===L?void 0:L.length)>=3?eU.suggestions.map((e,t)=>(0,n.jsx)(f.o5,{className:"mb-4 !h-auto px-6 py-2",children:(0,n.jsxs)("button",{onClick:()=>{es(e),X(t),ee("suggestion"),el(()=>e=>{console.log("saving suggestion"),eU.sendAction({type:e?"DELETE_SUGGESTION":"SAVE_SUGGESTION",index:t})})},className:"flex h-full w-full flex-col items-center rounded-lg bg-white p-4 shadow-custom-shadow",children:["Intermediate"===ei.mode||"Advanced"===ei.mode?(0,n.jsx)("div",{className:"flex flex-wrap gap-1 gap-y-5",children:eU.wordForWord[t]&&eU.wordForWord[t].length>0&&eU.wordForWord[t].map((e,t)=>(0,n.jsx)("div",{className:"flex flex-col items-center",children:(0,n.jsx)("div",{className:"mb-1 text-nowrap rounded-sm bg-black/5 px-1 font-normal text-black/0",children:e.original})},t))}):(0,n.jsx)("div",{className:"w-full overflow-hidden overflow-ellipsis whitespace-nowrap",children:(0,y.f)(e)}),(0,n.jsx)("div",{className:"w-full overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-black/30",children:(0,y.f)(eU.translations[t])})]})},t)):(0,n.jsx)(n.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,n.jsx)(f.o5,{className:"mb-4 !h-auto px-6 py-2",children:(0,n.jsx)("div",{className:"h-full w-full rounded-lg bg-white p-4 shadow-custom-shadow",children:(0,n.jsxs)("div",{className:"flex w-full flex-col items-center space-y-2",children:[(0,n.jsx)("div",{className:"animate-shimmer h-5 w-2/3 rounded bg-gray-200"}),(0,n.jsx)("div",{className:"animate-shimmer h-5 w-2/3 rounded bg-gray-200"})]})})},t))})})})})})]},"messages"):null:(0,n.jsxs)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex h-[10.75rem] flex-col items-center justify-center gap-5",children:[(0,n.jsx)(x.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,n.jsx)(x.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,n.jsx)(N.QJe,{className:"text-[#0039FF]"})},e))}),(0,n.jsx)(x.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},children:"Amazing \uD83E\uDD73"})]},"encouragement")}),"CONNECTED"!==ei.status?(0,n.jsx)("button",{className:"mx-8 flex h-[3.6rem] flex-grow items-center justify-center rounded-full bg-[#0039FF] px-4 font-bold text-white",onClick:()=>{ep||(eg(!0),ed(()=>{ei.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),"Realtime"==ei.mode&&eM(),eI(!1))},children:(0,n.jsx)(N.fCD,{className:"animate-spin"})}):"Realtime"==ei.mode?(0,n.jsxs)("div",{className:"mx-8 flex w-full items-center justify-between",children:[(0,n.jsxs)("button",{className:"relative flex h-14 w-14 items-center justify-center rounded-full bg-black/5 ".concat(eP?"ring-4":""," ").concat(eO?"ring-red-500/70":"ring-green-500/70"),onClick:()=>{ed(),eR||eM(),eI(!eO)},children:[(0,n.jsx)(C.J,{icon:eO?N.uYL:N.RgM,className:"text-xl text-black"}),eP&&eO&&(0,n.jsx)("p",{className:"absolute -right-[120px] -top-8 rounded-full rounded-bl-none bg-black/5 p-2 text-sm",children:"Press to unmute"})]}),(0,n.jsx)("button",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-black/5",onClick:()=>{eg(!1),ei.sendAction({type:"STOP_CALL"}),console.log("audioCall.showStreakPlus",ei.showStreakPlus),ev.push("/feedback?session_id=".concat(B))},children:(0,n.jsx)(N._0w,{className:"text-xl text-black"})})]}):"Smart"==ei.mode?(0,n.jsx)(T.y,{onStartPress:()=>{eM(),eI(!1)},onEndPress:()=>{eB(),ed(),ez(!1)},onCancel:()=>{eV()},leftToggle:(0,n.jsx)("div",{children:void 0!==eb&&ew&&(0,n.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-full ".concat(eb?"bg-black/5":"bg-[#0039FF]/10 text-[#0039FF]"),onClick:()=>{ew(!eb)},children:(0,n.jsx)(N.Vbz,{})})}),rightToggle:(0,n.jsx)("div",{children:(0,n.jsx)("button",{className:"flex h-14 w-14 items-center justify-center rounded-full text-xl ".concat(eS?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{if(eT(!eS),eS||ey(!1),eS){var e;console.log("instant scroll"),null===(e=V.current)||void 0===e||e.scrollIntoView({behavior:"instant",block:"end",inline:"nearest"})}},children:(0,n.jsx)(N.$e0,{})})})}):(0,n.jsx)(T.y,{onStartPress:()=>{eM(),eI(!1)},onEndPress:()=>{eB(),ed(),ez(!1)},onCancel:()=>{eV()},leftToggle:(0,n.jsx)("div",{children:void 0!==eb&&ew&&(0,n.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-full ".concat(eb?"bg-black/5":"bg-[#0039FF]/10 text-[#0039FF]"),onClick:()=>{ew(!eb)},children:(0,n.jsx)(N.Vbz,{})})}),rightToggle:(0,n.jsx)("div",{children:void 0!==eN&&eC&&(0,n.jsx)("button",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-black/5",onClick:()=>{eC(!eN)},children:(0,n.jsx)(k,{})})})})]})})]})}function I(){return(0,n.jsx)(d,{children:(0,n.jsx)("main",{className:"h-screen-safe bg-[#FAFBFF] pt-1",children:(0,n.jsx)(O,{})})})}}},function(e){e.O(0,[4722,7240,1015,6051,6491,1649,755,9787,4272,3069,4438,813,3344,9939,3386,2971,2117,1744],function(){return e(e.s=93658)}),_N_E=e.O()}]);