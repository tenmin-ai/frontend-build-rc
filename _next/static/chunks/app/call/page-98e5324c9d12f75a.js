(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2293],{93658:function(e,t,n){Promise.resolve().then(n.bind(n,4825))},4825:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var l=n(57437),s=n(2265),i=n(74272),r=n(53974),o=n(93772),a=n(99376),c=n(89403);function d(e){let{children:t}=e,n=(0,r.useIsClient)(),{token:s}=(0,c.f)(),d=(0,a.useSearchParams)().get("session_id");return d?n?(0,l.jsx)(i.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/lesson/").concat(d,"?token=").concat(s),label:"Call",toast:o.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):null:(0,l.jsx)("div",{children:"Invalid lesson"})}var u=n(5095),x=n(60755),m=n(15731),f=n(19764);n(7354),n(76889);var h=n(73377),p=n(49677),g=n(56870),v=n(15123),j=n(80434),y=n(61273),b=n(3069),w=n(22744),N=n(32859);let S=e=>{var t,n;let{isOpen:i,onClose:r,detailedTranslation:o,isTTSPlaying:a,onTTSPlay:c,isPracticeRecording:d,setPracticeRecording:u,isPracticePlaying:x,setPracticePlaying:m,onSave:f,isSaved:h}=e,p=null!==(t=null==o?void 0:o.wordForWord)&&void 0!==t?t:[],g=null!==(n=null==o?void 0:o.translation)&&void 0!==n?n:"",[v,j]=(0,s.useState)(null);return(0,l.jsxs)(b.y,{isOpen:i,onClose:()=>{r(),j(null)},detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,l.jsx)(b.y.Container,{children:(0,l.jsx)(b.y.Content,{style:{backgroundImage:"white"},children:(0,l.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-lg font-semibold",children:"Explanation"}),(0,l.jsxs)("div",{className:"flex gap-0",children:[void 0!==f&&(0,l.jsx)("button",{className:"p-2",onClick:()=>{f(null!=h&&h)},children:h?(0,l.jsx)(y.VF9,{}):(0,l.jsx)(y.mCg,{})}),(0,l.jsx)("button",{className:"p-2 text-lg",onClick:()=>{r(),j(null)},children:(0,l.jsx)(y._0w,{})})]})]}),(0,l.jsx)("div",{className:"mt-4 flex flex-wrap gap-1 gap-y-2",children:p.length>0&&p.map((e,t)=>(0,l.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(v===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let n=e.original.trim();RegExp("^\\p{P}+$","u").test(n)||(c(n),j(t))},children:[(0,l.jsx)("div",{className:"text-nowrap px-1 text-xl font-normal",children:e.original}),(0,l.jsx)("div",{className:"text-nowrap px-1 text-sm opacity-50",children:e.translation})]},t))}),(0,l.jsxs)("div",{className:"mt-6 flex items-start gap-2 text-sm text-black/30",children:[(0,l.jsx)(w.mp2,{className:"flex-shrink-0 text-xl text-black/30"}),(0,l.jsx)("div",{children:g})]}),(0,l.jsxs)("div",{className:"mx-10 mt-10 flex justify-center gap-6",children:[(0,l.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>{c(),j(null)},className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,l.jsx)(N.J,{className:"text-lg text-[#0039FF]",icon:a?y.JuG:y.gmG})}),(0,l.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,l.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>u(!d),className:"flex h-14 w-14 items-center justify-center rounded-full bg-[#0039FF] p-4 shadow-custom-blue-shadow",children:(0,l.jsx)(N.J,{className:"text-xl text-white",icon:d?y.u9M:y.uYL})}),(0,l.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,l.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>m(!x),className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,l.jsx)(y.tdo,{className:"text-xl text-[#0039FF]"})}),(0,l.jsx)("div",{className:"text-nowrap text-sm",children:"Your sound"})]})]})]})})}),(0,l.jsx)(b.y.Backdrop,{onTap:r})]})};var T=n(28529),A=e=>{let{color:t="black"}=e;return(0,l.jsx)("svg",{width:"10",height:"16",viewBox:"0 0 10 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M0.0946622 2.84349C0.543847 1.57554 1.74925 0.722656 3.09681 0.722656H6.41168C8.39605 0.722656 9.99947 2.33176 9.99947 4.31045C9.99947 5.59546 9.31148 6.78381 8.19705 7.42631L6.36051 8.4782C6.34913 9.21737 5.74074 9.82007 4.99589 9.82007C4.23967 9.82007 3.63128 9.21168 3.63128 8.45546V7.68786C3.63128 7.19888 3.89283 6.74969 4.31927 6.5052L6.83812 5.06099C7.10536 4.90747 7.27025 4.62317 7.27025 4.31613C7.27025 3.83852 6.88361 3.45757 6.41168 3.45757H3.09681C2.90349 3.45757 2.73291 3.57697 2.67037 3.75892L2.64762 3.82715C2.39745 4.53788 1.61279 4.90747 0.907744 4.65729C0.202694 4.40711 -0.172574 3.62246 0.0776046 2.91741L0.100348 2.84918L0.0946622 2.84349ZM3.17641 13.459C3.17641 12.9765 3.36811 12.5137 3.70933 12.1725C4.05054 11.8312 4.51334 11.6396 4.99589 11.6396C5.47845 11.6396 5.94124 11.8312 6.28246 12.1725C6.62368 12.5137 6.81538 12.9765 6.81538 13.459C6.81538 13.9416 6.62368 14.4044 6.28246 14.7456C5.94124 15.0868 5.47845 15.2785 4.99589 15.2785C4.51334 15.2785 4.05054 15.0868 3.70933 14.7456C3.36811 14.4044 3.17641 13.9416 3.17641 13.459Z",fill:t})})};let C=e=>{let{isOpen:t,onClose:n,isVoiceDetected:i,selectedMic:r,acquireMic:o}=e,[a,c]=(0,s.useState)([]),d=async()=>{c((await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind))};return(0,s.useEffect)(()=>{d(),navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=d)},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{d()},1e3);return()=>clearInterval(e)},[]),(0,l.jsxs)(b.y,{isOpen:t,onClose:n,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,l.jsx)(b.y.Container,{style:{backgroundColor:"#FAFBFF"},children:(0,l.jsx)(b.y.Content,{children:(0,l.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-lg font-semibold",children:"Settings"}),(0,l.jsx)("div",{className:"flex gap-3",children:(0,l.jsx)("button",{onClick:n,children:(0,l.jsx)(y._0w,{})})})]}),(0,l.jsxs)("div",{className:"mt-6 flex flex-col gap-5",children:[(0,l.jsx)("div",{className:"flex items-center gap-2 text-black",children:(0,l.jsx)("p",{children:"Your Microphone"})}),(0,l.jsx)("div",{className:"flex flex-col gap-2",children:a.map(e=>(0,l.jsx)("button",{className:"flex w-full items-center justify-between rounded-lg border px-3 py-3 font-normal ".concat(r==e.deviceId?"border-[#0039FF] bg-[#0039FF]/5 text-[#0039FF]":"bg-white"),onClick:()=>{o(e.deviceId)},children:(0,l.jsx)("p",{className:"text-sm",children:e.label||"Unknown Microphone"})},e.deviceId))}),(0,l.jsxs)("div",{className:"mb-12 flex items-center gap-2 text-sm text-black/30",children:[(0,l.jsx)("p",{children:"Try speaking to test your microphone:"}),(0,l.jsx)("div",{className:"flex h-1 w-8 items-center justify-center rounded-full ".concat(i?"bg-green-500":"bg-black/10")})]})]})]})})}),(0,l.jsx)(b.y.Backdrop,{onTap:n})]})};var E=n(68171);let k=e=>{let{isOpen:t,onClose:n}=e;return(0,l.jsxs)(b.y,{isOpen:t,onClose:n,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,l.jsx)(b.y.Container,{style:{backgroundColor:"#FAFBFF"},children:(0,l.jsx)(b.y.Content,{children:(0,l.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-lg font-semibold",children:"Tips and tricks"}),(0,l.jsx)("div",{className:"flex gap-3",children:(0,l.jsx)("button",{onClick:n,children:(0,l.jsx)(y._0w,{})})})]}),(0,l.jsx)("div",{className:"mt-6 flex flex-col gap-5",children:(0,l.jsxs)("div",{className:"text-black",children:[(0,l.jsx)("p",{children:"Did you know that you can use your native language to ask questions?"}),(0,l.jsx)("p",{className:"mt-2 italic text-[#0039FF]/50",children:'E.g. "How do I say that I am traveling to Portugal soon?"'})]})})]})})}),(0,l.jsx)(b.y.Backdrop,{onTap:n})]})},F=e=>{let{isOpen:t,onClose:n,inputBar:s}=e;return(0,l.jsxs)(b.y,{isOpen:t,onClose:n,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},disableDrag:!0,children:[(0,l.jsxs)(b.y.Container,{style:{backgroundColor:"#FAFBFF",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,l.jsx)(b.y.Header,{}),(0,l.jsx)(b.y.Content,{children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center pb-16 pt-4",children:[(0,l.jsx)("p",{className:"text-lg font-semibold",children:"Speak again..."}),(0,l.jsx)("p",{className:"mb-6 mt-2 text-black/30",children:"Tap and hold the button"}),s]})})]}),(0,l.jsx)(b.y.Backdrop,{onTap:n})]})},R=e=>{let{isOpen:t,onClose:n,onQuit:s}=e;return(0,l.jsxs)(b.y,{isOpen:t,onClose:n,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,l.jsxs)(b.y.Container,{style:{backgroundColor:"#FAFBFF",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,l.jsx)(b.y.Header,{}),(0,l.jsx)(b.y.Content,{children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center px-7 pb-16 pt-4 text-center",children:[(0,l.jsx)("p",{className:"text-4xl font-semibold",children:"\uD83D\uDE2D"}),(0,l.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Quit and you'll lose all XP gained in this lesson!"}),(0,l.jsx)("button",{className:"mt-8 flex w-full items-center justify-center rounded-full bg-[#0039FF] py-4 text-white",onClick:()=>{n()},children:(0,l.jsx)("p",{className:"text-base font-bold",children:"Keep learning"})}),(0,l.jsx)("button",{className:"mt-2 flex w-full items-center justify-center py-4 font-semibold text-red-600",onClick:()=>{s()},children:"Quit"})]})})]}),(0,l.jsx)(b.y.Backdrop,{onTap:n})]})};var _=n(16593),D=n(33344);let P=e=>{var t;let{isOpen:n,onClose:s,onFinish:i,streakPlus:o,xp:c,words:d,minutes:u}=e,m=(0,a.useRouter)(),[f,h]=(0,r.useLocalStorage)("language"),{data:p,isLoading:g}=(0,_.a)({...(0,D.rs)({query:{language:f}})}),v=Object.entries(p||{});v.length>0&&(null===(t=v[0][1])||void 0===t||t.streak);let j={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.5}}};return(0,l.jsxs)(b.y,{isOpen:n,onClose:s,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,l.jsxs)(b.y.Container,{style:{backgroundColor:"#FAFBFF",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,l.jsx)(b.y.Header,{}),(0,l.jsx)(b.y.Content,{children:(0,l.jsx)("main",{className:"flex flex-col bg-[#FAFBFF] pb-10 tracking-[-0.02em]",children:(0,l.jsxs)("div",{className:"flex h-full flex-col justify-between px-8",children:[(0,l.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,l.jsxs)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex h-[10.75rem] flex-col items-center justify-center gap-5",children:[(0,l.jsx)(x.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,l.jsx)(x.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,l.jsx)(y.QJe,{className:"text-4xl text-[#FFC800] ".concat(1==e&&"-translate-y-3")})},e))}),(0,l.jsx)(x.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},className:"mt-2 text-center text-xl font-semibold",children:"Lesson complete!"})]},"encouragement"),(0,l.jsxs)("div",{className:"mt-0 grid w-full grid-cols-3 gap-2",children:[(0,l.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center rounded-xl border-[1px] border-[#DADADA] bg-white py-4",variants:j,initial:"hidden",animate:"visible",children:[(0,l.jsx)(y.LkT,{className:"text-xl text-[#FFC800]"}),(0,l.jsx)("div",{className:"mt-2 text-lg font-medium",children:c}),(0,l.jsx)("div",{className:"text-xs text-black/30",children:"XP"})]}),(0,l.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center rounded-xl border-[1px] border-[#DADADA] bg-white py-4",variants:j,initial:"hidden",animate:"visible",children:[(0,l.jsx)(y.ml,{className:"text-xl text-[#CD348E]"}),(0,l.jsx)("div",{className:"mt-2 text-lg font-medium",children:d}),(0,l.jsx)("div",{className:"text-xs text-black/30",children:"Words"})]}),(0,l.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center rounded-xl border-[1px] border-[#DADADA] bg-white py-4",variants:j,initial:"hidden",animate:"visible",children:[(0,l.jsx)(y.qyc,{className:"text-xl text-[#34CD71]"}),(0,l.jsx)("div",{className:"mt-2 text-lg font-medium",children:u}),(0,l.jsx)("div",{className:"text-xs text-black/30",children:"Minutes"})]})]})]}),(0,l.jsx)("button",{className:"mt-8 flex w-full items-center justify-center rounded-full bg-[#0039FF] py-4 text-white",onClick:()=>{i(),o?m.push("/streakPlus"):m.push("/")},children:(0,l.jsx)("p",{className:"text-base font-semibold",children:"Finish lesson"})}),(0,l.jsx)("button",{className:"mt-2 flex w-full items-center justify-center py-4 font-semibold text-[#0039FF]",onClick:()=>{s()},children:"Continue conversation"})]})})})]}),(0,l.jsx)(b.y.Backdrop,{onTap:s})]})};function O(){var e,t,n,r,o,c,d,b,w,_,D,O,I,L,M,B;let W=(0,a.useSearchParams)().get("session_id"),G=(0,s.useRef)(null),{startRecording:U,stopRecording:V,playRecording:Q,stopPlayback:H,isPracticeRecording:Y,isPlayingAudio:J}=function(){let[e,t]=(0,s.useState)(!1),[n,l]=(0,s.useState)(!1),i=(0,s.useRef)(null),r=(0,s.useRef)(null),o=(0,s.useRef)(null),[a,c]=(0,s.useState)(null),d=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});i.current=e,r.current=new MediaRecorder(e);let n=[];r.current.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},r.current.onstop=()=>{let e=new Blob(n,{type:"audio/mpeg"});c(e),t(!1)},r.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},u=()=>{r.current&&"recording"===r.current.state&&r.current.stop(),i.current&&i.current.getTracks().forEach(e=>e.stop())},x=()=>{o.current&&(o.current.pause(),o.current.currentTime=0,l(!1))};return(0,s.useEffect)(()=>()=>{u(),x()},[]),{startRecording:d,stopRecording:u,playRecording:()=>{a?(o.current||(o.current=new Audio),o.current.src=URL.createObjectURL(a),o.current.play(),l(!0),o.current.onended=()=>{l(!1)}):console.warn("No recording available to play")},stopPlayback:x,isPracticeRecording:e,isPlayingAudio:n}}(),[q,K]=(0,s.useState)(0),[z,X]=(0,s.useState)(!1),[Z,$]=(0,s.useState)(0),[ee,et]=(0,s.useState)(null),[en,el]=(0,s.useState)(""),[es,ei]=(0,s.useState)(null),er=(0,i.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",mode:"Beginner",showStreakPlus:!1,xp:0,startTime:new Date().toISOString(),speedPreference:"NORMAL",lessonInfo:{},saved:[]}),eo=(0,i.MV)("STT",{requirePcm:void 0,totalTranscript:"",currTranscript:"",tempTranscript:""}),ea=(0,i.MV)("CHAT",{messages:[],userPreview:null,assistantPreview:null}),ec=(0,i.MV)("TTS",{volumeMultiplier:1}),[ed]=(0,s.useState)(1);(0,s.useEffect)(()=>((async()=>{try{await v.P.keepAwake()}catch(e){console.error("Failed to enable keep-awake",e)}})(),()=>{(async()=>{await v.P.allowSleep()})()}),[]);let{startSpeaker:eu,isPlaying:ex,latestAudioId:em,latestCharIndex:ef,setLatestAudioId:eh}=function(e){let{onPlaybackStart:t,onPlaybackFinish:n,onPlaybackInterrupt:l,volume:r=1,speed:o=1}=e,a=(0,s.useContext)(i.Dm),c=(0,g.Y)(),d=(0,s.useRef)([]),u=(0,s.useRef)(0),x=(0,s.useRef)(null),m=(0,s.useRef)([]),f=(0,s.useRef)(null),h=(0,s.useRef)(null),p=(0,s.useRef)(!1),[v,j]=(0,s.useState)(!1),y=(0,s.useRef)(v),[b,w]=(0,s.useState)(!1),[N,S]=(0,s.useState)(null),T=(0,s.useRef)(null),[A,C]=(0,s.useState)(null),E=(0,s.useRef)(null),k=()=>{F(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==f.current&&(f.current.disconnect(),f.current=null,console.log("Gain node disconnected and released"))},F=()=>{if(m.current.forEach(e=>{clearTimeout(e)}),m.current=[],x.current&&(clearTimeout(x.current),x.current=null),0===d.current.length)return;let e=1,t=d.current.slice(0,5);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(5*t.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),j(!1),y.current=!1;let n=c.currentTime-u.current;null==l||l(T.current,n,A),d.current=t},R=()=>{j(!1),y.current=!1,w(!1),m.current=[],E.current=null,null==n||n(T.current)},_=async e=>{let{i:n,data:l,id:s,t:i}=e,r=new Int16Array(l),a=c.createBuffer(1,r.length,24e3),h=a.getChannelData(0);for(let e=0;e<r.length;e++)h[e]=r[e]/32768;if(null===f.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let p=c.createBufferSource();p.connect(f.current),p.playbackRate.value=o,p.buffer=a;let g=0==n;g&&(d.current.length>0&&F(),u.current=c.currentTime,console.log("Audio start time reset to",u.current));let v=u.current+.1*n/o+.1,b=c.currentTime-v;if(b>0&&(console.log("Audio chunk is late, delaying playback by ".concat(b," seconds.")),v+=b,u.current+=b),p.start(v),d.current.push(p),g&&(x.current=setTimeout(()=>{j(!0),y.current=!0,null==t||t(s),C(0),void 0==s&&console.error("First chunk must have an id"),S(s),T.current=s,x.current=null},-(1e3*b))),p.onended=()=>{d.current.length>0&&(d.current.shift(),w(!1)),E.current&&n==E.current-1?R():0===d.current.length&&w(!0)},void 0!=i){let e=m.current.length,t=c.currentTime,n=i.map((n,l)=>setTimeout(()=>C(e+l),1e3*(u.current+n-t)/o));m.current.push(...n)}};return(0,s.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",_),a.registerEvent("TTS_INTERRUPT",()=>{F()}),a.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;T.current!==t||y.current?E.current=n:R()}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,o]),(0,s.useEffect)(()=>{f.current&&(f.current.gain.value=r)},[r]),(0,s.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/o)},[o]),(0,s.useEffect)(()=>()=>{k()},[]),{isPlaying:v,isLagging:b,latestAudioId:N,setLatestAudioId:S,latestCharIndex:A,startSpeaker:(e,t)=>{if(null===f.current){if(p.current){console.log("Speaker is already initializing");return}p.current=!0;try{c.resume(),f.current=c.createGain(),console.log("Gain node created"),c.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(c,"phase-vocoder-processor"),f.current.connect(h.current),h.current.connect(c.destination),f.current.gain.value=r,h.current.parameters.get("pitchFactor").value=1/o,console.log("Phase vocoder worklet added"),null==e||e()}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{p.current=!1}null===f.current&&(null==t||t())}},stopSpeaker:k}}({onPlaybackStart:e=>{ec.sendAction({type:"PLAYBACK_STARTED",id:e})},onPlaybackFinish:e=>{ec.sendAction({type:"PLAYBACK_FINISHED",id:e})},onPlaybackInterrupt:(e,t,n)=>{ec.sendAction({type:"PLAYBACK_INTERRUPTED",id:e,played_duration:t,latest_char_index:n})},volume:ec.volumeMultiplier,speed:ed}),ep=(e,t)=>void 0==e||null==ef?"":t?t.length>0?e.slice(0,ef*e.length/t.length):e:e.slice(0,ef),[eg,ev]=(0,s.useState)(!1),ej=(0,a.useRouter)(),[ey,eb]=(0,s.useState)(!0),[ew,eN]=(0,s.useState)(!0),[eS,eT]=(0,s.useState)(!1),[eA,eC]=(0,s.useState)(null),[eE,ek]=(0,s.useState)(!1),[eF,eR]=(0,s.useState)(!1),[e_,eD]=(0,s.useState)(!1),{isVoiceDetected:eP,isRecording:eO,isMuted:eI,setMuted:eL,selectedMic:eM,startRecording:eB,stopRecording:eW,cancelRecording:eG,acquireMic:eU}=(0,p.Z)({onAudioData:e=>{if(!eo.requirePcm){if(0==e.byteLength){console.warn("Empty audio blob received");return}eo.sendBinary({type:"STREAM_MIC"},e)}},onPCMData(e){if(eo.requirePcm){if(0===e.byteLength){console.warn("Empty pcm data received");return}eo.sendBinary({type:"STREAM_PCM"},e)}},onRecordingStart:()=>{"Realtime"!=er.mode&&eo.sendAction({type:"PTT_PRESSED"})},onRecordingStop:e=>{"Realtime"!=er.mode&&(e?eo.sendAction({type:"PTT_CANCELLED"}):eo.sendAction({type:"PTT_RELEASED"}))},onSpeechStart:()=>{eo.sendAction({type:"VAD_CHANGED",detected:!0})},onSpeechEnd:()=>{eo.sendAction({type:"VAD_CHANGED",detected:!1})},startMuted:!1,recordingChunkSize:100}),eV=parseInt(null!==(B=null==em?void 0:em.slice(1))&&void 0!==B?B:"")>=ea.messages.length,eQ=ea.messages,eH=ea.userPreview,eY=ea.assistantPreview&&(eV||ea.assistantPreview.tool_calls)?ea.assistantPreview:null,eJ=(0,i.MV)("TRANSLATION",{wordForWord:{},translations:{}}),[eq]=(0,i.tp)("CORRECTION",(e,t)=>{if("PERFECT"===t.type){if("Advanced"!==er.mode&&X(!0),!ex&&!eO&&!Y){let e=new Audio("encouragement.mp3");e.volume=.5,e.play()}setTimeout(()=>{X(!1)},1200)}},{corrections:{}}),eK=(0,i.MV)("AUTOCOMPLETE",{suggestions:[],translations:[],wordForWord:[],saved:[]}),ez=(0,s.useRef)(null),eX=(0,s.useRef)(null),[eZ,e$]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if("Smart"==er.mode)return;let e=()=>{if(eX.current){let{scrollTop:e,scrollHeight:t,clientHeight:n}=eX.current;e+n>=t&&e$(!1)}},t=eX.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}},[]),(0,s.useEffect)(()=>{if("Smart"!=er.mode&&!eZ)return ez.current&&cancelAnimationFrame(ez.current),G.current&&(ez.current=requestAnimationFrame(()=>{var e;null===(e=G.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})})),()=>{ez.current&&cancelAnimationFrame(ez.current)}},[eQ,eJ]),(0,s.useEffect)(()=>{K(eQ.length/12),1==q&&"Smart"!==er.mode&&eD(!0)},[eQ]),(0,s.useEffect)(()=>{"Smart"==er.mode&&eb(!1)},[er.mode]),(0,s.useEffect)(()=>{"CONNECTED"!=er.status&&"BACKEND_DISCONNECTED"!=er.status&&(eg||(console.log("Auto starting lesson"),ev(!0),eu(()=>{er.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),"Realtime"==er.mode&&eB(),eL(!1)))},[er.status]),(0,s.useEffect)(()=>{if(!eH)return;console.log("Scrolling to latest message");let e=document.getElementById("latest-user-message");e&&e.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})},[null==eH,null==eY]);let[e0,e1]=(0,s.useState)(!1);return(0,l.jsxs)("div",{className:"flex h-full flex-col items-center tracking-[-0.02em]",children:[(0,l.jsx)(S,{isOpen:null!==ee,onClose:()=>{$(0),et(null),ei(null)},detailedTranslation:"message"===ee?{wordForWord:eJ.wordForWord[Z],translation:eJ.translations[Z]}:{wordForWord:eK.wordForWord[Z],translation:eK.translations[Z]},isTTSPlaying:ex&&"e"==em,onTTSPlay:e=>{eu(),en&&ec.sendAction({type:"SAY",text_stream:null!=e?e:en,id:"e"})},isPracticeRecording:Y,setPracticeRecording:e=>{e?U():V()},isPracticePlaying:J,setPracticePlaying:e=>{e?Q():H()},onSave:null!=es?es:void 0,isSaved:"message"===ee?er.saved[Z]:"suggestion"===ee?eK.saved[Z]:void 0}),(0,l.jsx)(C,{isOpen:e0,onClose:()=>{e1(!1)},isVoiceDetected:eP,selectedMic:eM,acquireMic:eU}),(0,l.jsx)(F,{isOpen:null!==eA,onClose:()=>{eC(null)},inputBar:(0,l.jsx)(E.y,{onStartPress:()=>{eB(),eL(!1)},onEndPress:()=>{if(null===eA){console.error("Redo message index is null");return}ea.sendAction({type:"RESET_TO_MESSAGE",index:eA}),eh("l".concat(eA-1)),eW(),eu(),e$(!1),setTimeout(()=>{eC(null)},100)},onCancel:()=>{eG()},leftToggle:(0,l.jsx)("div",{}),rightToggle:(0,l.jsx)("div",{})})}),(0,l.jsx)(k,{isOpen:eS,onClose:()=>eT(!1)}),(0,l.jsx)(P,{isOpen:e_,onClose:()=>eD(!1),onFinish:()=>{er.sendAction({type:"STOP_CALL"})},streakPlus:er.showStreakPlus,xp:er.xp,words:eQ.filter(e=>"user"===e.role).reduce((e,t)=>"string"!=typeof t.content?e:e+t.content.split(" ").length,0),minutes:Math.ceil((new Date().getTime()-new Date(er.startTime).getTime())/1e3/60)}),(0,l.jsx)(R,{isOpen:eF,onClose:()=>eR(!1),onQuit:()=>{er.sendAction({type:"STOP_CALL"}),ej.back()}}),(0,l.jsx)("div",{className:"flex w-full flex-col items-center px-7 pb-2",children:(0,l.jsxs)("div",{className:"flex w-full items-center justify-between px-1",children:[(0,l.jsx)("button",{className:"flex h-12 items-center justify-center self-start rounded-full text-black",onClick:()=>{console.log("audioCall.showStreakPlus",er.showStreakPlus),ev(!1),q>=1?eD(!0):eR(!0)},children:(0,l.jsx)(y._0w,{className:"text-xl"})}),(0,l.jsx)("div",{className:"mx-5 h-1.5 flex-grow overflow-hidden rounded-full bg-[#D9D9D9]",children:(0,l.jsx)("div",{className:"h-full rounded-full bg-[#2552F4] transition-all duration-300 ease-out",style:{width:"".concat(100*q,"%")}})}),(0,l.jsx)("button",{className:"flex h-12 items-center justify-center self-start rounded-full text-black/30",onClick:()=>{e1(!0)},children:(0,l.jsx)(y.F1m,{className:"text-xl"})})]})}),eE&&(0,l.jsx)("div",{className:"w-full flex-grow overflow-auto overscroll-contain px-5 pb-6 pt-1",children:(0,l.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-between rounded-lg border-[1px] border-black/10 bg-white px-4 py-5",children:[(0,l.jsx)("div",{className:"rounded-sm bg-[#2552F4]/10 px-2 py-1 font-medium text-[#2552F4]",children:"Whiteboard"}),(0,l.jsx)("div",{className:"px-4",children:eQ.length>0&&(0,l.jsx)("div",{children:(()=>{var e,t,n,s,i,r,o,a,c,d,u,x,f,h,p,g,v;let j=eQ.slice().reverse().find(e=>"assistant"===e.role&&null!=e.tool_calls);return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:"lg:prose-md prose whitespace-pre-wrap prose-code:whitespace-pre-wrap prose-code:text-red-500 prose-code:before:hidden prose-code:after:hidden prose-pre:m-0 prose-pre:max-w-full prose-pre:bg-transparent prose-pre:p-0",children:(null==j?void 0:null===(n=j.tool_calls)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:null===(e=t.function)||void 0===e?void 0:e.name)==="write_on_whiteboard"?(0,l.jsx)(m.AnimatedMarkdown,{content:(null==j?void 0:null===(r=j.tool_calls)||void 0===r?void 0:null===(i=r[0])||void 0===i?void 0:null===(s=i.function)||void 0===s?void 0:s.arguments)?null===(a=JSON.parse(j.tool_calls[0].function.arguments))||void 0===a?void 0:null===(o=a.text)||void 0===o?void 0:o.replaceAll("\n","  \n"):"",sep:"word",animation:"fadeIn",animationDuration:"0.5s",animationTimingFunction:"ease-in-out"}):(null==j?void 0:null===(u=j.tool_calls)||void 0===u?void 0:null===(d=u[0])||void 0===d?void 0:null===(c=d.function)||void 0===c?void 0:c.name)?(0,l.jsx)("pre",{className:"max-w-full whitespace-pre-wrap text-blue-500",children:JSON.stringify(JSON.parse((null==j?void 0:null===(h=j.tool_calls)||void 0===h?void 0:null===(f=h[0])||void 0===f?void 0:null===(x=f.function)||void 0===x?void 0:x.arguments)||"{}"),null,1)}):(0,l.jsx)("pre",{children:JSON.stringify(JSON.parse((null==j?void 0:null===(v=j.tool_calls)||void 0===v?void 0:null===(g=v[0])||void 0===g?void 0:null===(p=g.function)||void 0===p?void 0:p.arguments)||"{}"),null,2)})})})})()})}),eQ.length>0&&(0,l.jsxs)("div",{className:"flex w-full items-center justify-center gap-4 pb-1",children:["string"==typeof(null===(t=er.lessonInfo)||void 0===t?void 0:null===(e=t.tutor)||void 0===e?void 0:e.profile_picture_url)?(0,l.jsx)("img",{src:null===(r=er.lessonInfo)||void 0===r?void 0:null===(n=r.tutor)||void 0===n?void 0:n.profile_picture_url,className:"h-7 w-7 rounded-full"}):null===(c=er.lessonInfo)||void 0===c?void 0:null===(o=c.tutor)||void 0===o?void 0:o.profile_picture_url,(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"max-h-[3em] min-w-0 flex-1 overflow-y-auto text-sm text-black/50",children:(()=>{let e=eQ.findLastIndex(e=>"assistant"===e.role),t=eQ[e];if("string"!=typeof(null==t?void 0:t.content))return"\uD83D\uDD0A";let n=null==t?void 0:t.content,l=ex&&"r".concat(e.toString())===em,s=eV&&"l".concat(e.toString())===em;return l||s?ep(n):n})()}),(0,l.jsx)("div",{className:"h-0 min-w-0 flex-1 text-sm text-black/50",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden",textOverflow:"ellipsis",textAlign:"left"},children:(()=>{let e=eQ.findLastIndex(e=>"assistant"===e.role),t=eQ[e];return"string"!=typeof(null==t?void 0:t.content)?"\uD83D\uDD0A":null==t?void 0:t.content})()})]})]})]})}),(0,l.jsxs)("div",{className:"w-full flex-grow overflow-auto overscroll-contain px-7 pt-1 ".concat(eE?"hidden":""),onTouchStart:()=>e$(!0),ref:eX,children:[eQ.length>0&&"Realtime"!==er.mode&&eQ.map((e,t)=>{var n,s;eQ.reduce((e,t,n)=>"user"===t.role?n:e,-1),e.role;let i=ex&&"r".concat(t.toString())==em,r=eV&&"l".concat(t.toString())==em,o=i||r;if((null==e?void 0:e.role)==="assistant")return(0,l.jsxs)("div",{children:[e.content&&(0,l.jsx)(T.nQ,{profilePicture:null===(s=er.lessonInfo)||void 0===s?void 0:null===(n=s.tutor)||void 0===n?void 0:n.profile_picture_url,isPlaying:o,message:"Advanced"!=er.mode&&ew?"string"!=typeof e.content?"\uD83D\uDD0A":o?ep(e.content):e.content:void 0,translation:"Advanced"!=er.mode&&ew&&"string"==typeof e.content?o?ep(eJ.translations[t],e.content):eJ.translations[t]:void 0,onTap:()=>{r||"string"!=typeof e.content||(eJ.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),el(e.content),$(t),et("message"),ei(()=>e=>{er.sendAction({type:e?"DELETE_MESSAGE":"SAVE_MESSAGE",index:t})}))},onTTSPlay:()=>{eu(),ec.sendAction({type:"SAY",text_stream:null==e?void 0:e.content,id:"r".concat(t)})},onTTSStop:()=>{eu(),ec.sendAction({type:"STOP",id:"r".concat(t)})},onTranslate:e=>{e&&(eJ.translations[t]||eJ.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==er.mode||"Smart"==er.mode}),e.tool_calls&&(0,l.jsx)(T.TH,{title:e.tool_calls[0].function.name,message:e.tool_calls[0].function.arguments,onTap:()=>{}},t)]},t);if((null==e?void 0:e.role)==="user"){let n=eq.corrections[t];return(0,l.jsx)("div",{children:(0,l.jsx)(T.MI,{message:"string"==typeof e.content?e.content:"\uD83D\uDD0A",translation:eJ.translations[t],correction:n,onTap:()=>{r||"string"!=typeof e.content||(eJ.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),el(e.content),$(t),et("message"),ei(()=>()=>{er.sendAction({type:"SAVE_MESSAGE",index:t})}))},onTranslate:e=>{e&&(eJ.translations[t]||eJ.sendAction({type:"REQUEST_TRANSLATION",index:t}))},onRedo:()=>{eC(t)},defaultShowTranslation:"Beginner"==er.mode||"Smart"==er.mode})},t)}}),(0,l.jsxs)("div",{className:"min-h-[80vh]",id:"latest-user-message",children:[eH&&(0,l.jsx)("div",{children:(0,l.jsx)(T.MI,{message:"string"==typeof eH.content?eH.content:"\uD83D\uDD0A",translation:eJ.translations[eQ.length],correction:eq.corrections[eQ.length],onTap:()=>{"string"==typeof eH.content&&(eJ.sendAction({type:"REQUEST_WORD_FOR_WORD",index:eQ.length}),el(eH.content),$(eQ.length),et("message"),ei(()=>()=>{er.sendAction({type:"SAVE_MESSAGE",index:eQ.length})}))},onTranslate:e=>{e&&(eJ.translations[eQ.length]||eJ.sendAction({type:"REQUEST_TRANSLATION",index:eQ.length}))},onRedo:()=>{eC(eQ.length)},defaultShowTranslation:"Beginner"==er.mode||"Smart"==er.mode})}),eY&&eY.content&&(0,l.jsx)(T.nQ,{profilePicture:null===(b=er.lessonInfo)||void 0===b?void 0:null===(d=b.tutor)||void 0===d?void 0:d.profile_picture_url,isPlaying:!0,message:"Advanced"!=er.mode&&ew?"string"!=typeof eY.content?"\uD83D\uDD0A":ep(eY.content):void 0,translation:"Advanced"!=er.mode&&ew&&"string"==typeof eY.content?ep(eJ.translations[eQ.length+1],eY.content):void 0,onTap:()=>{"string"==typeof eY.content&&(eJ.sendAction({type:"REQUEST_WORD_FOR_WORD",index:eQ.length+1}),el(eY.content),$(eQ.length+1),et("message"),ei(()=>e=>{er.sendAction({type:e?"DELETE_MESSAGE":"SAVE_MESSAGE",index:eQ.length+1})}))},onTTSPlay:()=>{eu(),ec.sendAction({type:"SAY",text_stream:null==eY?void 0:eY.content,id:"r".concat(eQ.length+1)})},onTTSStop:()=>{eu(),ec.sendAction({type:"STOP",id:"r".concat(eQ.length+1)})},onTranslate:e=>{e&&(eJ.translations[eQ.length+1]||eJ.sendAction({type:"REQUEST_TRANSLATION",index:eQ.length+1}))},defaultShowTranslation:"Beginner"==er.mode||"Smart"==er.mode}),eY&&eY.tool_calls&&(0,l.jsx)(T.TH,{title:eY.tool_calls[0].function.name,message:eY.tool_calls[0].function.arguments,onTap:()=>{}})]}),"Realtime"==er.mode&&(0,l.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,l.jsxs)("div",{className:"mb-16 flex w-full flex-col items-center gap-2 rounded-xl border-[1px] border-black/10 bg-white py-6",children:[(0,l.jsx)("img",{src:null===(_=er.lessonInfo)||void 0===_?void 0:null===(w=_.tutor)||void 0===w?void 0:w.profile_picture_url,alt:"",className:"h-20 w-20"}),(0,l.jsx)("div",{className:"text-lg font-medium",children:null===(O=er.lessonInfo)||void 0===O?void 0:null===(D=O.lesson)||void 0===D?void 0:D.title}),(0,l.jsx)("div",{className:"text-3xl",children:null===(L=er.lessonInfo)||void 0===L?void 0:null===(I=L.lesson)||void 0===I?void 0:I.emoji}),(0,l.jsx)("div",{className:"rounded-md bg-[#0039FF]/10 p-2 text-[#0039FF]",children:"Real time call"})]}),(0,l.jsx)("div",{className:"mx-8 text-center text-sm text-black/30",children:"Caution: This mode is experimental and may not work as expected."})]}),(0,l.jsx)("div",{ref:G})]}),(0,l.jsx)("div",{className:"pointer-events-none w-full justify-end gap-5 tracking-[-0.02em]",children:(0,l.jsxs)("div",{className:"pointer-events-auto flex h-36 w-full flex-col items-center justify-center gap-4 pb-10 pt-4 ".concat("Realtime"==er.mode?"":"rounded-t-[2rem] border-[1px] border-black/10 bg-white"),children:[(0,l.jsx)(u.M,{mode:"wait",children:!z||"Smart"===er.mode||eO||eE?eQ.length>0&&"Realtime"!==er.mode&&"Smart"!==er.mode&&"Advanced"!==er.mode?(0,l.jsxs)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,l.jsx)("div",{className:"mb-1 flex justify-center text-base font-light text-black/30",onClick:()=>{eb(!ey)},children:(0,l.jsx)(x.E.div,{animate:{rotateX:ey?0:180},transition:{duration:.6,ease:"easeInOut"},children:(0,l.jsx)(y.RiI,{className:"scale-y-75 transform"})})}),(0,l.jsx)(u.M,{children:ey&&(0,l.jsx)(x.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut",opacity:{duration:.05,ease:"easeInOut"},height:{duration:.3,ease:"easeInOut"}},className:"overflow-hidden",children:(0,l.jsx)("div",{className:"h-32",children:(0,l.jsx)(f.tq,{pagination:!0,modules:[h.tl],className:"w-screen bg-white",children:(null===(M=eK.suggestions)||void 0===M?void 0:M.length)>=3?eK.suggestions.map((e,t)=>(0,l.jsx)(f.o5,{className:"mb-4 !h-auto px-6 py-2",children:(0,l.jsxs)("button",{onClick:()=>{el(e),$(t),et("suggestion"),ei(()=>e=>{console.log("saving suggestion"),eK.sendAction({type:e?"DELETE_SUGGESTION":"SAVE_SUGGESTION",index:t})})},className:"flex h-full w-full flex-col items-center rounded-lg bg-white p-4 shadow-custom-shadow",children:["Intermediate"===er.mode||"Advanced"===er.mode?(0,l.jsx)("div",{className:"flex flex-wrap gap-1 gap-y-5",children:eK.wordForWord[t]&&eK.wordForWord[t].length>0&&eK.wordForWord[t].map((e,t)=>(0,l.jsx)("div",{className:"flex flex-col items-center",children:(0,l.jsx)("div",{className:"mb-1 text-nowrap rounded-sm bg-black/5 px-1 font-normal text-black/0",children:e.original})},t))}):(0,l.jsx)("div",{className:"w-full overflow-hidden overflow-ellipsis whitespace-nowrap",children:(0,j.f)(e)}),(0,l.jsx)("div",{className:"w-full overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-black/30",children:(0,j.f)(eK.translations[t])})]})},t)):(0,l.jsx)(l.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,l.jsx)(f.o5,{className:"mb-4 !h-auto px-6 py-2",children:(0,l.jsx)("div",{className:"h-full w-full rounded-lg bg-white p-4 shadow-custom-shadow",children:(0,l.jsxs)("div",{className:"flex w-full flex-col items-center space-y-2",children:[(0,l.jsx)("div",{className:"animate-shimmer h-5 w-2/3 rounded bg-gray-200"}),(0,l.jsx)("div",{className:"animate-shimmer h-5 w-2/3 rounded bg-gray-200"})]})})},t))})})})})})]},"messages"):null:(0,l.jsxs)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex h-[10.75rem] flex-col items-center justify-center gap-5",children:[(0,l.jsx)(x.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,l.jsx)(x.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,l.jsx)(y.QJe,{className:"text-[#0039FF]"})},e))}),(0,l.jsx)(x.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},children:"Amazing \uD83E\uDD73"})]},"encouragement")}),"CONNECTED"!==er.status?(0,l.jsx)("button",{className:"mx-8 flex h-[3.6rem] flex-grow items-center justify-center rounded-full bg-[#0039FF] px-4 font-bold text-white",onClick:()=>{eg||(ev(!0),eu(()=>{er.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),"Realtime"==er.mode&&eB(),eL(!1))},children:(0,l.jsx)(y.fCD,{className:"animate-spin"})}):"Realtime"==er.mode?(0,l.jsxs)("div",{className:"mx-8 flex w-full items-center justify-between",children:[(0,l.jsxs)("button",{className:"relative flex h-14 w-14 items-center justify-center rounded-full bg-black/5 ".concat(eP?"ring-4":""," ").concat(eI?"ring-red-500/70":"ring-green-500/70"),onClick:()=>{eu(),eO||eB(),eL(!eI)},children:[(0,l.jsx)(N.J,{icon:eI?y.uYL:y.RgM,className:"text-xl text-black"}),eP&&eI&&(0,l.jsx)("p",{className:"absolute -right-[120px] -top-8 rounded-full rounded-bl-none bg-black/5 p-2 text-sm",children:"Press to unmute"})]}),(0,l.jsx)("button",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-black/5",onClick:()=>{ev(!1),er.sendAction({type:"STOP_CALL"}),console.log("audioCall.showStreakPlus",er.showStreakPlus),ej.push("/feedback?session_id=".concat(W))},children:(0,l.jsx)(y._0w,{className:"text-xl text-black"})})]}):"Smart"==er.mode?(0,l.jsx)(E.y,{onStartPress:()=>{eB(),eL(!1)},onEndPress:()=>{eW(),eu(),e$(!1)},onCancel:()=>{eG()},leftToggle:(0,l.jsx)("div",{children:void 0!==ew&&eN&&(0,l.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-full ".concat(ew?"bg-black/5":"bg-[#2552F4]/10 text-[#2552F4]"),onClick:()=>{eN(!ew)},children:(0,l.jsx)(y.Vbz,{})})}),rightToggle:(0,l.jsx)("div",{children:(0,l.jsx)("button",{className:"flex h-14 w-14 items-center justify-center rounded-full text-xl ".concat(eE?"bg-[#2552F4]/10 text-[#2552F4]":"bg-black/5"),onClick:()=>{if(ek(!eE),eE||eb(!1),eE){var e;console.log("instant scroll"),null===(e=G.current)||void 0===e||e.scrollIntoView({behavior:"instant",block:"end",inline:"nearest"})}},children:(0,l.jsx)(y.$e0,{})})})}):(0,l.jsx)(E.y,{onStartPress:()=>{eB(),eL(!1)},onEndPress:()=>{eW(),eu(),e$(!1)},onCancel:()=>{eG()},leftToggle:(0,l.jsx)("div",{children:void 0!==ew&&eN&&(0,l.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-full ".concat(ew?"bg-black/5":"bg-[#0039FF]/10 text-[#0039FF]"),onClick:()=>{eN(!ew)},children:(0,l.jsx)(y.Vbz,{})})}),rightToggle:(0,l.jsx)("div",{children:void 0!==eS&&eT&&(0,l.jsx)("button",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-black/5",onClick:()=>{eT(!eS)},children:(0,l.jsx)(A,{})})})})]})})]})}function I(){return(0,l.jsx)(d,{children:(0,l.jsx)("main",{className:"h-screen-safe bg-[#FAFBFF] pt-1",children:(0,l.jsx)(O,{})})})}},56870:function(e,t,n){"use strict";n.d(t,{GlobalAudioContextProvider:function(){return r},Y:function(){return o}});var l=n(57437),s=n(2265);let i=(0,s.createContext)(null),r=e=>{let{children:t}=e,n=(0,s.useRef)(null);return n.current||(console.log("creating audio context"),n.current=new AudioContext,n.current.onstatechange=()=>{var e,t,l,s,i;if(console.log("onstagechange - AudioContext state changed: ",null===(e=n.current)||void 0===e?void 0:e.state),(null===(t=n.current)||void 0===t?void 0:t.state)==="suspended"&&(null===(s=n.current)||void 0===s||s.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=n.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(l=n.current)||void 0===l?void 0:l.state)==="running"){let e=null===(i=n.current)||void 0===i?void 0:i.currentTime;setTimeout(()=>{var t;(null===(t=n.current)||void 0===t?void 0:t.currentTime)===e&&(console.warn("AudioContext currentTime is stuck, attempting to fix..."),window.location.reload())},100)}}),(0,l.jsx)(i.Provider,{value:n.current,children:t})},o=()=>{let e=(0,s.useContext)(i);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}}},function(e){e.O(0,[4722,7240,1015,6051,6491,1649,755,9787,1876,3069,813,3344,9939,2971,2117,1744],function(){return e(e.s=93658)}),_N_E=e.O()}]);