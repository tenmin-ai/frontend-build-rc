(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{3658:function(e,t,n){Promise.resolve().then(n.bind(n,5021))},5021:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return P}});var r=n(7437),l=n(2265),s=n(4272),a=n(3974),c=n(3772),i=n(9376);let o=()=>{let[e,t]=(0,a.useLocalStorage)("token");return{token:e,saveToken:t}};function u(e){let{children:t}=e,n=(0,a.useIsClient)(),{token:l,saveToken:u}=o(),d=(0,i.useSearchParams)().get("session_id");return d?n?(0,r.jsx)(s.eA,{url:"wss://backend-us-rc.tenmin.ai/ws"+"/".concat(d)+"?token=".concat(l),label:"Debug Call",toast:c.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:t}):(0,r.jsx)("div",{children:"Loading.."}):(0,r.jsx)("div",{children:"Invalid lesson"})}var d=n(5095),m=n(755),x=n(9764);n(7354),n(6889);var f=n(3377),h=n(3510),g=n(6870),p=n(5123),v=e=>{let{onStartPress:t,onEndPress:n,onCancel:s,cancelButtonRef:a,children:c}=e,[i,o]=(0,l.useState)(!1),u=(0,l.useRef)({x:0,y:0}),d=e=>{if(a.current){let t=a.current.getBoundingClientRect();return e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom}return!1};return(0,l.useEffect)(()=>{let e=e=>{var t,n;if(!i)return;let r=e.touches[0];d({x:r.clientX,y:r.clientY})?null===(t=a.current)||void 0===t||t.classList.add("scale-110","bg-red-300"):null===(n=a.current)||void 0===n||n.classList.remove("scale-110","bg-red-300")};return window.addEventListener("touchmove",e),()=>{window.removeEventListener("touchmove",e)}},[i,a]),(0,r.jsx)("button",{onTouchStart:e=>{e.preventDefault(),o(!0),t();let n=e.touches[0];u.current={x:n.clientX,y:n.clientY}},onTouchEnd:e=>{e.preventDefault(),o(!1);let t=e.changedTouches[0];d({x:t.clientX,y:t.clientY})?s():n()},onContextMenu:e=>e.preventDefault(),className:"microphoneButton",children:c?c(i):"Press and Hold"})};let w=e=>e||"â€‹";var j=n(1273),N=n(3069),y=n(2744);let b=e=>{let{icon:t,className:n,...l}=e;return(0,r.jsx)(t,{className:n,...l})},k=e=>{var t,n;let{isOpen:s,onClose:a,detailedTranslation:c,isTTSPlaying:i,onTTSPlay:o,isPracticeRecording:u,setPracticeRecording:d,isPracticePlaying:m,setPracticePlaying:x}=e,f=null!==(t=null==c?void 0:c.wordForWord)&&void 0!==t?t:[],h=null!==(n=null==c?void 0:c.translation)&&void 0!==n?n:"",[g,p]=(0,l.useState)(null);return(0,r.jsxs)(N.y,{isOpen:s,onClose:a,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,r.jsx)(N.y.Container,{children:(0,r.jsx)(N.y.Content,{style:{backgroundImage:"white"},children:(0,r.jsxs)("div",{className:"p-8 pb-16 text-black w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("p",{className:"font-semibold text-lg ",children:"Explanation"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(j.VF9,{onClick:()=>{}}),(0,r.jsx)(j.JqX,{onClick:a})]})]}),(0,r.jsx)("div",{className:"flex gap-1 mt-4 flex-wrap gap-y-2",children:f.length>0&&f.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(g===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let n=e.original.trim();RegExp("^\\p{P}+$","u").test(n)||(o(n),p(t))},children:[(0,r.jsx)("div",{className:"font-normal text-xl px-1 text-nowrap",children:e.original}),(0,r.jsx)("div",{className:"opacity-50 px-1 text-nowrap text-sm",children:e.translation})]},t))}),(0,r.jsxs)("div",{className:"mt-6 flex items-center gap-2 text-black/30",children:[(0,r.jsx)(y.mp2,{className:"text-black/30 text-xl"}),(0,r.jsx)("div",{children:h})]}),(0,r.jsxs)("div",{className:"flex mt-10 justify-center gap-6 mx-10",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>{o(),p(null)},className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(b,{className:"text-[#0039FF] text-lg",icon:i?j.JuG:j.gmG})}),(0,r.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>d(!u),className:"shadow-custom-blue-shadow bg-[#0039FF] rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(b,{className:"text-white text-xl",icon:u?j.u9M:j.uYL})}),(0,r.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>x(!m),className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(j.tdo,{className:"text-[#0039FF] text-xl"})}),(0,r.jsx)("div",{className:"text-sm text-nowrap",children:"Your sound"})]})]})]})})}),(0,r.jsx)(N.y.Backdrop,{onTap:a})]})},T=e=>{let{profilePicture:t,message:n,translation:s,isPlaying:a,onTap:c,onTTSPlay:i,onTTSStop:o,onTranslate:u,defaultShowTranslation:d=!0}=e,[m,x]=(0,l.useState)(d);return(0,r.jsxs)("div",{className:"bg-white rounded-tl-none rounded-lg py-4 px-4 mb-8 ring-1 ring-black/10 mr-14",onClick:c,children:[(0,r.jsx)("img",{src:t,className:"w-7 h-7 mb-3 rounded-full"}),(0,r.jsx)("div",{className:"font-medium",children:void 0===n?(0,r.jsxs)("div",{className:"flex flex-col gap-2 mb-4",children:[(0,r.jsx)("div",{className:"h-2 bg-gray-200 rounded-full w-full"}),(0,r.jsx)("div",{className:"h-2 bg-gray-200 rounded-full w-2/3"})]}):w(n)}),m&&(0,r.jsx)("div",{className:"text-black/30 text-sm",children:s}),(0,r.jsxs)("div",{className:"mt-2 flex gap-2",children:[a?(0,r.jsx)(y.H6t,{className:"text-black/30 text-xl",onClick:e=>{e.stopPropagation(),o()}}):(0,r.jsx)(y.hwG,{className:"text-black/30 text-xl",onClick:e=>{e.stopPropagation(),i()}}),u&&(0,r.jsx)(y.mp2,{className:"text-black/30 text-xl",onClick:e=>{e.stopPropagation(),u(!m),x(!m)}})]})]})},C=e=>{let t,n,s,{message:a,translation:c,correction:i,onTap:o,onTranslate:u,defaultShowTranslation:d=!0}=e,[m,x]=(0,l.useState)(d),f="flex-initial bg-[#0039FF]/5 ring-1 rounded-lg py-4 px-4 ring-[#0039FF]/20 rounded-tr-none";i?"Grammar"===i.mistake||"Phrasing"===i.mistake?(t=(0,r.jsx)("div",{className:"font-normal text-red-600 line-through",children:a}),n=(0,r.jsx)("div",{className:"text-green-600",children:i.correct_version})):"No Mistake"===i.mistake?(f="relative flex-initial bg-green-500/5 ring-1 rounded-lg py-4 px-4 ring-green-600/20 rounded-tr-none",t=(0,r.jsx)("div",{className:"font-normal text-green-600",children:a}),s=(0,r.jsx)(j.ETl,{className:"absolute -right-2 -bottom-2 text-green-600 text-xl"})):t=(0,r.jsx)("div",{className:"font-normal",children:a}):t=(0,r.jsx)("div",{className:"font-normal",children:a});let h=c&&m&&(0,r.jsx)("div",{className:"text-black/30 text-sm",children:c});return(0,r.jsxs)("div",{className:"flex flex-wrap-reverse justify-end items-center mb-8 ml-14 gap-y-3",children:[i&&i.explanation&&(0,r.jsxs)("div",{className:"basis-32 grow text-xs -ml-10 mr-3",children:[(0,r.jsxs)("p",{className:"font-bold",children:[i.mistake,(0,r.jsx)(j.EQK,{className:"mx-1 inline-block"})]}),(0,r.jsx)("p",{className:"italic",children:i.explanation})]}),(0,r.jsxs)("div",{className:f,onClick:o,children:[t,n,h,(0,r.jsx)("div",{className:"mt-2 flex gap-2",children:u&&(0,r.jsx)(y.mp2,{className:"text-black/30 !text-xl",onClick:e=>{e.stopPropagation(),u(!m),x(!m)}})}),s]})]})};var S=n(1268),E=n(5217),A=e=>{let{color:t="black"}=e;return(0,r.jsx)("svg",{width:"10",height:"16",viewBox:"0 0 10 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M0.0946622 2.84349C0.543847 1.57554 1.74925 0.722656 3.09681 0.722656H6.41168C8.39605 0.722656 9.99947 2.33176 9.99947 4.31045C9.99947 5.59546 9.31148 6.78381 8.19705 7.42631L6.36051 8.4782C6.34913 9.21737 5.74074 9.82007 4.99589 9.82007C4.23967 9.82007 3.63128 9.21168 3.63128 8.45546V7.68786C3.63128 7.19888 3.89283 6.74969 4.31927 6.5052L6.83812 5.06099C7.10536 4.90747 7.27025 4.62317 7.27025 4.31613C7.27025 3.83852 6.88361 3.45757 6.41168 3.45757H3.09681C2.90349 3.45757 2.73291 3.57697 2.67037 3.75892L2.64762 3.82715C2.39745 4.53788 1.61279 4.90747 0.907744 4.65729C0.202694 4.40711 -0.172574 3.62246 0.0776046 2.91741L0.100348 2.84918L0.0946622 2.84349ZM3.17641 13.459C3.17641 12.9765 3.36811 12.5137 3.70933 12.1725C4.05054 11.8312 4.51334 11.6396 4.99589 11.6396C5.47845 11.6396 5.94124 11.8312 6.28246 12.1725C6.62368 12.5137 6.81538 12.9765 6.81538 13.459C6.81538 13.9416 6.62368 14.4044 6.28246 14.7456C5.94124 15.0868 5.47845 15.2785 4.99589 15.2785C4.51334 15.2785 4.05054 15.0868 3.70933 14.7456C3.36811 14.4044 3.17641 13.9416 3.17641 13.459Z",fill:t})})};function R(){var e,t,n,a,c,o,u,N;let{startRecording:y,stopRecording:R,playRecording:P,stopPlayback:F,isPracticeRecording:_,isPlayingAudio:D}=function(){let[e,t]=(0,l.useState)(!1),[n,r]=(0,l.useState)(!1),s=(0,l.useRef)(null),a=(0,l.useRef)(null),c=(0,l.useRef)(null),[i,o]=(0,l.useState)(null),u=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});s.current=e,a.current=new MediaRecorder(e);let n=[];a.current.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},a.current.onstop=()=>{let e=new Blob(n,{type:"audio/mpeg"});o(e),t(!1)},a.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{a.current&&"recording"===a.current.state&&a.current.stop(),s.current&&s.current.getTracks().forEach(e=>e.stop())},m=()=>{c.current&&(c.current.pause(),c.current.currentTime=0,r(!1))};return(0,l.useEffect)(()=>()=>{d(),m()},[]),{startRecording:u,stopRecording:d,playRecording:()=>{i?(c.current||(c.current=new Audio),c.current.src=URL.createObjectURL(i),c.current.play(),r(!0),c.current.onended=()=>{r(!1)}):console.warn("No recording available to play")},stopPlayback:m,isPracticeRecording:e,isPlayingAudio:n}}(),[M,L]=(0,l.useState)(0),[O,I]=(0,l.useState)(!1),[B,U]=(0,l.useState)(null),[W,V]=(0,l.useState)(""),G=(0,s.MV)("AUDIO_CALL",{status:"BACKEND_DISCONNECTED",mode:"Beginner",showStreakPlus:!1,speedPreference:"NORMAL",lessonInfo:{}}),Y=(0,s.MV)("STT",{totalTranscript:"",currTranscript:"",tempTranscript:""}),H=(0,s.MV)("CHAT",{messages:[],userPreview:null,assistantPreview:null}),K=(0,s.MV)("TTS",{volumeMultiplier:1}),q=(0,s.MV)("TRANSLATION",{wordForWord:{},translations:{}}),[z]=(0,s.tp)("CORRECTION",(e,t)=>{"PERFECT"===t.type&&("Advanced"!==G.mode&&I(!0),setTimeout(()=>{let e=new Audio("encouragement.mp3");e.volume=.5,e.play()},500),setTimeout(()=>{I(!1)},1200))},{corrections:{}}),Q=(0,s.MV)("AUTOCOMPLETE",{suggestions:[],translations:[],wordForWord:[]}),[X]=(0,l.useState)(1);(0,l.useEffect)(()=>((async()=>{await p.P.keepAwake()})(),()=>{(async()=>{await p.P.allowSleep()})()}),[]);let{startSpeaker:Z,isPlaying:J,latestAudioId:$,latestCharIndex:ee}=function(e){let{onPlaybackChange:t,volume:n=1,speed:r=1}=e,a=(0,l.useContext)(s.Dm),c=(0,g.Y)(),i=(0,l.useRef)([]),o=(0,l.useRef)(0),u=(0,l.useRef)(null),d=(0,l.useRef)([]),m=(0,l.useRef)(null),x=(0,l.useRef)(null),f=(0,l.useRef)(!1),[h,p]=(0,l.useState)(!1),[v,w]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null),[y,b]=(0,l.useState)(null),k=(0,l.useRef)(null),T=()=>{C(),null!==x.current&&(x.current.disconnect(),x.current=null,console.log("Phase vocoder node disconnected and released")),null!==m.current&&(m.current.disconnect(),m.current=null,console.log("Gain node disconnected and released"))},C=()=>{if(d.current.forEach(e=>{clearTimeout(e)}),d.current=[],u.current&&(clearTimeout(u.current),u.current=null),0===i.current.length)return;let e=1,t=i.current.slice(0,1);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(1*t.length)}i.current.slice(1).forEach(e=>{e.stop()}),i.current=t},S=()=>{p(!1),w(!1),d.current=[],k.current=null},E=async e=>{let{i:t,data:n,id:l,t:s}=e,a=new Int16Array(n),x=c.createBuffer(1,a.length,24e3),f=x.getChannelData(0);for(let e=0;e<a.length;e++)f[e]=a[e]/32768;if(null===m.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let h=c.createBufferSource();h.connect(m.current),h.playbackRate.value=r,h.buffer=x;let g=0==t;g&&(i.current.length>0&&C(),o.current=c.currentTime);let v=o.current+.1*t/r+.1,j=c.currentTime-v;if(j>0&&(console.log("Audio chunk is late, delaying playback by ".concat(j," seconds.")),v+=j,o.current+=j),h.start(v),i.current.push(h),g&&(u.current=setTimeout(()=>{p(!0),b(0),void 0==l&&console.error("First chunk must have an id"),N(l),u.current=null},-(1e3*j))),h.onended=()=>{i.current.length>0&&(i.current.shift(),w(!1)),k.current&&t==k.current-1?S():0===i.current.length&&w(!0)},void 0!=s){let e=d.current.length,t=c.currentTime,n=s.map((n,l)=>setTimeout(()=>b(e+l),1e3*(o.current+n-t)/r));d.current.push(...n)}};return(0,l.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",E),a.registerEvent("TTS_INTERRUPT",()=>{C()}),a.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;j!==t||h?k.current=n:S()}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,r]),(0,l.useEffect)(()=>{null==t||t(h,j)},[h]),(0,l.useEffect)(()=>{m.current&&(m.current.gain.value=n)},[n]),(0,l.useEffect)(()=>{x.current&&(x.current.parameters.get("pitchFactor").value=1/r)},[r]),(0,l.useEffect)(()=>()=>{T()},[]),{isPlaying:h,isLagging:v,latestAudioId:j,latestCharIndex:y,startSpeaker:(e,t)=>{if(null===m.current){if(f.current){console.log("Speaker is already initializing");return}f.current=!0;try{c.resume(),m.current=c.createGain(),console.log("Gain node created"),c.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{x.current=new AudioWorkletNode(c,"phase-vocoder-processor"),m.current.connect(x.current),x.current.connect(c.destination),m.current.gain.value=n,x.current.parameters.get("pitchFactor").value=1/r,console.log("Phase vocoder worklet added")}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{f.current=!1}null===m.current?null==t||t():null==e||e()}},stopSpeaker:T}}({onPlaybackChange:(e,t)=>{K.sendAction({type:e?"PLAYBACK_STARTED":"PLAYBACK_FINISHED",id:t})},volume:K.volumeMultiplier,speed:X}),et=(e,t)=>void 0==e||null==ee?"":t?t.length>0?e.slice(0,ee*e.length/t.length):e:e.slice(0,ee),[en,er]=(0,l.useState)(!1),el=(0,i.useRouter)(),[es,ea]=(0,l.useState)(!0),[ec,ei]=(0,l.useState)(!0),[eo,eu]=(0,l.useState)(!0),{isRecording:ed,setRecording:em,cancelRecording:ex,isVoiceDetected:ef,acquireMic:eh,releaseMic:eg}=(0,h.Z)({onAudioData:async e=>{0!=e.size&&Y.sendBinary({type:"STREAM_MIC"},await e.arrayBuffer())},onRecordingStart:()=>{"Realtime"!=G.mode&&Y.sendAction({type:"PTT_PRESSED"})},onRecordingStop:e=>{"Realtime"!=G.mode&&(e?Y.sendAction({type:"PTT_CANCELLED"}):Y.sendAction({type:"PTT_RELEASED"}))},onSpeechStart:()=>{Y.sendAction({type:"VAD_CHANGED",detected:!0})},onSpeechEnd:()=>{Y.sendAction({type:"VAD_CHANGED",detected:!1})},micVolume:"Realtime"==G.mode&&eo?0:1,recordingChunkSize:100}),ep=parseInt(null!==(N=null==$?void 0:$.slice(1))&&void 0!==N?N:"")>=H.messages.length,ev=(0,l.useMemo)(()=>H.messages.concat(H.userPreview?[{role:"user",content:H.userPreview}]:[]).concat(H.assistantPreview&&ep?[{role:"assistant",content:H.assistantPreview}]:[]),[H.messages,H.userPreview,H.assistantPreview,ep]);(0,l.useEffect)(()=>{let e=document.getElementById("CHAT_BOTTOM");e&&e.scrollIntoView({behavior:"smooth"})},[ev,q]),(0,l.useEffect)(()=>{L(ev.length/12)},[ev]),(0,l.useEffect)(()=>{"CONNECTED"!=G.status&&"BACKEND_DISCONNECTED"!=G.status&&(en||(console.log("Auto starting lesson"),er(!0),Z(()=>{G.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),eh(),"Realtime"==G.mode&&em(!0),eu(!1)))},[G.status]);let ew=(0,l.useRef)(null);return(0,r.jsxs)("div",{className:"flex flex-col h-full items-center tracking-[-0.02em] ",children:[(0,r.jsx)(k,{isOpen:null!==B,onClose:()=>U(null),detailedTranslation:"number"==typeof B?{wordForWord:q.wordForWord[B],translation:q.translations[B]}:B,isTTSPlaying:J&&"e"==$,onTTSPlay:e=>{Z(),W&&K.sendAction({type:"SAY",text_stream:null!=e?e:W,id:"e"})},isPracticeRecording:_,setPracticeRecording:e=>{e?y():R()},isPracticePlaying:D,setPracticePlaying:e=>{e?P():F()}}),(0,r.jsx)("div",{className:"flex flex-col items-center w-full pb-2 px-7",children:(0,r.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,r.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{er(!1),console.log("audioCall.showStreakPlus",G.showStreakPlus),G.sendAction({type:"STOP_CALL"}),G.showStreakPlus?el.push("/streakPlus"):el.push("/")},children:(0,r.jsx)(j._0w,{className:"text-xl"})}),(0,r.jsx)("div",{className:" mx-5 h-1.5 flex-grow bg-[#D9D9D9] rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[#0039FF] rounded-full transition-all duration-300 ease-out",style:{width:"".concat(100*M,"%")}})}),(0,r.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{},children:(0,r.jsx)(j.kvo,{className:"text-xl"})})]})}),(0,r.jsxs)("div",{className:"flex-grow w-full overflow-auto px-7 pt-1",children:[ev.length>0&&"Realtime"!==G.mode&&ev.map((e,t)=>{var n,l;let s=J&&"r".concat(t.toString())==$,a=ep&&"l".concat(t.toString())==$,c=s||a;if((null==e?void 0:e.role)==="assistant")return(0,r.jsx)(T,{profilePicture:null===(l=G.lessonInfo)||void 0===l?void 0:null===(n=l.tutor)||void 0===n?void 0:n.profile_picture_url,isPlaying:c,message:"Advanced"!=G.mode&&ec?c?et(e.content):e.content:void 0,translation:"Advanced"!=G.mode&&ec?c?et(q.translations[t],e.content):q.translations[t]:void 0,onTap:()=>{a||(q.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),V(e.content),U(t))},onTTSPlay:()=>{Z(),K.sendAction({type:"SAY",text_stream:null==e?void 0:e.content,id:"r".concat(t)})},onTTSStop:()=>{Z(),K.sendAction({type:"STOP",id:"r".concat(t)})},onTranslate:e=>{e&&(q.translations[t]||q.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==G.mode},t);if((null==e?void 0:e.role)==="user"){let n=z.corrections[t];return(0,r.jsx)(C,{message:e.content,translation:q.translations[t],correction:n,onTap:()=>{a||(q.sendAction({type:"REQUEST_WORD_FOR_WORD",index:t}),V(e.content),U(t))},onTranslate:e=>{e&&(q.translations[t]||q.sendAction({type:"REQUEST_TRANSLATION",index:t}))},defaultShowTranslation:"Beginner"==G.mode},t)}}),"Realtime"==G.mode&&(0,r.jsxs)("div",{className:"h-full flex flex-col justify-center items-center",children:[(0,r.jsxs)("div",{className:"bg-white flex flex-col items-center rounded-xl border-black/10 border-[1px] py-6 gap-2 mb-16 w-full",children:[(0,r.jsx)("img",{src:null===(t=G.lessonInfo)||void 0===t?void 0:null===(e=t.tutor)||void 0===e?void 0:e.profile_picture_url,alt:"",className:"w-20 h-20"}),(0,r.jsx)("div",{className:"font-medium text-lg",children:null===(a=G.lessonInfo)||void 0===a?void 0:null===(n=a.lesson)||void 0===n?void 0:n.title}),(0,r.jsx)("div",{className:"text-3xl",children:null===(o=G.lessonInfo)||void 0===o?void 0:null===(c=o.lesson)||void 0===c?void 0:c.emoji}),(0,r.jsx)("div",{className:"bg-[#0039FF]/10 text-[#0039FF] p-2 rounded-md",children:"Real time call"})]}),(0,r.jsx)("div",{className:"text-black/30 text-center text-sm mx-8",children:"Caution: This mode is experimental and may not work as expected."})]}),(0,r.jsx)("div",{id:"CHAT_BOTTOM"})]}),(0,r.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,r.jsxs)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto  pb-10 pt-4   ".concat("Realtime"==G.mode?"":"border-black/10 border-t-[1px] bg-white"),children:[(0,r.jsx)(d.M,{mode:"wait",children:O&&!ed?(0,r.jsxs)(m.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"flex flex-col items-center gap-5 h-[10.75rem] justify-center",children:[(0,r.jsx)(m.E.div,{initial:{y:-20},animate:{y:0},transition:{delay:.1,type:"spring",stiffness:300},className:"flex gap-2",children:[0,1,2].map(e=>(0,r.jsx)(m.E.div,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{delay:.1*e,duration:.3},children:(0,r.jsx)(j.QJe,{className:"text-[#0039FF]"})},e))}),(0,r.jsx)(m.E.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},children:"Amazing \uD83E\uDD73"})]},"encouragement"):ev.length>0&&"Realtime"!==G.mode&&"Advanced"!==G.mode?(0,r.jsxs)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,r.jsx)("div",{className:"flex justify-center text-black/30 font-light text-base mb-1",onClick:()=>{ea(!es)},children:(0,r.jsx)(m.E.div,{animate:{rotateX:es?0:180},transition:{duration:.6,ease:"easeInOut"},children:(0,r.jsx)(j.RiI,{className:"transform scale-y-75"})})}),(0,r.jsx)(d.M,{children:es&&(0,r.jsx)(m.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut",opacity:{duration:.05,ease:"easeInOut"},height:{duration:.3,ease:"easeInOut"}},className:"overflow-hidden",children:(0,r.jsx)("div",{className:"h-32",children:(0,r.jsx)(x.tq,{pagination:!0,modules:[f.tl],className:"bg-white w-screen",children:(null===(u=Q.suggestions)||void 0===u?void 0:u.length)>=3?Q.suggestions.map((e,t)=>(0,r.jsx)(x.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,r.jsxs)("button",{onClick:()=>{V(e),U({wordForWord:Q.wordForWord[t],translation:Q.translations[t]})},className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg flex flex-col items-center",children:["Intermediate"===G.mode||"Advanced"===G.mode?(0,r.jsx)("div",{className:"flex gap-1 flex-wrap gap-y-5",children:Q.wordForWord[t]&&Q.wordForWord[t].length>0&&Q.wordForWord[t].map((e,t)=>(0,r.jsx)("div",{className:"flex flex-col items-center",children:(0,r.jsx)("div",{className:"font-normal px-1 bg-black/5 rounded-sm mb-1 text-nowrap text-black/0",children:e.original})},t))}):(0,r.jsx)("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:w(e)}),(0,r.jsx)("div",{className:"text-black/30 overflow-hidden overflow-ellipsis whitespace-nowrap",children:w(Q.translations[t])})]})},t)):(0,r.jsx)(r.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,r.jsx)(x.o5,{className:"!h-auto px-6 py-2 mb-4",children:(0,r.jsx)("div",{className:"shadow-custom-shadow w-full h-full bg-white p-4 rounded-lg",children:(0,r.jsxs)("div",{className:"space-y-2 w-full flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"}),(0,r.jsx)("div",{className:"w-2/3 h-5 bg-gray-200 rounded animate-shimmer"})]})})},t))})})})})})]},"messages"):null}),"CONNECTED"!==G.status?(0,r.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{en||(er(!0),Z(()=>{G.sendAction({type:"START_CALL"})},()=>{alert("Failed to start speaker")}),eh(),"Realtime"==G.mode&&em(!0),eu(!1))},children:(0,r.jsx)(j.fCD,{className:"animate-spin"})}):(0,r.jsx)("div",{className:"flex w-full justify-center items-center gap-6",children:"Realtime"==G.mode?(0,r.jsxs)("div",{className:"flex items-center justify-between w-full mx-8",children:[(0,r.jsxs)("button",{className:"relative bg-black/5 h-14 w-14 rounded-full flex items-center justify-center ".concat(ef?"ring-4":""," ").concat(eo?"ring-red-500/70":"ring-green-500/70"),onClick:()=>{Z(),ed||em(!0),eu(!eo)},children:[(0,r.jsx)(b,{icon:eo?j.uYL:j.RgM,className:"text-black text-xl"}),ef&&eo&&(0,r.jsx)("p",{className:"absolute -right-[120px] -top-8 bg-black/5 rounded-full rounded-bl-none p-2 text-sm",children:"Press to unmute"})]}),(0,r.jsx)("button",{className:"bg-black/5 h-14 w-14 rounded-full flex items-center justify-center",onClick:()=>{er(!1),G.sendAction({type:"STOP_CALL"}),console.log("audioCall.showStreakPlus",G.showStreakPlus),G.showStreakPlus?el.push("/streakPlus"):el.push("/")},children:(0,r.jsx)(j._0w,{className:"text-black text-xl "})})]}):(0,r.jsxs)(r.Fragment,{children:[ed&&(0,r.jsx)("button",{ref:ew,className:"h-12 w-12 flex justify-center items-center text-xl rounded-full bg-red-200 text-red-600 ring-2 ring-red-600/50 transition-transform duration-200 ease-in-out hover:scale-110",children:(0,r.jsx)(j._0w,{})}),!ed&&(0,r.jsx)("div",{className:" rounded-full h-14 w-14 flex justify-center items-center ".concat(ec?"bg-black/5":"text-[#0039FF] bg-[#0039FF]/10"),onClick:()=>{ei(!ec)},children:(0,r.jsx)(j.Vbz,{})}),(0,r.jsx)(v,{onStartPress:()=>{em(!0),eu(!1)},onEndPress:()=>{em(!1),Z()},onCancel:()=>{ex()},cancelButtonRef:ew,children:e=>(0,r.jsx)("div",{className:"".concat(e?"bg-[#0039FF]/20 text-[#0039FF] ring-2 ring-[#0039FF]/40":"bg-[#0039FF] text-white","  px-12 py-6 text-3xl rounded-full"),children:(0,r.jsx)(S.G,{icon:e?E.FPD:E.UOM})})}),!ed&&(0,r.jsx)("div",{className:"bg-black/5 rounded-full h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(A,{})}),ed&&(0,r.jsx)("div",{className:"w-12"})]})})]})})]})}function P(){return(0,r.jsx)(u,{children:(0,r.jsx)("main",{className:"bg-[#FAFBFF] h-screen pt-5",children:(0,r.jsx)(R,{})})})}},6870:function(e,t,n){"use strict";n.d(t,{GlobalAudioContextProvider:function(){return a},Y:function(){return c}});var r=n(7437),l=n(2265);let s=(0,l.createContext)(null),a=e=>{let{children:t}=e,n=(0,l.useRef)(null);return n.current||(console.log("creating audio context"),n.current=new(window.AudioContext||window.webkitAudioContext)),(0,r.jsx)(s.Provider,{value:n.current,children:t})},c=()=>{let e=(0,l.useContext)(s);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},3510:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(2265),l=n(9800),s=n(3974),a=n(6870);function c(e){let{onSpeechStart:t,onSpeechEnd:n,onAudioData:c,onRecordingStart:i,onRecordingStop:o,micVolume:u=1,recordingChunkSize:d}=e,m=(0,a.Y)(),x=(0,r.useRef)(null),f=(0,r.useRef)(null),h=(0,r.useRef)(null),g=(0,r.useRef)(null),p=(0,r.useRef)(!1),[v,w]=(0,r.useState)(!1),j=(0,r.useRef)(!1),[N,y]=(0,s.useLocalStorage)("selectedMic",null),[b,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{v?C():h.current&&S()},[v]);let T=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=e&&e!==N;if(e?y(e):e=N,!r){if(p.current){console.log("Mic already being acquired");return}if(x.current&&f.current&&h.current){console.log("Mic already acquired");return}}E(),p.current=!0;try{x.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}}),console.log("Mic acquired",e);let r=x.current.getAudioTracks()[0].getSettings().deviceId;y(null!=r?r:null);let s=m.createMediaStreamSource(x.current);f.current=m.createGain(),s.connect(f.current),f.current.gain.value=u;let a=m.createMediaStreamDestination();f.current.connect(a),h.current=new MediaRecorder(a.stream),g.current=await l.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:x.current,onSpeechStart:()=>{k(!0),null==t||t()},onVADMisfire:()=>{k(!1),null==n||n(!0)},onSpeechEnd:()=>{k(!1),null==n||n(!1)},positiveSpeechThreshold:.5,negativeSpeechThreshold:.35}),g.current.start()}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){console.log("User denied microphone access"),alert("Please allow microphone access to use this feature.");return}console.error("Error accessing microphone:",e),alert("Error accessing microphone: "+e);return}finally{p.current=!1}},C=async()=>{h.current||await T(),h.current&&(h.current.ondataavailable=e=>{null==c||c(e.data)},h.current.onstart=()=>{null==i||i()},h.current.onstop=()=>{null==o||o(j.current)},j.current=!1,await h.current.start(d))},S=()=>{h.current&&h.current.stop()},E=()=>{S(),x.current&&(x.current.getTracks().forEach(e=>{var t;e.stop(),null===(t=x.current)||void 0===t||t.removeTrack(e)}),x.current=null,console.log("Mic released")),f.current&&(f.current.disconnect(),f.current=null),h.current&&(h.current.stop(),h.current=null),g.current&&(b&&(k(!1),null==n||n(!1)),g.current.destroy(),g.current=null)};return(0,r.useEffect)(()=>{f.current&&(f.current.gain.value=u)},[u]),(0,r.useEffect)(()=>(console.log("Acquiring mic on mount"),T(),()=>{console.log("Releasing mic on unmount"),E()}),[]),{isRecording:v,setRecording:w,cancelRecording:()=>{j.current=!0,w(!1)},acquireMic:T,releaseMic:E,selectedMic:N,isVoiceDetected:b}}}},function(e){e.O(0,[284,240,753,51,676,254,990,563,321,322,971,117,744],function(){return e(e.s=3658)}),_N_E=e.O()}]);