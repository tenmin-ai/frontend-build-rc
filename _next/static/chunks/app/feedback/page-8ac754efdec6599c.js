(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[525],{6672:function(e,t,n){Promise.resolve().then(n.bind(n,4395))},4395:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(7437);n(2265);var c=n(9376),l=n(1268),o=n(5217),s=n(3510);function u(){let e=(0,c.useSearchParams)(),t=(0,c.useRouter)(),{isRecording:n,setRecording:u,acquireMic:a}=(0,s.Z)({onAudioData(e){console.log("audio data",e)},recordingChunkSize:100});return(0,r.jsxs)("main",{className:"flex flex-col bg-gradient-to-b from-[#F6F8FF] to-[#F7F8FD] h-screen pt-5 justify-between tracking-[-0.02em]",children:[(0,r.jsx)("div",{className:"flex flex-col items-center w-full pb-6 px-7",children:(0,r.jsxs)("div",{className:"flex w-full justify-between items-center px-1",children:[(0,r.jsx)("button",{className:"text-black self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{t.push("/")},children:(0,r.jsx)(l.G,{icon:o.g82,className:"text-xl"})}),(0,r.jsx)("div",{className:"font-medium pt-1",children:" How was it?"}),(0,r.jsx)("button",{className:" text-black/30 self-start flex items-center h-12 justify-center rounded-full",onClick:()=>{},children:(0,r.jsx)(l.G,{icon:o.cRF,className:"text-xl"})})]})}),(0,r.jsx)("div",{className:"overflow-y-auto",children:e.get("session_id")?(0,r.jsx)("div",{className:"flex flex-col gap-5 px-7"}):(0,r.jsxs)("div",{className:"flex flex-col gap-5 px-7",children:[(0,r.jsx)("h1",{className:"font-bold text-2xl text-black",children:"No Lesson Found"}),(0,r.jsx)("p",{className:"text-gray-500",children:"No lesson found to start."})]})}),(0,r.jsx)("div",{className:"w-full justify-end gap-5 tracking-[-0.02em] pointer-events-none",children:(0,r.jsx)("div",{className:"flex flex-col w-full gap-4 pointer-events-auto  pb-10 pt-6 border-black/10 border-t-2 bg-white\n              ",children:(0,r.jsx)("button",{className:" bg-[#0039FF] mx-8 text-white font-bold px-4 h-[3.6rem] flex-grow rounded-full flex items-center justify-center",onClick:()=>{},children:(0,r.jsx)("p",{className:"font-medium text-lg",children:"Start"})})})})]})}},6870:function(e,t,n){"use strict";n.d(t,{GlobalAudioContextProvider:function(){return o},Y:function(){return s}});var r=n(7437),c=n(2265);let l=(0,c.createContext)(void 0),o=e=>{let{children:t}=e,n=new(window.AudioContext||window.webkitAudioContext);return(0,r.jsx)(l.Provider,{value:{audioContext:n},children:t})},s=()=>{let e=(0,c.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},3510:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(2265),c=n(9800),l=n(3974),o=n(6870);function s(e){let{onSpeechStart:t,onSpeechEnd:n,onAudioData:s,onRecordingStart:u,onRecordingStop:a,micVolume:i=1,recordingChunkSize:d}=e,f=(0,o.Y)().audioContext,x=(0,r.useRef)(null),m=(0,r.useRef)(null),h=(0,r.useRef)(null),v=(0,r.useRef)(null),g=(0,r.useRef)(!1),[p,w]=(0,r.useState)(!1),b=(0,r.useRef)(!1),[j,N]=(0,l.useLocalStorage)("selectedMic",null),[k,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{p?S():h.current&&E()},[p]);let y=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=e&&e!==j;if(e?N(e):e=j,!r){if(g.current){console.log("Mic already being acquired");return}if(x.current&&m.current&&h.current){console.log("Mic already acquired");return}}R(),g.current=!0;try{x.current=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!=e?e:void 0,echoCancellation:!0}}),console.log("Mic acquired",e);let r=f.createMediaStreamSource(x.current);m.current=f.createGain(),r.connect(m.current),m.current.gain.value=i;let l=f.createMediaStreamDestination();m.current.connect(l),h.current=new MediaRecorder(l.stream),v.current=await c.MicVAD.new({workletURL:"/vad/vad.worklet.bundle.min.js",modelURL:"/vad/silero_vad.onnx",ortConfig:e=>{e.env.wasm.wasmPaths="/vad/"},stream:x.current,onSpeechStart:()=>{C(!0),null==t||t()},onVADMisfire:()=>{C(!1),null==n||n(!0)},onSpeechEnd:()=>{C(!1),null==n||n(!1)},positiveSpeechThreshold:.5,negativeSpeechThreshold:.35}),v.current.start()}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){console.log("User denied microphone access"),alert("Please allow microphone access to use this feature.");return}console.error("Error accessing microphone:",e),alert("Error accessing microphone: "+e);return}finally{g.current=!1}},S=async()=>{h.current||await y(),h.current&&(h.current.ondataavailable=e=>{null==s||s(e.data)},h.current.onstart=()=>{null==u||u()},h.current.onstop=()=>{null==a||a(b.current)},b.current=!1,await h.current.start(d))},E=()=>{h.current&&h.current.stop()},R=()=>{E(),x.current&&(x.current.getTracks().forEach(e=>{var t;e.stop(),null===(t=x.current)||void 0===t||t.removeTrack(e)}),x.current=null,console.log("Mic released")),m.current&&(m.current.disconnect(),m.current=null),h.current&&(h.current.stop(),h.current=null),v.current&&(k&&(C(!1),null==n||n(!1)),v.current.destroy(),v.current=null)};return(0,r.useEffect)(()=>{m.current&&(m.current.gain.value=i)},[i]),(0,r.useEffect)(()=>(console.log("Acquiring mic on mount"),y(),()=>{console.log("Releasing mic on unmount"),R()}),[]),{isRecording:p,setRecording:w,cancelRecording:()=>{b.current=!0,w(!1)},acquireMic:y,releaseMic:R,selectedMic:j,isVoiceDetected:k}}}},function(e){e.O(0,[676,753,254,268,563,971,117,744],function(){return e(e.s=6672)}),_N_E=e.O()}]);