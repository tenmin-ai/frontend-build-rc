(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,t,n){Promise.resolve().then(n.bind(n,25094))},25094:function(e,t,n){"use strict";n.r(t);var r=n(57437),l=n(2265),u=n(56870),o=n(49677),i=n(89403),a=n(63399),c=n(16593),s=n(53974),d=n(14438),f=n(74272),g=n(33344);let v=()=>{var e;let t=(0,f.MV)("TTS",{volumeMultiplier:1}),[n,i]=(0,l.useState)(1),c=(0,a.Z)({onPlaybackStart:e=>{t.sendAction({type:"PLAYBACK_STARTED",id:e})},onPlaybackFinish:e=>{t.sendAction({type:"PLAYBACK_FINISHED",id:e})},onPlaybackInterrupt:(e,n,r)=>{t.sendAction({type:"PLAYBACK_INTERRUPTED",id:e,played_duration:n,latest_char_index:r})},volume:t.volumeMultiplier,speed:n}),s=(0,u.Y)(),[d,g]=(0,l.useState)(s.currentTime),[v,h]=(0,l.useState)(s.state),[p,b]=(0,l.useState)(null===(e=navigator.audioSession)||void 0===e?void 0:e.type);(0,l.useEffect)(()=>{let e=setInterval(()=>{var e;g(s.currentTime),h(s.state),b(null===(e=navigator.audioSession)||void 0===e?void 0:e.type)},100);return()=>clearInterval(e)},[s]);let[y,x]=(0,l.useState)(0),m=(0,o.Z)({onAlwaysPCMData:e=>{let t=new DataView(e),n=0;for(let r=0;r<e.byteLength;r+=2)n+=Math.abs(t.getInt16(r,!0));x(20*Math.log10(n/(e.byteLength/2)/32767))},onPCMData:e=>{console.log("PCM data:",e)},onAudioData:e=>{console.log("Audio data:",e)},recordingChunkSize:100});return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("h1",{children:"Speaker Debugging!!!!!!"}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(c,null,2)}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(v,null,2)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{c.startSpeaker(),t.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{window.location.reload()},children:"Reload Window"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{s.suspend().then(()=>{console.log("AudioContext suspended")})},children:"Suspend ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{s.resume().then(()=>{console.log("AudioContext resumed")})},children:"Resume ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{s.close().then(()=>{console.log("AudioContext closed")})},children:"Close ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{s.replaceAudioContext()},children:"Renew ACtx"})]}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(m,null,2)}),(0,r.jsxs)("p",{children:["Volume: ",y]}),(0,r.jsx)("div",{className:"relative h-[20px] w-[100px] bg-black",children:(0,r.jsx)("div",{className:"h-full bg-green-500 transition-all duration-0 ease-linear",style:{width:"".concat(Math.max(0,Math.min(100,y+100)),"%")}})}),(0,r.jsxs)("div",{children:["Current AudioSession Type: ",null!=p?p:"not supported"]}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{if("undefined"!=typeof navigator&&navigator.audioSession){let e=navigator.audioSession.type;navigator.audioSession.type="playback"===e?"play-and-record":"playback"}},children:"Switch audiosession mode"}),(0,r.jsxs)("div",{children:["Current time: ",d.toFixed(2)]})]})};t.default=()=>{var e;let{token:t}=(0,i.f)(),[n,l]=(0,s.useLocalStorage)("language","en"),u=(0,g.rs)({query:{language:n}}),{data:o,isPending:a,isError:h}=(0,c.a)({...u}),p=null===(e=Object.entries(o||{})[0])||void 0===e?void 0:e[0];return a?(0,r.jsx)("div",{children:"Loading..."}):h?(0,r.jsx)("div",{children:"Error loading tutorings"}):(0,r.jsxs)(f.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/practice/").concat(p,"?token=").concat(t),toast:d.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,r.jsx)(v,{}),(0,r.jsx)(d.x,{richColors:!0})]})}},33344:function(e,t,n){"use strict";n.d(t,{GI:function(){return a},PA:function(){return v},ax:function(){return c},bi:function(){return s},iy:function(){return o},rs:function(){return f}});var r=n(52274),l=n(19856);let u=(e,t,n)=>{var r;let u={_id:e,baseUrl:(null!==(r=null==t?void 0:t.client)&&void 0!==r?r:l.Lp).getConfig().baseUrl};return n&&(u._infinite=n),(null==t?void 0:t.body)&&(u.body=t.body),(null==t?void 0:t.headers)&&(u.headers=t.headers),(null==t?void 0:t.path)&&(u.path=t.path),(null==t?void 0:t.query)&&(u.query=t.query),u},o=()=>({mutationFn:async e=>{let{data:t}=await (0,l.H4)({...e,throwOnError:!0});return t}}),i=e=>[u("userMyData",e)],a=e=>(0,r.C)({queryFn:async t=>{let{queryKey:n}=t,{data:r}=await (0,l.It)({...e,...n[0],throwOnError:!0});return r},queryKey:i(e)}),c=()=>({mutationFn:async e=>{let{data:t}=await (0,l._5)({...e,throwOnError:!0});return t}}),s=()=>({mutationFn:async e=>{let{data:t}=await (0,l._G)({...e,throwOnError:!0});return t}}),d=e=>[u("tutoringGetAll",e)],f=e=>(0,r.C)({queryFn:async t=>{let{queryKey:n}=t,{data:r}=await (0,l.zW)({...e,...n[0],throwOnError:!0});return r},queryKey:d(e)}),g=e=>[u("tutoringGetLeaderboard",e)],v=e=>(0,r.C)({queryFn:async t=>{let{queryKey:n}=t,{data:r}=await (0,l.Vz)({...e,...n[0],throwOnError:!0});return r},queryKey:g(e)})},19856:function(e,t,n){"use strict";n.d(t,{H4:function(){return o},Hy:function(){return s},I:function(){return b},It:function(){return d},Lp:function(){return l},Vz:function(){return h},_5:function(){return f},_G:function(){return g},c_:function(){return c},eU:function(){return u},kc:function(){return i},oY:function(){return p},pR:function(){return a},zW:function(){return v}});var r=n(75478);let l=(0,r.eI)((0,r._g)()),u=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,...r.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},o=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).patch({...e,url:"/change_login"})},i=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/oauth/google/login"})},a=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/oauth/google/callback"})},c=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,url:"/user/create_account_and_profile"})},s=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,url:"/user/add_new_profile"})},d=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/user/my_data"})},f=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).patch({...e,url:"/user/change_profile"})},g=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,url:"/lesson/generate_user_roleplay"})},v=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/tutoring/all"})},h=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).get({...e,url:"/tutoring/leaderboard"})},p=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,url:"/call/start/{service}"})},b=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:l).post({...e,url:"/stats/premium"})}},89403:function(e,t,n){"use strict";n.d(t,{f:function(){return l}});var r=n(53974);let l=()=>{let[e,t]=(0,r.useLocalStorage)("token");return{token:e,saveToken:t}}},63399:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2265),l=n(74272),u=n(56870);function o(e){let{onPlaybackStart:t,onPlaybackFinish:n,onPlaybackInterrupt:o,volume:i=1,speed:a=1}=e,c=(0,r.useContext)(l.Dm),s=(0,u.Y)(),d=(0,r.useRef)([]),f=(0,r.useRef)(0),g=(0,r.useRef)(null),v=(0,r.useRef)([]),h=(0,r.useRef)(null),p=(0,r.useRef)(null),b=(0,r.useRef)(!1),[y,x]=(0,r.useState)(!1),m=(0,r.useRef)(y),[S,w]=(0,r.useState)(!1),[C,_]=(0,r.useState)(null),T=(0,r.useRef)(null),[k,A]=(0,r.useState)(null),E=(0,r.useRef)(null),N=(e,t)=>{if(s.resume(),null===h.current){if(b.current){console.log("Speaker is already initializing");return}b.current=!0;try{h.current=s.createGain(),console.log("Gain node created"),h.current.connect(s.destination),h.current.gain.value=i,console.log("Gain node connected to destination"),null==e||e()}catch(e){console.error("Failed to create speaker",e)}finally{b.current=!1}null===h.current&&(null==t||t())}},j=()=>{R(),null!==p.current&&(p.current.disconnect(),p.current=null,console.log("Phase vocoder node disconnected and released")),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Gain node disconnected and released"))},R=()=>{if(v.current.forEach(e=>{clearTimeout(e)}),v.current=[],g.current&&(clearTimeout(g.current),g.current=null),0===d.current.length)return;let e=1,t=d.current.slice(0,5);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(5*t.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),x(!1),m.current=!1;let n=s.currentTime-f.current;null==o||o(T.current,n,k),d.current=t},I=()=>{x(!1),m.current=!1,w(!1),v.current=[],E.current=null,null==n||n(T.current)},P=async e=>{let{i:n,data:r,id:l,t:u}=e,o=new Int16Array(r),i=s.createBuffer(1,o.length,24e3),c=i.getChannelData(0);for(let e=0;e<o.length;e++)c[e]=o[e]/32768;if(null===h.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let p=s.createBufferSource();p.connect(h.current),p.playbackRate.value=a,p.buffer=i;let b=0==n;b&&(d.current.length>0&&R(),f.current=s.currentTime,console.log("Audio start time reset to",f.current));let y=f.current+.1*n/a+.1,S=s.currentTime-y;if(S>0&&(console.log("Audio chunk is late, delaying playback by ".concat(S," seconds.")),y+=S,f.current+=S),p.start(y),d.current.push(p),b&&(g.current=setTimeout(()=>{x(!0),m.current=!0,null==t||t(l),A(0),void 0==l&&console.error("First chunk must have an id"),_(l),T.current=l,g.current=null},-(1e3*S))),p.onended=()=>{d.current.length>0&&(d.current.shift(),w(!1)),E.current&&n==E.current-1?(console.log("Natural end of audio"),I()):0===d.current.length&&(console.log("Lagging, no more audio to play"),w(!0))},void 0!=u){let e=v.current.length,t=s.currentTime,n=u.map((n,r)=>setTimeout(()=>A(e+r),1e3*(f.current+n-t)/a));v.current.push(...n)}};return(0,r.useEffect)(()=>{if(!c){console.log("No session found!");return}return c.registerEvent("TTS_CHUNK",P),c.registerEvent("TTS_INTERRUPT",()=>{R()}),c.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;E.current=n}),()=>{null==c||c.deregisterEvent("TTS_CHUNK"),null==c||c.deregisterEvent("TTS_INTERRUPT"),null==c||c.deregisterEvent("TTS_END")}},[c,a,s]),(0,r.useEffect)(()=>{h.current&&(h.current.gain.value=i)},[i]),(0,r.useEffect)(()=>{p.current&&(p.current.parameters.get("pitchFactor").value=1/a)},[a]),(0,r.useEffect)(()=>()=>{j()},[]),(0,r.useEffect)(()=>{h.current&&(console.log("Audio context changed, recreating speaker"),j(),N())},[s]),{isPlaying:y,isLagging:S,latestAudioId:C,setLatestAudioId:_,latestCharIndex:k,startSpeaker:N,stopSpeaker:j}}}},function(e){e.O(0,[1015,2278,3974,8802,9787,8351,9677,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);