(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,r,n){Promise.resolve().then(n.bind(n,25094))},25094:function(e,r,n){"use strict";n.r(r);var t=n(57437),u=n(33344),l=n(89403),o=n(63399),c=n(16593),i=n(53974),a=n(2265),s=n(14438),d=n(74272);let v=()=>{let e=(0,d.MV)("TTS",{volumeMultiplier:1}),[r,n]=(0,a.useState)(1),u=(0,o.Z)({onPlaybackStart:r=>{e.sendAction({type:"PLAYBACK_STARTED",id:r})},onPlaybackFinish:r=>{e.sendAction({type:"PLAYBACK_FINISHED",id:r})},onPlaybackInterrupt:(r,n,t)=>{e.sendAction({type:"PLAYBACK_INTERRUPTED",id:r,played_duration:n,latest_char_index:t})},volume:e.volumeMultiplier,speed:r});return(0,t.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,t.jsx)("h1",{children:"Speaker Debugging"}),(0,t.jsx)("pre",{children:JSON.stringify(u,null,2)}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{className:"w-40",type:"range",min:"0.5",max:"2",step:"0.1",value:r,onChange:e=>n(parseFloat(e.target.value))}),(0,t.jsxs)("span",{children:["Speed: ",r]})]}),(0,t.jsx)("button",{onClick:()=>{u.startSpeaker(),e.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"})]})};r.default=()=>{var e;let{token:r}=(0,l.f)(),[n,o]=(0,i.useLocalStorage)("language","en"),a=(0,u.rs)({query:{language:n}}),{data:f,isPending:g,isError:p}=(0,c.a)({...a}),h=null===(e=Object.entries(f||{})[0])||void 0===e?void 0:e[0];return g?(0,t.jsx)("div",{children:"Loading..."}):p?(0,t.jsx)("div",{children:"Error loading tutorings"}):(0,t.jsxs)(d.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/practice/").concat(h,"?token=").concat(r),toast:s.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,t.jsx)(v,{}),(0,t.jsx)(s.x,{richColors:!0})]})}},19856:function(e,r,n){"use strict";n.d(r,{H4:function(){return o},Hy:function(){return s},I:function(){return m},It:function(){return d},Lp:function(){return u},Vz:function(){return p},_5:function(){return v},_G:function(){return f},c_:function(){return a},eU:function(){return l},kc:function(){return c},oY:function(){return h},pR:function(){return i},zW:function(){return g}});var t=n(75478);let u=(0,t.eI)((0,t._g)()),l=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).post({...e,...t.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},o=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).patch({...e,url:"/change_login"})},c=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).get({...e,url:"/oauth/google/login"})},i=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).get({...e,url:"/oauth/google/callback"})},a=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).post({...e,url:"/user/create_account_and_profile"})},s=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).post({...e,url:"/user/add_new_profile"})},d=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).get({...e,url:"/user/my_data"})},v=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).patch({...e,url:"/user/change_profile"})},f=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).post({...e,url:"/lesson/generate_user_roleplay"})},g=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).get({...e,url:"/tutoring/all"})},p=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).get({...e,url:"/tutoring/leaderboard"})},h=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).post({...e,url:"/call/start/{service}"})},m=e=>{var r;return(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:u).post({...e,url:"/stats/premium"})}},56870:function(e,r,n){"use strict";n.d(r,{GlobalAudioContextProvider:function(){return o},Y:function(){return c}});var t=n(57437),u=n(2265);let l=(0,u.createContext)(null),o=e=>{let{children:r}=e,n=(0,u.useRef)(null);return n.current||(console.log("creating audio context"),n.current=new AudioContext,n.current.onstatechange=()=>{var e,r,t,u,l,o;if(console.log("onstagechange - AudioContext state changed: ",null===(e=n.current)||void 0===e?void 0:e.state),((null===(r=n.current)||void 0===r?void 0:r.state)==="suspended"||(null===(t=n.current)||void 0===t?void 0:t.state.toString())==="interrupted")&&(console.log("Attempting to resume AudioContext..."),null===(l=n.current)||void 0===l||l.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=n.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(u=n.current)||void 0===u?void 0:u.state)==="running"){let e=null===(o=n.current)||void 0===o?void 0:o.currentTime;setTimeout(()=>{var r;(null===(r=n.current)||void 0===r?void 0:r.currentTime)===e&&(console.warn("AudioContext currentTime is stuck, attempting to fix..."),window.location.reload())},100)}}),(0,t.jsx)(l.Provider,{value:n.current,children:r})},c=()=>{let e=(0,u.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},89403:function(e,r,n){"use strict";n.d(r,{f:function(){return u}});var t=n(53974);let u=()=>{let[e,r]=(0,t.useLocalStorage)("token");return{token:e,saveToken:r}}},63399:function(e,r,n){"use strict";n.d(r,{Z:function(){return o}});var t=n(2265),u=n(74272),l=n(56870);function o(e){let{onPlaybackStart:r,onPlaybackFinish:n,onPlaybackInterrupt:o,volume:c=1,speed:i=1}=e,a=(0,t.useContext)(u.Dm),s=(0,l.Y)(),d=(0,t.useRef)([]),v=(0,t.useRef)(0),f=(0,t.useRef)(null),g=(0,t.useRef)([]),p=(0,t.useRef)(null),h=(0,t.useRef)(null),m=(0,t.useRef)(!1),[T,x]=(0,t.useState)(!1),_=(0,t.useRef)(T),[y,k]=(0,t.useState)(!1),[A,S]=(0,t.useState)(null),C=(0,t.useRef)(null),[E,b]=(0,t.useState)(null),w=(0,t.useRef)(null),R=()=>{N(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==p.current&&(p.current.disconnect(),p.current=null,console.log("Gain node disconnected and released"))},N=()=>{if(g.current.forEach(e=>{clearTimeout(e)}),g.current=[],f.current&&(clearTimeout(f.current),f.current=null),0===d.current.length)return;let e=1,r=d.current.slice(0,5);for(let n of r)if(n&&n.buffer){let r=n.buffer.getChannelData(0);for(let n=0;n<r.length;n++)r[n]=r[n]*e,e-=1/(5*r.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),x(!1),_.current=!1;let n=s.currentTime-v.current;null==o||o(C.current,n,E),d.current=r},j=()=>{x(!1),_.current=!1,k(!1),g.current=[],w.current=null,null==n||n(C.current)},P=async e=>{let{i:n,data:t,id:u,t:l}=e,o=new Int16Array(t),c=s.createBuffer(1,o.length,24e3),a=c.getChannelData(0);for(let e=0;e<o.length;e++)a[e]=o[e]/32768;if(null===p.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let h=s.createBufferSource();h.connect(p.current),h.playbackRate.value=i,h.buffer=c;let m=0==n;m&&(d.current.length>0&&N(),v.current=s.currentTime);let T=v.current+.1*n/i+.1,y=s.currentTime-T;if(y>0&&(console.log("Audio chunk is late, delaying playback by ".concat(y," seconds.")),T+=y,v.current+=y),h.start(T),d.current.push(h),m&&(f.current=setTimeout(()=>{x(!0),_.current=!0,null==r||r(u),b(0),void 0==u&&console.error("First chunk must have an id"),S(u),C.current=u,f.current=null},-(1e3*y))),h.onended=()=>{d.current.length>0&&(d.current.shift(),k(!1)),w.current&&n==w.current-1?(console.log("Natural end of audio"),j()):0===d.current.length&&(console.log("Lagging, no more audio to play"),k(!0))},void 0!=l){let e=g.current.length,r=s.currentTime,n=l.map((n,t)=>setTimeout(()=>b(e+t),1e3*(v.current+n-r)/i));g.current.push(...n)}};return(0,t.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",P),a.registerEvent("TTS_INTERRUPT",()=>{N()}),a.registerEvent("TTS_END",e=>{let{id:r,len:n}=e;w.current=n}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,i]),(0,t.useEffect)(()=>{p.current&&(p.current.gain.value=c)},[c]),(0,t.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/i)},[i]),(0,t.useEffect)(()=>()=>{R()},[]),{isPlaying:T,isLagging:y,latestAudioId:A,setLatestAudioId:S,latestCharIndex:E,startSpeaker:(e,r)=>{if(s.resume(),null===p.current){if(m.current){console.log("Speaker is already initializing");return}m.current=!0;try{p.current=s.createGain(),console.log("Gain node created"),s.audioWorklet.addModule("/worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(s,"phase-vocoder-processor"),p.current.connect(h.current),h.current.connect(s.destination),p.current.gain.value=c,h.current.parameters.get("pitchFactor").value=1/i,console.log("Phase vocoder worklet added"),null==e||e()}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===p.current&&(null==r||r())}},stopSpeaker:R}}}},function(e){e.O(0,[3260,8802,8351,3344,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);