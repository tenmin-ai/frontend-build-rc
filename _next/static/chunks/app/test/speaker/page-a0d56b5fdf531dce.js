(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,t,r){Promise.resolve().then(r.bind(r,25094))},25094:function(e,t,r){"use strict";r.r(t);var n=r(57437),u=r(33344),l=r(56870),o=r(89403),c=r(63399),i=r(16593),a=r(53974),s=r(2265),d=r(14438),v=r(74272);let f=()=>{let e=(0,v.MV)("TTS",{volumeMultiplier:1}),[t,r]=(0,s.useState)(1),u=(0,c.Z)({onPlaybackStart:t=>{e.sendAction({type:"PLAYBACK_STARTED",id:t})},onPlaybackFinish:t=>{e.sendAction({type:"PLAYBACK_FINISHED",id:t})},onPlaybackInterrupt:(t,r,n)=>{e.sendAction({type:"PLAYBACK_INTERRUPTED",id:t,played_duration:r,latest_char_index:n})},volume:e.volumeMultiplier,speed:t}),o=(0,l.Y)();return(0,n.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,n.jsx)("h1",{children:"Speaker Debugging!!!!!!"}),(0,n.jsx)("pre",{children:JSON.stringify(u,null,2)}),(0,n.jsx)("pre",{children:JSON.stringify(o.state.toString(),null,2)}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{className:"w-40",type:"range",min:"0.5",max:"2",step:"0.1",value:t,onChange:e=>r(parseFloat(e.target.value))}),(0,n.jsxs)("span",{children:["Speed: ",t]})]}),(0,n.jsx)("button",{onClick:()=>{console.log(o.state),u.startSpeaker(),e.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"})]})};t.default=()=>{var e;let{token:t}=(0,o.f)(),[r,l]=(0,a.useLocalStorage)("language","en"),c=(0,u.rs)({query:{language:r}}),{data:s,isPending:g,isError:p}=(0,i.a)({...c}),h=null===(e=Object.entries(s||{})[0])||void 0===e?void 0:e[0];return g?(0,n.jsx)("div",{children:"Loading..."}):p?(0,n.jsx)("div",{children:"Error loading tutorings"}):(0,n.jsxs)(v.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/practice/").concat(h,"?token=").concat(t),toast:d.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,n.jsx)(f,{}),(0,n.jsx)(d.x,{richColors:!0})]})}},19856:function(e,t,r){"use strict";r.d(t,{H4:function(){return o},Hy:function(){return s},I:function(){return m},It:function(){return d},Lp:function(){return u},Vz:function(){return p},_5:function(){return v},_G:function(){return f},c_:function(){return a},eU:function(){return l},kc:function(){return c},oY:function(){return h},pR:function(){return i},zW:function(){return g}});var n=r(75478);let u=(0,n.eI)((0,n._g)()),l=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).post({...e,...n.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},o=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).patch({...e,url:"/change_login"})},c=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).get({...e,url:"/oauth/google/login"})},i=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).get({...e,url:"/oauth/google/callback"})},a=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).post({...e,url:"/user/create_account_and_profile"})},s=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).post({...e,url:"/user/add_new_profile"})},d=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).get({...e,url:"/user/my_data"})},v=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).patch({...e,url:"/user/change_profile"})},f=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).post({...e,url:"/lesson/generate_user_roleplay"})},g=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).get({...e,url:"/tutoring/all"})},p=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).get({...e,url:"/tutoring/leaderboard"})},h=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).post({...e,url:"/call/start/{service}"})},m=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:u).post({...e,url:"/stats/premium"})}},56870:function(e,t,r){"use strict";r.d(t,{GlobalAudioContextProvider:function(){return o},Y:function(){return c}});var n=r(57437),u=r(2265);let l=(0,u.createContext)(null),o=e=>{let{children:t}=e,r=(0,u.useRef)(null);return r.current||(console.log("creating audio context"),r.current=new AudioContext,r.current.onstatechange=()=>{var e,t,n,u,l,o;if(console.log("onstagechange - AudioContext state changed: ",null===(e=r.current)||void 0===e?void 0:e.state),(null===(t=r.current)||void 0===t?void 0:t.state)==="suspended"&&(console.log("Attempting to resume AudioContext..."),null===(l=r.current)||void 0===l||l.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=r.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(n=r.current)||void 0===n?void 0:n.state.toString())==="interrupted"&&console.log("Safari interrupted audiocontext, but won't resume for now..."),(null===(u=r.current)||void 0===u?void 0:u.state)==="running"){let e=null===(o=r.current)||void 0===o?void 0:o.currentTime;setTimeout(()=>{var t;(null===(t=r.current)||void 0===t?void 0:t.currentTime)===e&&(console.warn("AudioContext currentTime is stuck, attempting to fix..."),window.location.reload())},100)}}),(0,n.jsx)(l.Provider,{value:r.current,children:t})},c=()=>{let e=(0,u.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},89403:function(e,t,r){"use strict";r.d(t,{f:function(){return u}});var n=r(53974);let u=()=>{let[e,t]=(0,n.useLocalStorage)("token");return{token:e,saveToken:t}}},63399:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(2265),u=r(74272),l=r(56870);function o(e){let{onPlaybackStart:t,onPlaybackFinish:r,onPlaybackInterrupt:o,volume:c=1,speed:i=1}=e,a=(0,n.useContext)(u.Dm),s=(0,l.Y)(),d=(0,n.useRef)([]),v=(0,n.useRef)(0),f=(0,n.useRef)(null),g=(0,n.useRef)([]),p=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)(!1),[x,T]=(0,n.useState)(!1),_=(0,n.useRef)(x),[y,S]=(0,n.useState)(!1),[k,A]=(0,n.useState)(null),C=(0,n.useRef)(null),[E,b]=(0,n.useState)(null),w=(0,n.useRef)(null),R=()=>{N(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==p.current&&(p.current.disconnect(),p.current=null,console.log("Gain node disconnected and released"))},N=()=>{if(g.current.forEach(e=>{clearTimeout(e)}),g.current=[],f.current&&(clearTimeout(f.current),f.current=null),0===d.current.length)return;let e=1,t=d.current.slice(0,5);for(let r of t)if(r&&r.buffer){let t=r.buffer.getChannelData(0);for(let r=0;r<t.length;r++)t[r]=t[r]*e,e-=1/(5*t.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),T(!1),_.current=!1;let r=s.currentTime-v.current;null==o||o(C.current,r,E),d.current=t},j=()=>{T(!1),_.current=!1,S(!1),g.current=[],w.current=null,null==r||r(C.current)},P=async e=>{let{i:r,data:n,id:u,t:l}=e,o=new Int16Array(n),c=s.createBuffer(1,o.length,24e3),a=c.getChannelData(0);for(let e=0;e<o.length;e++)a[e]=o[e]/32768;if(null===p.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let h=s.createBufferSource();h.connect(p.current),h.playbackRate.value=i,h.buffer=c;let m=0==r;m&&(d.current.length>0&&N(),v.current=s.currentTime,console.log("Audio start time reset to",v.current));let x=v.current+.1*r/i+.1,y=s.currentTime-x;if(y>0&&(console.log("Audio chunk is late, delaying playback by ".concat(y," seconds.")),x+=y,v.current+=y),h.start(x),d.current.push(h),m&&(f.current=setTimeout(()=>{T(!0),_.current=!0,null==t||t(u),b(0),void 0==u&&console.error("First chunk must have an id"),A(u),C.current=u,f.current=null},-(1e3*y))),h.onended=()=>{d.current.length>0&&(d.current.shift(),S(!1)),w.current&&r==w.current-1?(console.log("Natural end of audio"),j()):0===d.current.length&&(console.log("Lagging, no more audio to play"),S(!0))},void 0!=l){let e=g.current.length,t=s.currentTime,r=l.map((r,n)=>setTimeout(()=>b(e+n),1e3*(v.current+r-t)/i));g.current.push(...r)}};return(0,n.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",P),a.registerEvent("TTS_INTERRUPT",()=>{N()}),a.registerEvent("TTS_END",e=>{let{id:t,len:r}=e;w.current=r}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,i]),(0,n.useEffect)(()=>{p.current&&(p.current.gain.value=c)},[c]),(0,n.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/i)},[i]),(0,n.useEffect)(()=>()=>{R()},[]),{isPlaying:x,isLagging:y,latestAudioId:k,setLatestAudioId:A,latestCharIndex:E,startSpeaker:(e,t)=>{if(s.resume(),null===p.current){if(m.current){console.log("Speaker is already initializing");return}m.current=!0;try{p.current=s.createGain(),console.log("Gain node created"),s.audioWorklet.addModule("/worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(s,"phase-vocoder-processor"),p.current.connect(h.current),h.current.connect(s.destination),p.current.gain.value=c,h.current.parameters.get("pitchFactor").value=1/i,console.log("Phase vocoder worklet added"),null==e||e()}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===p.current&&(null==t||t())}},stopSpeaker:R}}}},function(e){e.O(0,[3260,8802,8351,3344,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);