(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,t,n){Promise.resolve().then(n.bind(n,25094))},25094:function(e,t,n){"use strict";n.r(t);var r=n(57437),o=n(2265),l=n(56870),u=n(49677),i=n(89403),a=n(63399),s=n(16593),c=n(53974),d=n(14438),g=n(74272),f=n(33344);let v=()=>{var e;let t=(0,g.MV)("TTS",{volumeMultiplier:1}),[n,i]=(0,o.useState)(1),s=(0,a.Z)({onPlaybackStart:e=>{t.sendAction({type:"PLAYBACK_STARTED",id:e})},onPlaybackFinish:e=>{t.sendAction({type:"PLAYBACK_FINISHED",id:e})},onPlaybackInterrupt:(e,n,r)=>{t.sendAction({type:"PLAYBACK_INTERRUPTED",id:e,played_duration:n,latest_char_index:r})},volume:t.volumeMultiplier,speed:n}),c=(0,l.Y)(),[d,f]=(0,o.useState)(c.currentTime),[v,p]=(0,o.useState)("undefined"!=typeof navigator&&navigator.audioSession?null!==(e=navigator.audioSession.state)&&void 0!==e?e:"null":"not supported");(0,o.useEffect)(()=>{let e=setInterval(()=>{f(c.currentTime)},1e3);return()=>clearInterval(e)},[c]),navigator.audioSession&&(navigator.audioSession.onstatechange=()=>{console.log("AudioSession state changed: ",navigator.audioSession.state),null==navigator.audioSession.state&&p("null"),p(navigator.audioSession.state)});let[h,x]=(0,o.useState)(0),b=(0,u.Z)({onAlwaysPCMData:e=>{let t=new DataView(e),n=0;for(let r=0;r<e.byteLength;r+=2)n+=Math.abs(t.getInt16(r,!0));x(20*Math.log10(n/(e.byteLength/2)/32767))},onPCMData:e=>{console.log("PCM data:",e)},onAudioData:e=>{console.log("Audio data:",e)},recordingChunkSize:100});return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("h1",{children:"Speaker Debugging!!!!!!"}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(s,null,2)}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(c.state.toString(),null,2)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{s.startSpeaker(),t.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{window.location.reload()},children:"Reload Window"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{c.suspend().then(()=>{console.log("AudioContext suspended")})},children:"Suspend ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{c.resume().then(()=>{console.log("AudioContext resumed")})},children:"Resume ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{c.close().then(()=>{console.log("AudioContext closed")})},children:"Close ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{c.replaceAudioContext()},children:"Renew ACtx"})]}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(b,null,2)}),(0,r.jsxs)("p",{children:["Volume: ",h]}),(0,r.jsx)("div",{className:"relative h-[20px] w-[100px] bg-black",children:(0,r.jsx)("div",{className:"h-full bg-green-500 transition-all duration-0 ease-linear",style:{width:"".concat(Math.max(0,Math.min(100,h+100)),"%")}})}),(0,r.jsxs)("div",{children:["Current AudioSession State: ",v]}),(0,r.jsxs)("pre",{className:"text-sm",children:["Current AudioSession Type:"," ","undefined"!=typeof navigator&&navigator.audioSession?JSON.stringify(navigator.audioSession.type,null,2):"not supported"]}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{if("undefined"!=typeof navigator&&navigator.audioSession){let e=navigator.audioSession.type;navigator.audioSession.type="playback"===e?"play-and-record":"playback"}},children:"Switch audiosession mode"}),(0,r.jsxs)("div",{children:["Current time: ",d.toFixed(2)]})]})};t.default=()=>{var e;let{token:t}=(0,i.f)(),[n,o]=(0,c.useLocalStorage)("language","en"),l=(0,f.rs)({query:{language:n}}),{data:u,isPending:a,isError:p}=(0,s.a)({...l}),h=null===(e=Object.entries(u||{})[0])||void 0===e?void 0:e[0];return a?(0,r.jsx)("div",{children:"Loading..."}):p?(0,r.jsx)("div",{children:"Error loading tutorings"}):(0,r.jsxs)(g.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/practice/").concat(h,"?token=").concat(t),toast:d.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,r.jsx)(v,{}),(0,r.jsx)(d.x,{richColors:!0})]})}},19856:function(e,t,n){"use strict";n.d(t,{H4:function(){return u},Hy:function(){return c},I:function(){return x},It:function(){return d},Lp:function(){return o},Vz:function(){return p},_5:function(){return g},_G:function(){return f},c_:function(){return s},eU:function(){return l},kc:function(){return i},oY:function(){return h},pR:function(){return a},zW:function(){return v}});var r=n(75478);let o=(0,r.eI)((0,r._g)()),l=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,...r.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},u=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).patch({...e,url:"/change_login"})},i=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/oauth/google/login"})},a=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/oauth/google/callback"})},s=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/user/create_account_and_profile"})},c=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/user/add_new_profile"})},d=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/user/my_data"})},g=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).patch({...e,url:"/user/change_profile"})},f=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/lesson/generate_user_roleplay"})},v=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/tutoring/all"})},p=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/tutoring/leaderboard"})},h=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/call/start/{service}"})},x=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/stats/premium"})}},56870:function(e,t,n){"use strict";n.d(t,{GlobalAudioContextProvider:function(){return i},Y:function(){return a}});var r=n(57437),o=n(2265);let l=(0,o.createContext)(null),u=()=>{"undefined"!=typeof navigator&&navigator.audioSession&&(navigator.audioSession.type="play-and-record"),console.log("creating audio context");let e=new AudioContext;return e.onstatechange=()=>{if(console.log("onstatechange - AudioContext state changed: ",e.state),"suspended"===e.state&&(console.log("Attempting to resume AudioContext..."),e.resume().then(()=>{console.log("AudioContext state: ",e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),"interrupted"===e.state.toString()&&console.log("Safari interrupted audiocontext, but won't resume for now..."),"running"===e.state){let t=e.currentTime;setTimeout(()=>{console.log("[useAudioContext] Comparing last known time: ",t),console.log("[useAudioContext] Current time: ",e.currentTime),e.currentTime===t&&console.warn("AudioContext currentTime is stuck, attempting to fix...")},100)}},e},i=e=>{let{children:t}=e,[n,i]=(0,o.useState)(()=>u()),a=(0,o.useCallback)(()=>{console.log("Replacing AudioContext with new one"),i(u())},[]);return(0,r.jsx)(l.Provider,{value:{audioContext:n,replaceAudioContext:a},children:t})},a=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return Object.assign(e.audioContext,{replaceAudioContext:e.replaceAudioContext})}},63399:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(2265),o=n(74272),l=n(56870);function u(e){let{onPlaybackStart:t,onPlaybackFinish:n,onPlaybackInterrupt:u,volume:i=1,speed:a=1}=e,s=(0,r.useContext)(o.Dm),c=(0,l.Y)(),d=(0,r.useRef)([]),g=(0,r.useRef)(0),f=(0,r.useRef)(null),v=(0,r.useRef)([]),p=(0,r.useRef)(null),h=(0,r.useRef)(null),x=(0,r.useRef)(!1),[b,m]=(0,r.useState)(!1),y=(0,r.useRef)(b),[S,C]=(0,r.useState)(!1),[A,T]=(0,r.useState)(null),k=(0,r.useRef)(null),[w,N]=(0,r.useState)(null),_=(0,r.useRef)(null),j=()=>{E(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==p.current&&(p.current.disconnect(),p.current=null,console.log("Gain node disconnected and released"))},E=()=>{if(v.current.forEach(e=>{clearTimeout(e)}),v.current=[],f.current&&(clearTimeout(f.current),f.current=null),0===d.current.length)return;let e=1,t=d.current.slice(0,5);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(5*t.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),m(!1),y.current=!1;let n=c.currentTime-g.current;null==u||u(k.current,n,w),d.current=t},R=()=>{m(!1),y.current=!1,C(!1),v.current=[],_.current=null,null==n||n(k.current)},P=async e=>{let{i:n,data:r,id:o,t:l}=e,u=new Int16Array(r),i=c.createBuffer(1,u.length,24e3),s=i.getChannelData(0);for(let e=0;e<u.length;e++)s[e]=u[e]/32768;if(null===p.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let h=c.createBufferSource();h.connect(p.current),h.playbackRate.value=a,h.buffer=i;let x=0==n;x&&(d.current.length>0&&E(),g.current=c.currentTime,console.log("Audio start time reset to",g.current));let b=g.current+.1*n/a+.1,S=c.currentTime-b;if(S>0&&(console.log("Audio chunk is late, delaying playback by ".concat(S," seconds.")),b+=S,g.current+=S),h.start(b),d.current.push(h),x&&(f.current=setTimeout(()=>{m(!0),y.current=!0,null==t||t(o),N(0),void 0==o&&console.error("First chunk must have an id"),T(o),k.current=o,f.current=null},-(1e3*S))),h.onended=()=>{d.current.length>0&&(d.current.shift(),C(!1)),_.current&&n==_.current-1?(console.log("Natural end of audio"),R()):0===d.current.length&&(console.log("Lagging, no more audio to play"),C(!0))},void 0!=l){let e=v.current.length,t=c.currentTime,n=l.map((n,r)=>setTimeout(()=>N(e+r),1e3*(g.current+n-t)/a));v.current.push(...n)}};return(0,r.useEffect)(()=>{if(!s){console.log("No session found!");return}return s.registerEvent("TTS_CHUNK",P),s.registerEvent("TTS_INTERRUPT",()=>{E()}),s.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;_.current=n}),()=>{null==s||s.deregisterEvent("TTS_CHUNK"),null==s||s.deregisterEvent("TTS_INTERRUPT"),null==s||s.deregisterEvent("TTS_END")}},[s,a]),(0,r.useEffect)(()=>{p.current&&(p.current.gain.value=i)},[i]),(0,r.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/a)},[a]),(0,r.useEffect)(()=>()=>{j()},[]),{isPlaying:b,isLagging:S,latestAudioId:A,setLatestAudioId:T,latestCharIndex:w,startSpeaker:(e,t)=>{if(c.resume(),null===p.current){if(x.current){console.log("Speaker is already initializing");return}x.current=!0;try{p.current=c.createGain(),console.log("Gain node created"),p.current.connect(c.destination),p.current.gain.value=i,console.log("Gain node connected to destination"),null==e||e()}catch(e){console.error("Failed to create speaker",e)}finally{x.current=!1}null===p.current&&(null==t||t())}},stopSpeaker:j}}}},function(e){e.O(0,[1015,2278,3974,8802,9787,8351,6650,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);