(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,n,t){Promise.resolve().then(t.bind(t,25094))},25094:function(e,n,t){"use strict";t.r(n);var r=t(57437),u=t(33344),l=t(56870),o=t(89403),c=t(63399),i=t(16593),a=t(53974),s=t(2265),d=t(14438),f=t(74272);let v=()=>{let e=(0,f.MV)("TTS",{volumeMultiplier:1}),[n,t]=(0,s.useState)(1),u=(0,c.Z)({onPlaybackStart:n=>{e.sendAction({type:"PLAYBACK_STARTED",id:n})},onPlaybackFinish:n=>{e.sendAction({type:"PLAYBACK_FINISHED",id:n})},onPlaybackInterrupt:(n,t,r)=>{e.sendAction({type:"PLAYBACK_INTERRUPTED",id:n,played_duration:t,latest_char_index:r})},volume:e.volumeMultiplier,speed:n}),o=(0,l.Y)();return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,r.jsx)("h1",{children:"Speaker Debugging!!!!!!"}),(0,r.jsx)("pre",{children:JSON.stringify(u,null,2)}),(0,r.jsx)("pre",{children:JSON.stringify(o.state.toString(),null,2)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{className:"w-40",type:"range",min:"0.5",max:"2",step:"0.1",value:n,onChange:e=>t(parseFloat(e.target.value))}),(0,r.jsxs)("span",{children:["Speed: ",n]})]}),(0,r.jsx)("button",{onClick:()=>{console.log(o.state),u.startSpeaker(),e.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"})]})};n.default=()=>{var e;let{token:n}=(0,o.f)(),[t,l]=(0,a.useLocalStorage)("language","en"),c=(0,u.rs)({query:{language:t}}),{data:s,isPending:g,isError:p}=(0,i.a)({...c}),h=null===(e=Object.entries(s||{})[0])||void 0===e?void 0:e[0];return g?(0,r.jsx)("div",{children:"Loading..."}):p?(0,r.jsx)("div",{children:"Error loading tutorings"}):(0,r.jsxs)(f.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/practice/").concat(h,"?token=").concat(n),toast:d.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,r.jsx)(v,{}),(0,r.jsx)(d.x,{richColors:!0})]})}},19856:function(e,n,t){"use strict";t.d(n,{H4:function(){return o},Hy:function(){return s},I:function(){return m},It:function(){return d},Lp:function(){return u},Vz:function(){return p},_5:function(){return f},_G:function(){return v},c_:function(){return a},eU:function(){return l},kc:function(){return c},oY:function(){return h},pR:function(){return i},zW:function(){return g}});var r=t(75478);let u=(0,r.eI)((0,r._g)()),l=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,...r.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},o=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).patch({...e,url:"/change_login"})},c=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/oauth/google/login"})},i=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/oauth/google/callback"})},a=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/user/create_account_and_profile"})},s=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/user/add_new_profile"})},d=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/user/my_data"})},f=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).patch({...e,url:"/user/change_profile"})},v=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/lesson/generate_user_roleplay"})},g=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/tutoring/all"})},p=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/tutoring/leaderboard"})},h=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/call/start/{service}"})},m=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/stats/premium"})}},56870:function(e,n,t){"use strict";t.d(n,{GlobalAudioContextProvider:function(){return o},Y:function(){return c}});var r=t(57437),u=t(2265);let l=(0,u.createContext)(null),o=e=>{let{children:n}=e,t=(0,u.useRef)(null);return t.current||(console.log("creating audio context"),t.current=new AudioContext,t.current.onstatechange=()=>{var e,n,r,u,l,o;if(console.log("onstagechange - AudioContext state changed: ",null===(e=t.current)||void 0===e?void 0:e.state),(null===(n=t.current)||void 0===n?void 0:n.state)==="suspended"&&(console.log("Attempting to resume AudioContext..."),null===(l=t.current)||void 0===l||l.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=t.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(r=t.current)||void 0===r?void 0:r.state.toString())==="interrupted"&&console.log("Safari interrupted audiocontext, but won't resume for now..."),(null===(u=t.current)||void 0===u?void 0:u.state)==="running"){let e=null===(o=t.current)||void 0===o?void 0:o.currentTime;setTimeout(()=>{var n;(null===(n=t.current)||void 0===n?void 0:n.currentTime)===e&&(console.warn("AudioContext currentTime is stuck, attempting to fix..."),window.location.reload())},100)}}),(0,r.jsx)(l.Provider,{value:t.current,children:n})},c=()=>{let e=(0,u.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},89403:function(e,n,t){"use strict";t.d(n,{f:function(){return u}});var r=t(53974);let u=()=>{let[e,n]=(0,r.useLocalStorage)("token");return{token:e,saveToken:n}}},63399:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(2265),u=t(74272),l=t(56870);function o(e){let{onPlaybackStart:n,onPlaybackFinish:t,onPlaybackInterrupt:o,volume:c=1,speed:i=1}=e,a=(0,r.useContext)(u.Dm),s=(0,l.Y)(),d=(0,r.useRef)([]),f=(0,r.useRef)(0),v=(0,r.useRef)(null),g=(0,r.useRef)([]),p=(0,r.useRef)(null),h=(0,r.useRef)(null),m=(0,r.useRef)(!1),[x,T]=(0,r.useState)(!1),_=(0,r.useRef)(x),[y,S]=(0,r.useState)(!1),[A,k]=(0,r.useState)(null),C=(0,r.useRef)(null),[E,b]=(0,r.useState)(null),R=(0,r.useRef)(null),w=()=>{N(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==p.current&&(p.current.disconnect(),p.current=null,console.log("Gain node disconnected and released"))},N=()=>{if(g.current.forEach(e=>{clearTimeout(e)}),g.current=[],v.current&&(clearTimeout(v.current),v.current=null),0===d.current.length)return;let e=1,n=d.current.slice(0,5);for(let t of n)if(t&&t.buffer){let n=t.buffer.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=n[t]*e,e-=1/(5*n.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),T(!1),_.current=!1;let t=s.currentTime-f.current;null==o||o(C.current,t,E),d.current=n},j=()=>{T(!1),_.current=!1,S(!1),g.current=[],R.current=null,null==t||t(C.current)},P=async e=>{let{i:t,data:r,id:u,t:l}=e,o=new Int16Array(r),c=s.createBuffer(1,o.length,24e3),a=c.getChannelData(0);for(let e=0;e<o.length;e++)a[e]=o[e]/32768;if(null===p.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let h=s.createBufferSource();h.connect(p.current),h.playbackRate.value=i,h.buffer=c;let m=0==t;m&&(d.current.length>0&&N(),f.current=s.currentTime,console.log("Audio start time reset to",f.current));let x=f.current+.1*t/i+.1,y=s.currentTime-x;if(y>0&&(console.log("Audio chunk is late, delaying playback by ".concat(y," seconds.")),x+=y,f.current+=y),h.start(x),d.current.push(h),m&&(v.current=setTimeout(()=>{T(!0),_.current=!0,null==n||n(u),b(0),void 0==u&&console.error("First chunk must have an id"),k(u),C.current=u,v.current=null},-(1e3*y))),h.onended=()=>{d.current.length>0&&(d.current.shift(),S(!1)),R.current&&t==R.current-1?(console.log("Natural end of audio"),j()):0===d.current.length&&(console.log("Lagging, no more audio to play"),S(!0))},void 0!=l){let e=g.current.length,n=s.currentTime,t=l.map((t,r)=>setTimeout(()=>b(e+r),1e3*(f.current+t-n)/i));g.current.push(...t)}};return(0,r.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",P),a.registerEvent("TTS_INTERRUPT",()=>{N()}),a.registerEvent("TTS_END",e=>{let{id:n,len:t}=e;R.current=t}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,i]),(0,r.useEffect)(()=>{p.current&&(p.current.gain.value=c)},[c]),(0,r.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/i)},[i]),(0,r.useEffect)(()=>()=>{w()},[]),{isPlaying:x,isLagging:y,latestAudioId:A,setLatestAudioId:k,latestCharIndex:E,startSpeaker:(e,n)=>{if(s.resume(),null===p.current){if(m.current){console.log("Speaker is already initializing");return}m.current=!0;try{p.current=s.createGain(),console.log("Gain node created"),p.current.connect(s.destination),p.current.gain.value=c,console.log("Gain node connected to destination"),null==e||e()}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===p.current&&(null==n||n())}},stopSpeaker:w}}}},function(e){e.O(0,[3260,8802,8351,3344,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);