(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,t,n){Promise.resolve().then(n.bind(n,25094))},25094:function(e,t,n){"use strict";n.r(t);var r=n(57437),o=n(33344),l=n(56870),u=n(49677),i=n(89403),a=n(63399),c=n(16593),s=n(53974),d=n(2265),g=n(14438),f=n(74272);let p=()=>{let e=(0,f.MV)("TTS",{volumeMultiplier:1}),[t,n]=(0,d.useState)(1),o=(0,a.Z)({onPlaybackStart:t=>{e.sendAction({type:"PLAYBACK_STARTED",id:t})},onPlaybackFinish:t=>{e.sendAction({type:"PLAYBACK_FINISHED",id:t})},onPlaybackInterrupt:(t,n,r)=>{e.sendAction({type:"PLAYBACK_INTERRUPTED",id:t,played_duration:n,latest_char_index:r})},volume:e.volumeMultiplier,speed:t}),i=(0,l.Y)(),[c,s]=(0,d.useState)(i.currentTime);(0,d.useEffect)(()=>{let e=setInterval(()=>{s(i.currentTime)},1e3);return()=>clearInterval(e)},[i]);let[g,p]=(0,d.useState)(0),h=(0,u.Z)({onAlwaysPCMData:e=>{let t=new DataView(e),n=0;for(let r=0;r<e.byteLength;r+=2)n+=Math.abs(t.getInt16(r,!0));p(20*Math.log10(n/(e.byteLength/2)/32767))},onPCMData:e=>{console.log("PCM data:",e)},onAudioData(e){console.log("Audio data:",e)},recordingChunkSize:100});return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("h1",{children:"Speaker Debugging!!!!!!"}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(o,null,2)}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(i.state.toString(),null,2)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{console.log(i),o.startSpeaker(),e.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{window.location.reload()},children:"Reload Window"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{i.suspend().then(()=>{console.log("AudioContext suspended")})},children:"Suspend ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{i.resume().then(()=>{console.log("AudioContext resumed")})},children:"Resume ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{i.close().then(()=>{console.log("AudioContext closed")})},children:"Close ACtx"}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",onClick:()=>{i.replaceAudioContext()},children:"Renew ACtx"})]}),(0,r.jsx)("pre",{className:"text-sm",children:JSON.stringify(h,null,2)}),(0,r.jsxs)("p",{children:["Volume: ",g]}),(0,r.jsx)("div",{className:"relative h-[20px] w-[100px] bg-black",children:(0,r.jsx)("div",{className:"h-full bg-green-500 transition-all duration-0 ease-linear",style:{width:"".concat(Math.max(0,Math.min(100,g+100)),"%")}})}),(0,r.jsxs)("div",{children:["Current AudioSession Type:"," ","undefined"!=typeof navigator&&navigator.audioSession?navigator.audioSession.type:"not supported"]}),(0,r.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700",onClick:()=>{if("undefined"!=typeof navigator&&navigator.audioSession){let e=navigator.audioSession.type;navigator.audioSession.type="playback"===e?"play-and-record":"playback"}},children:"Switch audiosession mode"}),(0,r.jsxs)("div",{children:["Current time: ",c.toFixed(2)]})]})};t.default=()=>{var e;let{token:t}=(0,i.f)(),[n,l]=(0,s.useLocalStorage)("language","en"),u=(0,o.rs)({query:{language:n}}),{data:a,isPending:d,isError:h}=(0,c.a)({...u}),v=null===(e=Object.entries(a||{})[0])||void 0===e?void 0:e[0];return d?(0,r.jsx)("div",{children:"Loading..."}):h?(0,r.jsx)("div",{children:"Error loading tutorings"}):(0,r.jsxs)(f.eA,{url:"".concat("wss://backend-us-rc.tenmin.ai","/ws/practice/").concat(v,"?token=").concat(t),toast:g.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,r.jsx)(p,{}),(0,r.jsx)(g.x,{richColors:!0})]})}},19856:function(e,t,n){"use strict";n.d(t,{H4:function(){return u},Hy:function(){return s},I:function(){return x},It:function(){return d},Lp:function(){return o},Vz:function(){return h},_5:function(){return g},_G:function(){return f},c_:function(){return c},eU:function(){return l},kc:function(){return i},oY:function(){return v},pR:function(){return a},zW:function(){return p}});var r=n(75478);let o=(0,r.eI)((0,r._g)()),l=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,...r.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},u=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).patch({...e,url:"/change_login"})},i=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/oauth/google/login"})},a=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/oauth/google/callback"})},c=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/user/create_account_and_profile"})},s=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/user/add_new_profile"})},d=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/user/my_data"})},g=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).patch({...e,url:"/user/change_profile"})},f=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/lesson/generate_user_roleplay"})},p=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/tutoring/all"})},h=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).get({...e,url:"/tutoring/leaderboard"})},v=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/call/start/{service}"})},x=e=>{var t;return(null!==(t=null==e?void 0:e.client)&&void 0!==t?t:o).post({...e,url:"/stats/premium"})}},56870:function(e,t,n){"use strict";n.d(t,{GlobalAudioContextProvider:function(){return i},Y:function(){return a}});var r=n(57437),o=n(2265);let l=(0,o.createContext)(null),u=()=>{"undefined"!=typeof navigator&&navigator.audioSession&&(navigator.audioSession.type="play-and-record"),console.log("creating audio context");let e=new AudioContext;return e.onstatechange=()=>{if(console.log("onstatechange - AudioContext state changed: ",e.state),"suspended"===e.state&&(console.log("Attempting to resume AudioContext..."),e.resume().then(()=>{console.log("AudioContext state: ",e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),"interrupted"===e.state.toString()&&console.log("Safari interrupted audiocontext, but won't resume for now..."),"running"===e.state){let t=e.currentTime;setTimeout(()=>{console.log("[useAudioContext] Comparing last known time: ",t),console.log("[useAudioContext] Current time: ",e.currentTime),e.currentTime===t&&console.warn("AudioContext currentTime is stuck, attempting to fix...")},100)}},e},i=e=>{let{children:t}=e,[n,i]=(0,o.useState)(()=>u()),a=(0,o.useCallback)(()=>{console.log("Replacing AudioContext with new one"),i(u())},[]);return(0,r.jsx)(l.Provider,{value:{audioContext:n,replaceAudioContext:a},children:t})},a=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return Object.assign(e.audioContext,{replaceAudioContext:e.replaceAudioContext})}},63399:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(2265),o=n(74272),l=n(56870);function u(e){let{onPlaybackStart:t,onPlaybackFinish:n,onPlaybackInterrupt:u,volume:i=1,speed:a=1}=e,c=(0,r.useContext)(o.Dm),s=(0,l.Y)(),d=(0,r.useRef)([]),g=(0,r.useRef)(0),f=(0,r.useRef)(null),p=(0,r.useRef)([]),h=(0,r.useRef)(null),v=(0,r.useRef)(null),x=(0,r.useRef)(!1),[b,m]=(0,r.useState)(!1),y=(0,r.useRef)(b),[C,A]=(0,r.useState)(!1),[S,T]=(0,r.useState)(null),k=(0,r.useRef)(null),[w,_]=(0,r.useState)(null),N=(0,r.useRef)(null),j=()=>{E(),null!==v.current&&(v.current.disconnect(),v.current=null,console.log("Phase vocoder node disconnected and released")),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Gain node disconnected and released"))},E=()=>{if(p.current.forEach(e=>{clearTimeout(e)}),p.current=[],f.current&&(clearTimeout(f.current),f.current=null),0===d.current.length)return;let e=1,t=d.current.slice(0,5);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(5*t.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),m(!1),y.current=!1;let n=s.currentTime-g.current;null==u||u(k.current,n,w),d.current=t},R=()=>{m(!1),y.current=!1,A(!1),p.current=[],N.current=null,null==n||n(k.current)},P=async e=>{let{i:n,data:r,id:o,t:l}=e,u=new Int16Array(r),i=s.createBuffer(1,u.length,24e3),c=i.getChannelData(0);for(let e=0;e<u.length;e++)c[e]=u[e]/32768;if(null===h.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let v=s.createBufferSource();v.connect(h.current),v.playbackRate.value=a,v.buffer=i;let x=0==n;x&&(d.current.length>0&&E(),g.current=s.currentTime,console.log("Audio start time reset to",g.current));let b=g.current+.1*n/a+.1,C=s.currentTime-b;if(C>0&&(console.log("Audio chunk is late, delaying playback by ".concat(C," seconds.")),b+=C,g.current+=C),v.start(b),d.current.push(v),x&&(f.current=setTimeout(()=>{m(!0),y.current=!0,null==t||t(o),_(0),void 0==o&&console.error("First chunk must have an id"),T(o),k.current=o,f.current=null},-(1e3*C))),v.onended=()=>{d.current.length>0&&(d.current.shift(),A(!1)),N.current&&n==N.current-1?(console.log("Natural end of audio"),R()):0===d.current.length&&(console.log("Lagging, no more audio to play"),A(!0))},void 0!=l){let e=p.current.length,t=s.currentTime,n=l.map((n,r)=>setTimeout(()=>_(e+r),1e3*(g.current+n-t)/a));p.current.push(...n)}};return(0,r.useEffect)(()=>{if(!c){console.log("No session found!");return}return c.registerEvent("TTS_CHUNK",P),c.registerEvent("TTS_INTERRUPT",()=>{E()}),c.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;N.current=n}),()=>{null==c||c.deregisterEvent("TTS_CHUNK"),null==c||c.deregisterEvent("TTS_INTERRUPT"),null==c||c.deregisterEvent("TTS_END")}},[c,a]),(0,r.useEffect)(()=>{h.current&&(h.current.gain.value=i)},[i]),(0,r.useEffect)(()=>{v.current&&(v.current.parameters.get("pitchFactor").value=1/a)},[a]),(0,r.useEffect)(()=>()=>{j()},[]),{isPlaying:b,isLagging:C,latestAudioId:S,setLatestAudioId:T,latestCharIndex:w,startSpeaker:(e,t)=>{if(s.resume(),null===h.current){if(x.current){console.log("Speaker is already initializing");return}x.current=!0;try{h.current=s.createGain(),console.log("Gain node created"),h.current.connect(s.destination),h.current.gain.value=i,console.log("Gain node connected to destination"),null==e||e()}catch(e){console.error("Failed to create speaker",e)}finally{x.current=!1}null===h.current&&(null==t||t())}},stopSpeaker:j}}}},function(e){e.O(0,[1015,2278,3974,8802,9787,8351,6650,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);