"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[386],{386:function(e,t,r){r.d(t,{e:function(){return o}});var n=r(7437),l=r(2265),c=r(1273),u=r(3069),s=r(2744),a=r(2859);let o=e=>{var t,r;let{isOpen:o,onClose:i,detailedTranslation:d,isTTSPlaying:f,onTTSPlay:x,isPracticeRecording:h,setPracticeRecording:m,isPracticePlaying:g,setPracticePlaying:p}=e,v=null!==(t=null==d?void 0:d.wordForWord)&&void 0!==t?t:[],w=null!==(r=null==d?void 0:d.translation)&&void 0!==r?r:"",[j,b]=(0,l.useState)(null);return(0,n.jsxs)(u.y,{isOpen:o,onClose:i,detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsx)(u.y.Container,{children:(0,n.jsx)(u.y.Content,{style:{backgroundImage:"white"},children:(0,n.jsxs)("div",{className:"p-8 pb-16 text-black w-full",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("p",{className:"font-semibold text-lg ",children:"Explanation"}),(0,n.jsx)("div",{className:"flex gap-3",children:(0,n.jsx)(c._0w,{onClick:i})})]}),(0,n.jsx)("div",{className:"flex gap-1 mt-4 flex-wrap gap-y-2",children:v.length>0&&v.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(j===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let r=e.original.trim();RegExp("^\\p{P}+$","u").test(r)||(x(r),b(t))},children:[(0,n.jsx)("div",{className:"font-normal text-xl px-1 text-nowrap",children:e.original}),(0,n.jsx)("div",{className:"opacity-50 px-1 text-nowrap text-sm",children:e.translation})]},t))}),(0,n.jsxs)("div",{className:"mt-6 flex items-center gap-2 text-black/30",children:[(0,n.jsx)(s.mp2,{className:"text-black/30 text-xl"}),(0,n.jsx)("div",{children:w})]}),(0,n.jsxs)("div",{className:"flex mt-10 justify-center gap-6 mx-10",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,n.jsx)("button",{onClick:()=>{x(),b(null)},className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,n.jsx)(a.J,{className:"text-[#0039FF] text-lg",icon:f?c.JuG:c.gmG})}),(0,n.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,n.jsx)("button",{onClick:()=>m(!h),className:"shadow-custom-blue-shadow bg-[#0039FF] rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,n.jsx)(a.J,{className:"text-white text-xl",icon:h?c.u9M:c.uYL})}),(0,n.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,n.jsx)("button",{onClick:()=>p(!g),className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,n.jsx)(c.tdo,{className:"text-[#0039FF] text-xl"})}),(0,n.jsx)("div",{className:"text-sm text-nowrap",children:"Your sound"})]})]})]})})}),(0,n.jsx)(u.y.Backdrop,{onTap:i})]})}},6870:function(e,t,r){r.d(t,{GlobalAudioContextProvider:function(){return u},Y:function(){return s}});var n=r(7437),l=r(2265);let c=(0,l.createContext)(null),u=e=>{let{children:t}=e,r=(0,l.useRef)(null);return r.current||(console.log("creating audio context"),r.current=new(window.AudioContext||window.webkitAudioContext)),(0,n.jsx)(c.Provider,{value:r.current,children:t})},s=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},1755:function(e,t,r){r.d(t,{I:function(){return l}});var n=r(2265);function l(){let[e,t]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!1),c=(0,n.useRef)(null),u=(0,n.useRef)(null),s=(0,n.useRef)(null),[a,o]=(0,n.useState)(null),i=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});c.current=e,u.current=new MediaRecorder(e);let r=[];u.current.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},u.current.onstop=()=>{let e=new Blob(r,{type:"audio/mpeg"});o(e),t(!1)},u.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{u.current&&"recording"===u.current.state&&u.current.stop(),c.current&&c.current.getTracks().forEach(e=>e.stop())},f=()=>{s.current&&(s.current.pause(),s.current.currentTime=0,l(!1))};return(0,n.useEffect)(()=>()=>{d(),f()},[]),{startRecording:i,stopRecording:d,playRecording:()=>{a?(s.current||(s.current=new Audio),s.current.src=URL.createObjectURL(a),s.current.play(),l(!0),s.current.onended=()=>{l(!1)}):console.warn("No recording available to play")},stopPlayback:f,isPracticeRecording:e,isPlayingAudio:r}}},3399:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(2265),l=r(4272),c=r(6870);function u(e){let{onPlaybackChange:t,volume:r=1,speed:u=1}=e,s=(0,n.useContext)(l.Dm),a=(0,c.Y)(),o=(0,n.useRef)([]),i=(0,n.useRef)(0),d=(0,n.useRef)(null),f=(0,n.useRef)([]),x=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)(!1),[g,p]=(0,n.useState)(!1),[v,w]=(0,n.useState)(!1),[j,b]=(0,n.useState)(null),[N,y]=(0,n.useState)(null),k=(0,n.useRef)(null),T=()=>{E(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==x.current&&(x.current.disconnect(),x.current=null,console.log("Gain node disconnected and released"))},E=()=>{if(f.current.forEach(e=>{clearTimeout(e)}),f.current=[],d.current&&(clearTimeout(d.current),d.current=null),0===o.current.length)return;let e=1,t=o.current.slice(0,1);for(let r of t)if(r&&r.buffer){let t=r.buffer.getChannelData(0);for(let r=0;r<t.length;r++)t[r]=t[r]*e,e-=1/(1*t.length)}o.current.slice(1).forEach(e=>{e.stop()}),o.current=t},C=()=>{p(!1),w(!1),f.current=[],k.current=null},R=async e=>{let{i:t,data:r,id:n,t:l}=e,c=new Int16Array(r),s=a.createBuffer(1,c.length,24e3),h=s.getChannelData(0);for(let e=0;e<c.length;e++)h[e]=c[e]/32768;if(null===x.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let m=a.createBufferSource();m.connect(x.current),m.playbackRate.value=u,m.buffer=s;let g=0==t;g&&(o.current.length>0&&E(),i.current=a.currentTime);let v=i.current+.1*t/u+.1,j=a.currentTime-v;if(j>0&&(console.log("Audio chunk is late, delaying playback by ".concat(j," seconds.")),v+=j,i.current+=j),m.start(v),o.current.push(m),g&&(d.current=setTimeout(()=>{p(!0),y(0),void 0==n&&console.error("First chunk must have an id"),b(n),d.current=null},-(1e3*j))),m.onended=()=>{o.current.length>0&&(o.current.shift(),w(!1)),k.current&&t==k.current-1?C():0===o.current.length&&w(!0)},void 0!=l){let e=f.current.length,t=a.currentTime,r=l.map((r,n)=>setTimeout(()=>y(e+n),1e3*(i.current+r-t)/u));f.current.push(...r)}};return(0,n.useEffect)(()=>{if(!s){console.log("No session found!");return}return s.registerEvent("TTS_CHUNK",R),s.registerEvent("TTS_INTERRUPT",()=>{E()}),s.registerEvent("TTS_END",e=>{let{id:t,len:r}=e;j!==t||g?k.current=r:C()}),()=>{null==s||s.deregisterEvent("TTS_CHUNK"),null==s||s.deregisterEvent("TTS_INTERRUPT"),null==s||s.deregisterEvent("TTS_END")}},[s,u]),(0,n.useEffect)(()=>{null==t||t(g,j)},[g]),(0,n.useEffect)(()=>{x.current&&(x.current.gain.value=r)},[r]),(0,n.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/u)},[u]),(0,n.useEffect)(()=>()=>{T()},[]),{isPlaying:g,isLagging:v,latestAudioId:j,latestCharIndex:N,startSpeaker:(e,t)=>{if(null===x.current){if(m.current){console.log("Speaker is already initializing");return}m.current=!0;try{a.resume(),x.current=a.createGain(),console.log("Gain node created"),a.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(a,"phase-vocoder-processor"),x.current.connect(h.current),h.current.connect(a.destination),x.current.gain.value=r,h.current.parameters.get("pitchFactor").value=1/u,console.log("Phase vocoder worklet added")}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===x.current?null==t||t():null==e||e()}},stopSpeaker:T}}},2859:function(e,t,r){r.d(t,{J:function(){return l}});var n=r(7437);r(2265);let l=e=>{let{icon:t,className:r,...l}=e;return(0,n.jsx)(t,{className:r,...l})}}}]);