"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3038],{386:function(e,t,r){r.d(t,{e:function(){return a}});var n=r(7437),l=r(2265),c=r(1273),u=r(3069),o=r(2744),s=r(2859);let a=e=>{var t,r;let{isOpen:a,onClose:i,detailedTranslation:d,isTTSPlaying:f,onTTSPlay:x,isPracticeRecording:h,setPracticeRecording:m,isPracticePlaying:g,setPracticePlaying:v,onSave:p,isSaved:w}=e,j=null!==(t=null==d?void 0:d.wordForWord)&&void 0!==t?t:[],b=null!==(r=null==d?void 0:d.translation)&&void 0!==r?r:"",[N,k]=(0,l.useState)(null);return(0,n.jsxs)(u.y,{isOpen:a,onClose:()=>{i(),k(null)},detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsx)(u.y.Container,{children:(0,n.jsx)(u.y.Content,{style:{backgroundImage:"white"},children:(0,n.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Explanation"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[void 0!==p&&(0,n.jsx)("button",{onClick:()=>{p(null!=w&&w)},children:w?(0,n.jsx)(c.VF9,{}):(0,n.jsx)(c.mCg,{})}),(0,n.jsx)("button",{className:"p-1 text-lg",onClick:()=>{i(),k(null)},children:(0,n.jsx)(c._0w,{})})]})]}),(0,n.jsx)("div",{className:"mt-4 flex flex-wrap gap-1 gap-y-2",children:j.length>0&&j.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(N===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let r=e.original.trim();RegExp("^\\p{P}+$","u").test(r)||(x(r),k(t))},children:[(0,n.jsx)("div",{className:"text-nowrap px-1 text-xl font-normal",children:e.original}),(0,n.jsx)("div",{className:"text-nowrap px-1 text-sm opacity-50",children:e.translation})]},t))}),(0,n.jsxs)("div",{className:"mt-6 flex items-start gap-2 text-sm text-black/30",children:[(0,n.jsx)(o.mp2,{className:"flex-shrink-0 text-xl text-black/30"}),(0,n.jsx)("div",{children:b})]}),(0,n.jsxs)("div",{className:"mx-10 mt-10 flex justify-center gap-6",children:[(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>{x(),k(null)},className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(s.J,{className:"text-lg text-[#0039FF]",icon:f?c.JuG:c.gmG})}),(0,n.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>m(!h),className:"flex h-14 w-14 items-center justify-center rounded-full bg-[#0039FF] p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(s.J,{className:"text-xl text-white",icon:h?c.u9M:c.uYL})}),(0,n.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>v(!g),className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(c.tdo,{className:"text-xl text-[#0039FF]"})}),(0,n.jsx)("div",{className:"text-nowrap text-sm",children:"Your sound"})]})]})]})})}),(0,n.jsx)(u.y.Backdrop,{onTap:i})]})}},6870:function(e,t,r){r.d(t,{GlobalAudioContextProvider:function(){return u},Y:function(){return o}});var n=r(7437),l=r(2265);let c=(0,l.createContext)(null),u=e=>{let{children:t}=e,r=(0,l.useRef)(null);return r.current||(console.log("creating audio context"),r.current=new(window.AudioContext||window.webkitAudioContext),r.current.onstatechange=()=>{var e,t,n,l,c;if(console.log("onstagechange - AudioContext state changed: ",null===(e=r.current)||void 0===e?void 0:e.state),(null===(t=r.current)||void 0===t?void 0:t.state)==="suspended"&&(null===(l=r.current)||void 0===l||l.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=r.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(n=r.current)||void 0===n?void 0:n.state)==="running"){let e=null===(c=r.current)||void 0===c?void 0:c.currentTime;setTimeout(()=>{var t;(null===(t=r.current)||void 0===t?void 0:t.currentTime)===e&&(console.warn("AudioContext currentTime is stuck, attempting to fix..."),window.location.reload())},100)}}),(0,n.jsx)(c.Provider,{value:r.current,children:t})},o=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},1755:function(e,t,r){r.d(t,{I:function(){return l}});var n=r(2265);function l(){let[e,t]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!1),c=(0,n.useRef)(null),u=(0,n.useRef)(null),o=(0,n.useRef)(null),[s,a]=(0,n.useState)(null),i=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});c.current=e,u.current=new MediaRecorder(e);let r=[];u.current.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},u.current.onstop=()=>{let e=new Blob(r,{type:"audio/mpeg"});a(e),t(!1)},u.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{u.current&&"recording"===u.current.state&&u.current.stop(),c.current&&c.current.getTracks().forEach(e=>e.stop())},f=()=>{o.current&&(o.current.pause(),o.current.currentTime=0,l(!1))};return(0,n.useEffect)(()=>()=>{d(),f()},[]),{startRecording:i,stopRecording:d,playRecording:()=>{s?(o.current||(o.current=new Audio),o.current.src=URL.createObjectURL(s),o.current.play(),l(!0),o.current.onended=()=>{l(!1)}):console.warn("No recording available to play")},stopPlayback:f,isPracticeRecording:e,isPlayingAudio:r}}},9403:function(e,t,r){r.d(t,{f:function(){return l}});var n=r(3974);let l=()=>{let[e,t]=(0,n.useLocalStorage)("token");return{token:e,saveToken:t}}},3399:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(2265),l=r(4272),c=r(6870);function u(e){let{onPlaybackChange:t,volume:r=1,speed:u=1}=e,o=(0,n.useContext)(l.Dm),s=(0,c.Y)(),a=(0,n.useRef)([]),i=(0,n.useRef)(0),d=(0,n.useRef)(null),f=(0,n.useRef)([]),x=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)(!1),[g,v]=(0,n.useState)(!1),[p,w]=(0,n.useState)(!1),[j,b]=(0,n.useState)(null),[N,k]=(0,n.useState)(null),y=(0,n.useRef)(null),T=()=>{C(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==x.current&&(x.current.disconnect(),x.current=null,console.log("Gain node disconnected and released"))},C=()=>{if(f.current.forEach(e=>{clearTimeout(e)}),f.current=[],d.current&&(clearTimeout(d.current),d.current=null),0===a.current.length)return;let e=1,t=a.current.slice(0,1);for(let r of t)if(r&&r.buffer){let t=r.buffer.getChannelData(0);for(let r=0;r<t.length;r++)t[r]=t[r]*e,e-=1/(1*t.length)}a.current.slice(1).forEach(e=>{e.stop()}),a.current=t},E=()=>{v(!1),w(!1),f.current=[],y.current=null},R=async e=>{let{i:t,data:r,id:n,t:l}=e,c=new Int16Array(r),o=s.createBuffer(1,c.length,24e3),h=o.getChannelData(0);for(let e=0;e<c.length;e++)h[e]=c[e]/32768;if(null===x.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let m=s.createBufferSource();m.connect(x.current),m.playbackRate.value=u,m.buffer=o;let g=0==t;g&&(a.current.length>0&&C(),i.current=s.currentTime,console.log("Audio start time reset to",i.current));let p=i.current+.1*t/u+.1,j=s.currentTime-p;if(j>0&&(console.log("Audio chunk is late, delaying playback by ".concat(j," seconds.")),p+=j,i.current+=j),m.start(p),a.current.push(m),g&&(d.current=setTimeout(()=>{v(!0),k(0),void 0==n&&console.error("First chunk must have an id"),b(n),d.current=null},-(1e3*j))),m.onended=()=>{a.current.length>0&&(a.current.shift(),w(!1)),y.current&&t==y.current-1?E():0===a.current.length&&w(!0)},void 0!=l){let e=f.current.length,t=s.currentTime,r=l.map((r,n)=>setTimeout(()=>k(e+n),1e3*(i.current+r-t)/u));f.current.push(...r)}};return(0,n.useEffect)(()=>{if(!o){console.log("No session found!");return}return o.registerEvent("TTS_CHUNK",R),o.registerEvent("TTS_INTERRUPT",()=>{C()}),o.registerEvent("TTS_END",e=>{let{id:t,len:r}=e;j!==t||g?y.current=r:E()}),()=>{null==o||o.deregisterEvent("TTS_CHUNK"),null==o||o.deregisterEvent("TTS_INTERRUPT"),null==o||o.deregisterEvent("TTS_END")}},[o,u]),(0,n.useEffect)(()=>{null==t||t(g,j)},[g]),(0,n.useEffect)(()=>{x.current&&(x.current.gain.value=r)},[r]),(0,n.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/u)},[u]),(0,n.useEffect)(()=>()=>{T()},[]),{isPlaying:g,isLagging:p,latestAudioId:j,latestCharIndex:N,startSpeaker:(e,t)=>{if(null===x.current){if(m.current){console.log("Speaker is already initializing");return}m.current=!0;try{s.resume(),x.current=s.createGain(),console.log("Gain node created"),s.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(s,"phase-vocoder-processor"),x.current.connect(h.current),h.current.connect(s.destination),x.current.gain.value=r,h.current.parameters.get("pitchFactor").value=1/u,console.log("Phase vocoder worklet added")}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===x.current?null==t||t():null==e||e()}},stopSpeaker:T}}},2859:function(e,t,r){r.d(t,{J:function(){return l}});var n=r(7437);r(2265);let l=e=>{let{icon:t,className:r,...l}=e;return(0,n.jsx)(t,{className:r,...l})}}}]);