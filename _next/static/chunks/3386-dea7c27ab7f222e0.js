"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3386],{5095:function(e,t,r){r.d(t,{e:function(){return o}});var n=r(7437),l=r(2265),u=r(1273),c=r(3069),s=r(2744),a=r(2859);let o=e=>{var t,r;let{isOpen:o,onClose:i,detailedTranslation:d,isTTSPlaying:f,onTTSPlay:x,isPracticeRecording:h,setPracticeRecording:m,isPracticePlaying:p,setPracticePlaying:v,onSave:g,isSaved:j}=e,w=null!==(t=null==d?void 0:d.wordForWord)&&void 0!==t?t:[],b=null!==(r=null==d?void 0:d.translation)&&void 0!==r?r:"",[N,T]=(0,l.useState)(null);return(0,n.jsxs)(c.y,{isOpen:o,onClose:()=>{i(),T(null)},detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsx)(c.y.Container,{children:(0,n.jsx)(c.y.Content,{style:{backgroundImage:"white"},children:(0,n.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Explanation"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[void 0!==g&&(0,n.jsx)("button",{onClick:()=>{g(null!=j&&j)},children:j?(0,n.jsx)(u.VF9,{}):(0,n.jsx)(u.mCg,{})}),(0,n.jsx)("button",{className:"p-1 text-lg",onClick:()=>{i(),T(null)},children:(0,n.jsx)(u._0w,{})})]})]}),(0,n.jsx)("div",{className:"mt-4 flex flex-wrap gap-1 gap-y-2",children:w.length>0&&w.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(N===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let r=e.original.trim();RegExp("^\\p{P}+$","u").test(r)||(x(r),T(t))},children:[(0,n.jsx)("div",{className:"text-nowrap px-1 text-xl font-normal",children:e.original}),(0,n.jsx)("div",{className:"text-nowrap px-1 text-sm opacity-50",children:e.translation})]},t))}),(0,n.jsxs)("div",{className:"mt-6 flex items-start gap-2 text-sm text-black/30",children:[(0,n.jsx)(s.mp2,{className:"flex-shrink-0 text-xl text-black/30"}),(0,n.jsx)("div",{children:b})]}),(0,n.jsxs)("div",{className:"mx-10 mt-10 flex justify-center gap-6",children:[(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>{x(),T(null)},className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(a.J,{className:"text-lg text-[#0039FF]",icon:f?u.JuG:u.gmG})}),(0,n.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>m(!h),className:"flex h-14 w-14 items-center justify-center rounded-full bg-[#0039FF] p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(a.J,{className:"text-xl text-white",icon:h?u.u9M:u.uYL})}),(0,n.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>v(!p),className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(u.tdo,{className:"text-xl text-[#0039FF]"})}),(0,n.jsx)("div",{className:"text-nowrap text-sm",children:"Your sound"})]})]})]})})}),(0,n.jsx)(c.y.Backdrop,{onTap:i})]})}},6870:function(e,t,r){r.d(t,{GlobalAudioContextProvider:function(){return c},Y:function(){return s}});var n=r(7437),l=r(2265);let u=(0,l.createContext)(null),c=e=>{let{children:t}=e,r=(0,l.useRef)(null);return r.current||(r.current=new AudioContext,r.current.onstatechange=()=>{var e,t,n,l;if((null===(e=r.current)||void 0===e?void 0:e.state)==="suspended"&&(null===(n=r.current)||void 0===n||n.resume().then(()=>{}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(t=r.current)||void 0===t?void 0:t.state)==="running"){let e=null===(l=r.current)||void 0===l?void 0:l.currentTime;setTimeout(()=>{var t;(null===(t=r.current)||void 0===t?void 0:t.currentTime)===e&&window.location.reload()},100)}}),(0,n.jsx)(u.Provider,{value:r.current,children:t})},s=()=>{let e=(0,l.useContext)(u);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},1755:function(e,t,r){r.d(t,{I:function(){return l}});var n=r(2265);function l(){let[e,t]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!1),u=(0,n.useRef)(null),c=(0,n.useRef)(null),s=(0,n.useRef)(null),[a,o]=(0,n.useState)(null),i=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});u.current=e,c.current=new MediaRecorder(e);let r=[];c.current.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},c.current.onstop=()=>{let e=new Blob(r,{type:"audio/mpeg"});o(e),t(!1)},c.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{c.current&&"recording"===c.current.state&&c.current.stop(),u.current&&u.current.getTracks().forEach(e=>e.stop())},f=()=>{s.current&&(s.current.pause(),s.current.currentTime=0,l(!1))};return(0,n.useEffect)(()=>()=>{d(),f()},[]),{startRecording:i,stopRecording:d,playRecording:()=>{a&&(s.current||(s.current=new Audio),s.current.src=URL.createObjectURL(a),s.current.play(),l(!0),s.current.onended=()=>{l(!1)})},stopPlayback:f,isPracticeRecording:e,isPlayingAudio:r}}},3399:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(2265),l=r(4272),u=r(6870);function c(e){let{onPlaybackChange:t,volume:r=1,speed:c=1}=e,s=(0,n.useContext)(l.Dm),a=(0,u.Y)(),o=(0,n.useRef)([]),i=(0,n.useRef)(0),d=(0,n.useRef)(null),f=(0,n.useRef)([]),x=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)(!1),[p,v]=(0,n.useState)(!1),[g,j]=(0,n.useState)(!1),[w,b]=(0,n.useState)(null),[N,T]=(0,n.useState)(null),k=(0,n.useRef)(null),y=()=>{C(),null!==h.current&&(h.current.disconnect(),h.current=null),null!==x.current&&(x.current.disconnect(),x.current=null)},C=()=>{if(f.current.forEach(e=>{clearTimeout(e)}),f.current=[],d.current&&(clearTimeout(d.current),d.current=null),0===o.current.length)return;let e=1,t=o.current.slice(0,1);for(let r of t)if(r&&r.buffer){let t=r.buffer.getChannelData(0);for(let r=0;r<t.length;r++)t[r]=t[r]*e,e-=1/(1*t.length)}o.current.slice(1).forEach(e=>{e.stop()}),o.current=t},E=()=>{v(!1),j(!1),f.current=[],k.current=null},R=async e=>{let{i:t,data:r,id:n,t:l}=e,u=new Int16Array(r),s=a.createBuffer(1,u.length,24e3),h=s.getChannelData(0);for(let e=0;e<u.length;e++)h[e]=u[e]/32768;if(null===x.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let m=a.createBufferSource();m.connect(x.current),m.playbackRate.value=c,m.buffer=s;let p=0==t;p&&(o.current.length>0&&C(),i.current=a.currentTime);let g=i.current+.1*t/c+.1,w=a.currentTime-g;if(w>0&&(g+=w,i.current+=w),m.start(g),o.current.push(m),p&&(d.current=setTimeout(()=>{v(!0),T(0),void 0==n&&console.error("First chunk must have an id"),b(n),d.current=null},-(1e3*w))),m.onended=()=>{o.current.length>0&&(o.current.shift(),j(!1)),k.current&&t==k.current-1?E():0===o.current.length&&j(!0)},void 0!=l){let e=f.current.length,t=a.currentTime,r=l.map((r,n)=>setTimeout(()=>T(e+n),1e3*(i.current+r-t)/c));f.current.push(...r)}};return(0,n.useEffect)(()=>{if(s)return s.registerEvent("TTS_CHUNK",R),s.registerEvent("TTS_INTERRUPT",()=>{C()}),s.registerEvent("TTS_END",e=>{let{id:t,len:r}=e;w!==t||p?k.current=r:E()}),()=>{null==s||s.deregisterEvent("TTS_CHUNK"),null==s||s.deregisterEvent("TTS_INTERRUPT"),null==s||s.deregisterEvent("TTS_END")}},[s,c]),(0,n.useEffect)(()=>{null==t||t(p,w)},[p]),(0,n.useEffect)(()=>{x.current&&(x.current.gain.value=r)},[r]),(0,n.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/c)},[c]),(0,n.useEffect)(()=>()=>{y()},[]),{isPlaying:p,isLagging:g,latestAudioId:w,latestCharIndex:N,startSpeaker:(e,t)=>{if(null===x.current&&!m.current){m.current=!0;try{a.resume(),x.current=a.createGain(),a.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(a,"phase-vocoder-processor"),x.current.connect(h.current),h.current.connect(a.destination),x.current.gain.value=r,h.current.parameters.get("pitchFactor").value=1/c,null==e||e()}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===x.current&&(null==t||t())}},stopSpeaker:y}}}}]);