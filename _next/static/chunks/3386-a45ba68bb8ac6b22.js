"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3386],{386:function(e,t,n){n.d(t,{e:function(){return a}});var r=n(7437),l=n(2265),c=n(1273),o=n(3069),s=n(2744),u=n(2859);let a=e=>{var t,n;let{isOpen:a,onClose:i,detailedTranslation:d,isTTSPlaying:f,onTTSPlay:x,isPracticeRecording:h,setPracticeRecording:m,isPracticePlaying:g,setPracticePlaying:p}=e,v=null!==(t=null==d?void 0:d.wordForWord)&&void 0!==t?t:[],w=null!==(n=null==d?void 0:d.translation)&&void 0!==n?n:"",[b,j]=(0,l.useState)(null);return(0,r.jsxs)(o.y,{isOpen:a,onClose:()=>{i(),j(null)},detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,r.jsx)(o.y.Container,{children:(0,r.jsx)(o.y.Content,{style:{backgroundImage:"white"},children:(0,r.jsxs)("div",{className:"p-8 pb-16 text-black w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("p",{className:"font-semibold text-lg ",children:"Explanation"}),(0,r.jsx)("div",{className:"flex gap-3",children:(0,r.jsx)("button",{className:"p-1 text-lg",onClick:()=>{i(),j(null)},children:(0,r.jsx)(c._0w,{})})})]}),(0,r.jsx)("div",{className:"flex gap-1 mt-4 flex-wrap gap-y-2",children:v.length>0&&v.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(b===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let n=e.original.trim();RegExp("^\\p{P}+$","u").test(n)||(x(n),j(t))},children:[(0,r.jsx)("div",{className:"font-normal text-xl px-1 text-nowrap",children:e.original}),(0,r.jsx)("div",{className:"opacity-50 px-1 text-nowrap text-sm",children:e.translation})]},t))}),(0,r.jsxs)("div",{className:"mt-6 flex items-start gap-2 text-black/30 text-sm",children:[(0,r.jsx)(s.mp2,{className:"text-black/30 text-xl flex-shrink-0"}),(0,r.jsx)("div",{children:w})]}),(0,r.jsxs)("div",{className:"flex mt-10 justify-center gap-6 mx-10",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>{x(),j(null)},className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(u.J,{className:"text-[#0039FF] text-lg",icon:f?c.JuG:c.gmG})}),(0,r.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>m(!h),className:"shadow-custom-blue-shadow bg-[#0039FF] rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(u.J,{className:"text-white text-xl",icon:h?c.u9M:c.uYL})}),(0,r.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 flex-1 w-16",children:[(0,r.jsx)("button",{onClick:()=>p(!g),className:"shadow-custom-blue-shadow bg-white rounded-full p-4 h-14 w-14 flex justify-center items-center",children:(0,r.jsx)(c.tdo,{className:"text-[#0039FF] text-xl"})}),(0,r.jsx)("div",{className:"text-sm text-nowrap",children:"Your sound"})]})]})]})})}),(0,r.jsx)(o.y.Backdrop,{onTap:i})]})}},6870:function(e,t,n){n.d(t,{GlobalAudioContextProvider:function(){return o},Y:function(){return s}});var r=n(7437),l=n(2265);let c=(0,l.createContext)(null),o=e=>{let{children:t}=e,n=(0,l.useRef)(null);return n.current||(console.log("creating audio context"),n.current=new(window.AudioContext||window.webkitAudioContext)),(0,l.useEffect)(()=>{let e=()=>{var e,t,r;console.log("Visibility changed: ",document.visibilityState),console.log("AudioContext state: ",null===(e=n.current)||void 0===e?void 0:e.state),"visible"===document.visibilityState&&(console.log("App is visible, checking AudioContext state..."),(null===(t=n.current)||void 0===t?void 0:t.state)==="suspended"?(console.log("AudioContext is suspended, attempting to resume..."),n.current.resume().then(()=>{console.log("AudioContext resumed")}).catch(e=>{console.error("Failed to resume AudioContext:",e)})):(null===(r=n.current)||void 0===r?void 0:r.state)==="closed"&&(console.log("AudioContext is closed, creating a new AudioContext..."),n.current=new(window.AudioContext||window.webkitAudioContext)))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,r.jsx)(c.Provider,{value:n.current,children:t})},s=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},1755:function(e,t,n){n.d(t,{I:function(){return l}});var r=n(2265);function l(){let[e,t]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1),c=(0,r.useRef)(null),o=(0,r.useRef)(null),s=(0,r.useRef)(null),[u,a]=(0,r.useState)(null),i=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});c.current=e,o.current=new MediaRecorder(e);let n=[];o.current.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},o.current.onstop=()=>{let e=new Blob(n,{type:"audio/mpeg"});a(e),t(!1)},o.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{o.current&&"recording"===o.current.state&&o.current.stop(),c.current&&c.current.getTracks().forEach(e=>e.stop())},f=()=>{s.current&&(s.current.pause(),s.current.currentTime=0,l(!1))};return(0,r.useEffect)(()=>()=>{d(),f()},[]),{startRecording:i,stopRecording:d,playRecording:()=>{u?(s.current||(s.current=new Audio),s.current.src=URL.createObjectURL(u),s.current.play(),l(!0),s.current.onended=()=>{l(!1)}):console.warn("No recording available to play")},stopPlayback:f,isPracticeRecording:e,isPlayingAudio:n}}},3399:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(2265),l=n(4272),c=n(6870);function o(e){let{onPlaybackChange:t,volume:n=1,speed:o=1}=e,s=(0,r.useContext)(l.Dm),u=(0,c.Y)(),a=(0,r.useRef)([]),i=(0,r.useRef)(0),d=(0,r.useRef)(null),f=(0,r.useRef)([]),x=(0,r.useRef)(null),h=(0,r.useRef)(null),m=(0,r.useRef)(!1),[g,p]=(0,r.useState)(!1),[v,w]=(0,r.useState)(!1),[b,j]=(0,r.useState)(null),[y,N]=(0,r.useState)(null),k=(0,r.useRef)(null),C=()=>{E(),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Phase vocoder node disconnected and released")),null!==x.current&&(x.current.disconnect(),x.current=null,console.log("Gain node disconnected and released"))},E=()=>{if(f.current.forEach(e=>{clearTimeout(e)}),f.current=[],d.current&&(clearTimeout(d.current),d.current=null),0===a.current.length)return;let e=1,t=a.current.slice(0,1);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(1*t.length)}a.current.slice(1).forEach(e=>{e.stop()}),a.current=t},T=()=>{p(!1),w(!1),f.current=[],k.current=null},R=async e=>{let{i:t,data:n,id:r,t:l}=e,c=new Int16Array(n),s=u.createBuffer(1,c.length,24e3),h=s.getChannelData(0);for(let e=0;e<c.length;e++)h[e]=c[e]/32768;if(null===x.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let m=u.createBufferSource();m.connect(x.current),m.playbackRate.value=o,m.buffer=s;let g=0==t;g&&(a.current.length>0&&E(),i.current=u.currentTime);let v=i.current+.1*t/o+.1,b=u.currentTime-v;if(b>0&&(console.log("Audio chunk is late, delaying playback by ".concat(b," seconds.")),v+=b,i.current+=b),m.start(v),a.current.push(m),g&&(d.current=setTimeout(()=>{p(!0),N(0),void 0==r&&console.error("First chunk must have an id"),j(r),d.current=null},-(1e3*b))),m.onended=()=>{a.current.length>0&&(a.current.shift(),w(!1)),k.current&&t==k.current-1?T():0===a.current.length&&w(!0)},void 0!=l){let e=f.current.length,t=u.currentTime,n=l.map((n,r)=>setTimeout(()=>N(e+r),1e3*(i.current+n-t)/o));f.current.push(...n)}};return(0,r.useEffect)(()=>{if(!s){console.log("No session found!");return}return s.registerEvent("TTS_CHUNK",R),s.registerEvent("TTS_INTERRUPT",()=>{E()}),s.registerEvent("TTS_END",e=>{let{id:t,len:n}=e;b!==t||g?k.current=n:T()}),()=>{null==s||s.deregisterEvent("TTS_CHUNK"),null==s||s.deregisterEvent("TTS_INTERRUPT"),null==s||s.deregisterEvent("TTS_END")}},[s,o]),(0,r.useEffect)(()=>{null==t||t(g,b)},[g]),(0,r.useEffect)(()=>{x.current&&(x.current.gain.value=n)},[n]),(0,r.useEffect)(()=>{h.current&&(h.current.parameters.get("pitchFactor").value=1/o)},[o]),(0,r.useEffect)(()=>()=>{C()},[]),{isPlaying:g,isLagging:v,latestAudioId:b,latestCharIndex:y,startSpeaker:(e,t)=>{if(null===x.current){if(m.current){console.log("Speaker is already initializing");return}m.current=!0;try{u.resume(),x.current=u.createGain(),console.log("Gain node created"),u.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{h.current=new AudioWorkletNode(u,"phase-vocoder-processor"),x.current.connect(h.current),h.current.connect(u.destination),x.current.gain.value=n,h.current.parameters.get("pitchFactor").value=1/o,console.log("Phase vocoder worklet added")}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{m.current=!1}null===x.current?null==t||t():null==e||e()}},stopSpeaker:C}}},2859:function(e,t,n){n.d(t,{J:function(){return l}});var r=n(7437);n(2265);let l=e=>{let{icon:t,className:n,...l}=e;return(0,r.jsx)(t,{className:n,...l})}}}]);