"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3386],{25095:function(e,t,r){r.d(t,{e:function(){return a}});var n=r(57437),l=r(2265),c=r(61273),u=r(3069),s=r(22744),o=r(32859);let a=e=>{var t,r;let{isOpen:a,onClose:i,detailedTranslation:d,isTTSPlaying:f,onTTSPlay:x,isPracticeRecording:h,setPracticeRecording:m,isPracticePlaying:g,setPracticePlaying:v,onSave:p,isSaved:w}=e,j=null!==(t=null==d?void 0:d.wordForWord)&&void 0!==t?t:[],b=null!==(r=null==d?void 0:d.translation)&&void 0!==r?r:"",[N,k]=(0,l.useState)(null);return(0,n.jsxs)(u.y,{isOpen:a,onClose:()=>{i(),k(null)},detent:"content-height",tweenConfig:{ease:"easeInOut",duration:.3},children:[(0,n.jsx)(u.y.Container,{children:(0,n.jsx)(u.y.Content,{style:{backgroundImage:"white"},children:(0,n.jsxs)("div",{className:"w-full p-8 pb-16 text-black",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-lg font-semibold",children:"Explanation"}),(0,n.jsxs)("div",{className:"flex gap-0",children:[void 0!==p&&(0,n.jsx)("button",{className:"p-2",onClick:()=>{p(null!=w&&w)},children:w?(0,n.jsx)(c.VF9,{}):(0,n.jsx)(c.mCg,{})}),(0,n.jsx)("button",{className:"p-2 text-lg",onClick:()=>{i(),k(null)},children:(0,n.jsx)(c._0w,{})})]})]}),(0,n.jsx)("div",{className:"mt-4 flex flex-wrap gap-1 gap-y-2",children:j.length>0&&j.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col items-center rounded ".concat(N===t?"bg-[#0039FF]/10 text-[#0039FF]":"bg-black/5"),onClick:()=>{let r=e.original.trim();RegExp("^\\p{P}+$","u").test(r)||(x(r),k(t))},children:[(0,n.jsx)("div",{className:"text-nowrap px-1 text-xl font-normal",children:e.original}),(0,n.jsx)("div",{className:"text-nowrap px-1 text-sm opacity-50",children:e.translation})]},t))}),(0,n.jsxs)("div",{className:"mt-6 flex items-start gap-2 text-sm text-black/30",children:[(0,n.jsx)(s.mp2,{className:"flex-shrink-0 text-xl text-black/30"}),(0,n.jsx)("div",{children:b})]}),(0,n.jsxs)("div",{className:"mx-10 mt-10 flex justify-center gap-6",children:[(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>{x(),k(null)},className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(o.J,{className:"text-lg text-[#0039FF]",icon:f?c.JuG:c.gmG})}),(0,n.jsx)("div",{className:"text-sm",children:"Play"})]}),(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>m(!h),className:"flex h-14 w-14 items-center justify-center rounded-full bg-[#0039FF] p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(o.J,{className:"text-xl text-white",icon:h?c.u9M:c.uYL})}),(0,n.jsx)("div",{className:"text-sm",children:"Practice"})]}),(0,n.jsxs)("div",{className:"flex w-16 flex-1 flex-col items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>v(!g),className:"flex h-14 w-14 items-center justify-center rounded-full bg-white p-4 shadow-custom-blue-shadow",children:(0,n.jsx)(c.tdo,{className:"text-xl text-[#0039FF]"})}),(0,n.jsx)("div",{className:"text-nowrap text-sm",children:"Your sound"})]})]})]})})}),(0,n.jsx)(u.y.Backdrop,{onTap:i})]})}},56870:function(e,t,r){r.d(t,{GlobalAudioContextProvider:function(){return u},Y:function(){return s}});var n=r(57437),l=r(2265);let c=(0,l.createContext)(null),u=e=>{let{children:t}=e,r=(0,l.useRef)(null);return r.current||(console.log("creating audio context"),r.current=new AudioContext,r.current.onstatechange=()=>{var e,t,n,l,c;if(console.log("onstagechange - AudioContext state changed: ",null===(e=r.current)||void 0===e?void 0:e.state),(null===(t=r.current)||void 0===t?void 0:t.state)==="suspended"&&(null===(l=r.current)||void 0===l||l.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=r.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(n=r.current)||void 0===n?void 0:n.state)==="running"){let e=null===(c=r.current)||void 0===c?void 0:c.currentTime;setTimeout(()=>{var t;(null===(t=r.current)||void 0===t?void 0:t.currentTime)===e&&(console.warn("AudioContext currentTime is stuck, attempting to fix..."),window.location.reload())},100)}}),(0,n.jsx)(c.Provider,{value:r.current,children:t})},s=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},1755:function(e,t,r){r.d(t,{I:function(){return l}});var n=r(2265);function l(){let[e,t]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!1),c=(0,n.useRef)(null),u=(0,n.useRef)(null),s=(0,n.useRef)(null),[o,a]=(0,n.useState)(null),i=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});c.current=e,u.current=new MediaRecorder(e);let r=[];u.current.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},u.current.onstop=()=>{let e=new Blob(r,{type:"audio/mpeg"});a(e),t(!1)},u.current.start(),t(!0)}catch(e){console.error("Error accessing microphone:",e)}},d=()=>{u.current&&"recording"===u.current.state&&u.current.stop(),c.current&&c.current.getTracks().forEach(e=>e.stop())},f=()=>{s.current&&(s.current.pause(),s.current.currentTime=0,l(!1))};return(0,n.useEffect)(()=>()=>{d(),f()},[]),{startRecording:i,stopRecording:d,playRecording:()=>{o?(s.current||(s.current=new Audio),s.current.src=URL.createObjectURL(o),s.current.play(),l(!0),s.current.onended=()=>{l(!1)}):console.warn("No recording available to play")},stopPlayback:f,isPracticeRecording:e,isPlayingAudio:r}}},63399:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(2265),l=r(74272),c=r(56870);function u(e){let{onPlaybackStart:t,onPlaybackFinish:r,onPlaybackInterrupt:u,volume:s=1,speed:o=1}=e,a=(0,n.useContext)(l.Dm),i=(0,c.Y)(),d=(0,n.useRef)([]),f=(0,n.useRef)(0),x=(0,n.useRef)(null),h=(0,n.useRef)([]),m=(0,n.useRef)(null),g=(0,n.useRef)(null),v=(0,n.useRef)(!1),[p,w]=(0,n.useState)(!1),j=(0,n.useRef)(p),[b,N]=(0,n.useState)(!1),[k,y]=(0,n.useState)(null),T=(0,n.useRef)(null),[C,E]=(0,n.useState)(null),R=(0,n.useRef)(null),F=()=>{S(),null!==g.current&&(g.current.disconnect(),g.current=null,console.log("Phase vocoder node disconnected and released")),null!==m.current&&(m.current.disconnect(),m.current=null,console.log("Gain node disconnected and released"))},S=()=>{if(h.current.forEach(e=>{clearTimeout(e)}),h.current=[],x.current&&(clearTimeout(x.current),x.current=null),0===d.current.length)return;let e=1,t=d.current.slice(0,5);for(let r of t)if(r&&r.buffer){let t=r.buffer.getChannelData(0);for(let r=0;r<t.length;r++)t[r]=t[r]*e,e-=1/(5*t.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),w(!1),j.current=!1;let r=i.currentTime-f.current;null==u||u(T.current,r,C),d.current=t},A=()=>{w(!1),j.current=!1,N(!1),h.current=[],R.current=null,null==r||r(T.current)},_=async e=>{let{i:r,data:n,id:l,t:c}=e,u=new Int16Array(n),s=i.createBuffer(1,u.length,24e3),a=s.getChannelData(0);for(let e=0;e<u.length;e++)a[e]=u[e]/32768;if(null===m.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let g=i.createBufferSource();g.connect(m.current),g.playbackRate.value=o,g.buffer=s;let v=0==r;v&&(d.current.length>0&&S(),f.current=i.currentTime,console.log("Audio start time reset to",f.current));let p=f.current+.1*r/o+.1,b=i.currentTime-p;if(b>0&&(console.log("Audio chunk is late, delaying playback by ".concat(b," seconds.")),p+=b,f.current+=b),g.start(p),d.current.push(g),v&&(x.current=setTimeout(()=>{w(!0),j.current=!0,null==t||t(l),E(0),void 0==l&&console.error("First chunk must have an id"),y(l),T.current=l,x.current=null},-(1e3*b))),g.onended=()=>{d.current.length>0&&(d.current.shift(),N(!1)),R.current&&r==R.current-1?A():0===d.current.length&&N(!0)},void 0!=c){let e=h.current.length,t=i.currentTime,r=c.map((r,n)=>setTimeout(()=>E(e+n),1e3*(f.current+r-t)/o));h.current.push(...r)}};return(0,n.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",_),a.registerEvent("TTS_INTERRUPT",()=>{S()}),a.registerEvent("TTS_END",e=>{let{id:t,len:r}=e;T.current!==t||j.current?R.current=r:A()}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,o]),(0,n.useEffect)(()=>{m.current&&(m.current.gain.value=s)},[s]),(0,n.useEffect)(()=>{g.current&&(g.current.parameters.get("pitchFactor").value=1/o)},[o]),(0,n.useEffect)(()=>()=>{F()},[]),{isPlaying:p,isLagging:b,latestAudioId:k,setLatestAudioId:y,latestCharIndex:C,startSpeaker:(e,t)=>{if(null===m.current){if(v.current){console.log("Speaker is already initializing");return}v.current=!0;try{i.resume(),m.current=i.createGain(),console.log("Gain node created"),i.audioWorklet.addModule("worklets/phase-vocoder.js").then(()=>{g.current=new AudioWorkletNode(i,"phase-vocoder-processor"),m.current.connect(g.current),g.current.connect(i.destination),m.current.gain.value=s,g.current.parameters.get("pitchFactor").value=1/o,console.log("Phase vocoder worklet added"),null==e||e()}).catch(e=>{console.error("Failed to add phase vocoder worklet",e)})}catch(e){console.error("Failed to create speaker",e)}finally{v.current=!1}null===m.current&&(null==t||t())}},stopSpeaker:F}}}}]);